import"./modulepreload-polyfill-3cfb730f.js";const w=()=>new Promise(e=>{window.API?e():setTimeout(()=>w().then(e),100)}),g=document.getElementById("loginForm"),c=document.getElementById("loginBtn"),m=document.getElementById("btnText"),r=document.getElementById("errorMessage"),o=document.getElementById("passwordToggle"),l=document.getElementById("password");o.addEventListener("click",()=>{const e=l.type==="password";l.type=e?"text":"password",o.classList.toggle("fa-eye",!e),o.classList.toggle("fa-eye-slash",e)});g.addEventListener("submit",async e=>{e.preventDefault();const n=document.getElementById("username").value.trim(),a=document.getElementById("password").value,i=document.getElementById("rememberMe").checked;if(!n||!a){s("请填写用户名和密码");return}c.disabled=!0,m.innerHTML='<span class="loading-spinner"></span>登录中...',r.classList.remove("show");try{await w();const t=await window.API.auth.login({loginAccount:n,password:a,rememberMe:i});t.code===200&&t.data?(window.notification&&window.notification.success&&window.notification.success("登录成功！正在跳转..."),i?localStorage.setItem("rememberedUsername",n):localStorage.removeItem("rememberedUsername"),setTimeout(()=>{const d=new URLSearchParams(window.location.search).get("returnUrl");d?window.location.href=d:window.location.href="/src/pages/courses.html"},1e3)):s(t.message||"登录失败，请检查用户名和密码")}catch(t){console.error("Login error:",t),s(t.message||"登录失败，请稍后重试")}finally{c.disabled=!1,m.textContent="登录"}});function s(e){r.textContent=e,r.classList.add("show"),window.notification&&window.notification.error&&window.notification.error(e)}document.addEventListener("DOMContentLoaded",()=>{const e=localStorage.getItem("rememberedUsername");e&&(document.getElementById("username").value=e,document.getElementById("rememberMe").checked=!0)});
