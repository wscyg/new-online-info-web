import"./modulepreload-polyfill-3cfb730f.js";import"./api-28a76582.js";import"./notification-d9fdfacb.js";const e={form:document.getElementById("registerForm"),username:document.getElementById("username"),email:document.getElementById("email"),phone:document.getElementById("phone"),password:document.getElementById("password"),confirmPassword:document.getElementById("confirmPassword"),agreeTerms:document.getElementById("agreeTerms"),registerBtn:document.getElementById("registerBtn"),btnText:document.getElementById("btnText"),errorMessage:document.getElementById("errorMessage"),successMessage:document.getElementById("successMessage"),usernameHint:document.getElementById("usernameHint"),emailHint:document.getElementById("emailHint"),phoneHint:document.getElementById("phoneHint"),passwordHint:document.getElementById("passwordHint"),confirmHint:document.getElementById("confirmHint"),passwordStrength:document.getElementById("passwordStrength")};let a={username:!1,email:!1,password:!1,confirmPassword:!1};e.username.addEventListener("input",async n=>{const t=n.target.value,s=e.usernameHint;if(t.length<4)r(s,"invalid","用户名至少4个字符"),a.username=!1;else if(t.length>20)r(s,"invalid","用户名最多20个字符"),a.username=!1;else if(!/^[a-zA-Z0-9_]+$/.test(t))r(s,"invalid","只能包含字母、数字和下划线"),a.username=!1;else try{(await window.API.auth.checkUsername(t)).data===!0?(r(s,"valid","用户名可用"),a.username=!0):(r(s,"invalid","用户名已被占用"),a.username=!1)}catch{r(s,"valid","用户名格式正确"),a.username=!0}});e.email.addEventListener("input",async n=>{const t=n.target.value,s=e.emailHint;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))r(s,"invalid","请输入有效的邮箱地址"),a.email=!1;else try{(await window.API.auth.checkEmail(t)).data===!0?(r(s,"valid","邮箱可用"),a.email=!0):(r(s,"invalid","邮箱已被注册"),a.email=!1)}catch{r(s,"valid","邮箱格式正确"),a.email=!0}});e.password.addEventListener("input",n=>{const t=n.target.value,s=e.passwordHint;t.length<8?(r(s,"invalid","密码至少8个字符"),a.password=!1):!/\d/.test(t)||!/[a-zA-Z]/.test(t)?(r(s,"invalid","密码需包含字母和数字"),a.password=!1):(r(s,"valid","密码格式正确"),a.password=!0),e.confirmPassword.value&&c()});e.confirmPassword.addEventListener("input",c);function c(){const n=e.confirmHint;e.confirmPassword.value!==e.password.value?(r(n,"invalid","两次输入的密码不一致"),a.confirmPassword=!1):(r(n,"valid","密码匹配"),a.confirmPassword=!0)}function r(n,t,s){n.className=`validation-hint ${t}`,n.querySelector("span").textContent=s;const i=n.querySelector("i");t==="valid"?i.className="fas fa-check-circle":t==="invalid"?i.className="fas fa-times-circle":i.className="fas fa-info-circle"}e.form.addEventListener("submit",async n=>{if(n.preventDefault(),e.errorMessage.classList.remove("show"),e.successMessage.classList.remove("show"),!Object.values(a).every(s=>s)){l("请正确填写所有必填项");return}if(!e.agreeTerms.checked){l("请阅读并同意用户协议");return}e.registerBtn.disabled=!0,e.btnText.innerHTML='<span class="loading-spinner"></span>注册中...';try{const s={username:e.username.value,email:e.email.value,password:e.password.value},i=await window.API.auth.register(s);i.code===200?(m("注册成功！正在跳转到登录页..."),setTimeout(()=>{const o=new URLSearchParams(window.location.search).get("returnUrl"),d=o?`/src/pages/login.html?returnUrl=${encodeURIComponent(o)}`:"/src/pages/login.html";window.location.href=d},2e3)):l(i.message||"注册失败，请重试")}catch(s){console.error("Registration error:",s),l(s.message||"注册失败，请稍后重试")}finally{e.registerBtn.disabled=!1,e.btnText.textContent="创建账户"}});function l(n){var t;e.errorMessage.textContent=n,e.errorMessage.classList.add("show"),(t=window.notification)==null||t.error(n)}function m(n){var t;e.successMessage.textContent=n,e.successMessage.classList.add("show"),(t=window.notification)==null||t.success(n)}
