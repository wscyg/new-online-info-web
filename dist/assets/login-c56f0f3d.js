import"./modulepreload-polyfill-3cfb730f.js";/* empty css                        */const g=()=>new Promise(e=>{window.API?e():setTimeout(()=>g().then(e),100)}),c=document.getElementById("loginForm"),s=document.getElementById("loginBtn"),m=document.getElementById("btnText"),a=document.getElementById("errorMessage"),i=document.getElementById("passwordToggle"),w=document.getElementById("password");i.addEventListener("click",()=>{const e=w.type==="password";w.type=e?"text":"password",i.classList.toggle("fa-eye",!e),i.classList.toggle("fa-eye-slash",e)});window.formValidation?window.formValidation.initFormValidation("#loginForm",{onSubmit:async(e,t)=>{const n=t.get("username").trim(),r=t.get("password"),d=document.getElementById("rememberMe").checked;window.uiHelpers?window.uiHelpers.showButtonLoading(s):(s.disabled=!0,m.innerHTML='<span class="loading-spinner"></span>登录中...'),a.classList.remove("show");try{await g();const o=await window.API.auth.login({loginAccount:n,password:r,rememberMe:d});if(o.code===200&&o.data)window.uiHelpers?window.uiHelpers.showSuccess("登录成功！正在跳转..."):window.notification&&window.notification.success&&window.notification.success("登录成功！正在跳转..."),d?localStorage.setItem("rememberedUsername",n):localStorage.removeItem("rememberedUsername"),setTimeout(()=>{const l=new URLSearchParams(window.location.search).get("returnUrl");l?window.location.href=l:window.location.href="/src/pages/courses.html"},1e3);else throw new Error(o.message||"登录失败，请检查用户名和密码")}catch(o){console.error("Login error:",o),window.uiHelpers?window.uiHelpers.handleApiError(o,"登录失败"):u(o.message||"登录失败，请稍后重试")}finally{window.uiHelpers?window.uiHelpers.hideButtonLoading(s):(s.disabled=!1,m.textContent="登录")}}}):c.addEventListener("submit",async e=>{e.preventDefault();const t=new FormData(c),n=t.get("username").trim(),r=t.get("password");if(!n||!r){u("请填写用户名和密码");return}console.warn("Form validation not available, using fallback")});function u(e){a.textContent=e,a.classList.add("show"),window.notification&&window.notification.error&&window.notification.error(e)}document.addEventListener("DOMContentLoaded",()=>{const e=localStorage.getItem("rememberedUsername");e&&(document.getElementById("username").value=e,document.getElementById("rememberMe").checked=!0)});
