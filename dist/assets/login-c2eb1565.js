import"./modulepreload-polyfill-3cfb730f.js";const g=document.getElementById("loginForm"),c=document.getElementById("loginBtn"),m=document.getElementById("btnText"),s=document.getElementById("errorMessage");g.addEventListener("submit",async o=>{o.preventDefault();const n=document.getElementById("username").value.trim(),r=document.getElementById("password").value,a=document.getElementById("rememberMe").checked;if(!n||!r){l("请填写用户名和密码");return}c.disabled=!0,m.innerHTML='<span class="loading-spinner"></span>登录中...',s.classList.remove("show");try{console.log("=== 开始登录请求 ==="),console.log("用户名:",n),console.log("密码长度:",r.length);const e=await window.API.auth.login({username:n,password:r,rememberMe:a});console.log("=== 登录响应 ==="),console.log("响应码:",e.code),console.log("响应数据:",e.data),console.log("完整响应:",e),e.code===200&&e.data?(window.notification.success("登录成功！正在跳转..."),console.log("=== 登录成功后验证 ==="),console.log("Token已保存:",!!localStorage.getItem("token")),console.log("User已保存:",!!localStorage.getItem("user")),console.log("Token内容:",localStorage.getItem("token")),console.log("User内容:",localStorage.getItem("user")),a?localStorage.setItem("rememberedUsername",n):localStorage.removeItem("rememberedUsername"),setTimeout(()=>{console.log("=== 跳转前再次验证 ==="),console.log("Token状态:",!!localStorage.getItem("token")),console.log("User状态:",!!localStorage.getItem("user"));const t=new URLSearchParams(window.location.search).get("returnUrl");t?t==="/"?window.location.href="/":t.startsWith("/")?window.location.href=t:window.location.href=`/src/pages/${t}`:window.location.href="/"},1e3)):l(e.message||"登录失败，请检查用户名和密码")}catch(e){console.error("Login error:",e),l(e.message||"登录失败，请稍后重试")}finally{c.disabled=!1,m.textContent="登录"}});function l(o){s.textContent=o,s.classList.add("show"),window.notification.error(o)}window.addEventListener("DOMContentLoaded",()=>{const o=localStorage.getItem("rememberedUsername");o&&(document.getElementById("username").value=o,document.getElementById("rememberMe").checked=!0)});
