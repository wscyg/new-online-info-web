<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>成就中心 - AI 信息未来</title>
    
    <style>
        /* 页面布局 */
        body {
            padding-top: 48px;
            min-height: 100vh;
        }

        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px 22px;
        }

        /* 页面标题 */
        .page-header {
            text-align: center;
            margin-bottom: 64px;
        }

        .page-header h1 {
            margin-bottom: 12px;
        }

        .page-header p {
            font-size: 19px;
            max-width: 600px;
            margin: 0 auto;
        }

        /* 统计概览 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 64px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 32px;
            text-align: center;
            transition: all var(--transition-fast);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-card);
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            margin: 0 auto 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
        }

        .stat-icon svg {
            width: 28px;
            height: 28px;
            stroke: white;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .stat-value {
            font-size: 40px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.02em;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 15px;
            color: var(--text-secondary);
        }

        /* 分类标签 */
        .category-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 48px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .category-tab {
            padding: 10px 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            font-size: 15px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .category-tab:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-color: var(--border-strong);
        }

        .category-tab.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .category-tab svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        /* 成就网格 */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
            margin-bottom: 64px;
        }

        .achievement-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 32px;
            text-align: center;
            transition: all var(--transition-fast);
            position: relative;
            overflow: hidden;
        }

        .achievement-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .achievement-card.locked {
            opacity: 0.5;
        }

        .achievement-card.locked::after {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--bg-secondary);
            opacity: 0.3;
            pointer-events: none;
        }

        /* 成就图标 */
        .achievement-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .achievement-icon svg {
            width: 40px;
            height: 40px;
            stroke: white;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        /* 稀有度徽章 */
        .rarity-badge {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .rarity-common { background: rgba(156, 163, 175, 0.2); color: #6b7280; }
        .rarity-rare { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .rarity-epic { background: rgba(168, 85, 247, 0.2); color: #a855f7; }
        .rarity-legendary { background: rgba(251, 191, 36, 0.2); color: #f59e0b; }

        /* 成就信息 */
        .achievement-name {
            font-size: 19px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .achievement-description {
            font-size: 15px;
            color: var(--text-secondary);
            margin-bottom: 16px;
            line-height: 1.5;
            min-height: 48px;
        }

        .achievement-points {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            background: rgba(251, 191, 36, 0.1);
            color: #f59e0b;
            border-radius: var(--radius-full);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .achievement-points svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
        }

        /* 进度条 */
        .achievement-progress {
            margin-top: 16px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--bg-secondary);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent) 0%, var(--accent-light) 100%);
            border-radius: 3px;
            transition: width var(--transition-normal);
        }

        .progress-text {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        /* 解锁日期 */
        .unlock-date {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 13px;
            color: #34c759;
            margin-top: 12px;
        }

        .unlock-date svg {
            width: 14px;
            height: 14px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        /* 锁定标记 */
        .lock-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 48px;
            height: 48px;
            opacity: 0.15;
            pointer-events: none;
        }

        .lock-icon svg {
            width: 100%;
            height: 100%;
            stroke: var(--text-primary);
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        /* 检测按钮 */
        .detect-btn {
            position: fixed;
            bottom: 32px;
            right: 32px;
            z-index: 100;
        }

        /* 加载/空状态 */
        .loading-state,
        .empty-state {
            text-align: center;
            padding: 80px 20px;
        }

        .loading-state svg,
        .empty-state svg {
            width: 64px;
            height: 64px;
            margin: 0 auto 24px;
            stroke: var(--text-tertiary);
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            opacity: 0.3;
        }

        .loading-state svg {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-state p,
        .empty-state p {
            font-size: 17px;
            color: var(--text-secondary);
        }

        /* 响应式 */
        @media (max-width: 768px) {
            .main-content {
                padding: 60px 16px;
            }

            .page-header {
                margin-bottom: 48px;
            }

            .stats-grid,
            .achievements-grid {
                grid-template-columns: 1fr;
            }

            .category-tabs {
                justify-content: flex-start;
                overflow-x: auto;
                flex-wrap: nowrap;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }

            .category-tabs::-webkit-scrollbar {
                display: none;
            }

            .detect-btn {
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
  <link rel="stylesheet" href="/assets/apple-design-3a23e109.css">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="nav">
        <div class="nav-inner">
            <a href="/index.html" class="nav-logo">学习平台</a>
            <div class="nav-menu">
                <a href="/index.html" class="nav-link">首页</a>
                <a href="/courses.html" class="nav-link">课程</a>
                <a href="/community.html" class="nav-link">社区</a>
                <a href="/pk.html" class="nav-link">PK竞技</a>
            </div>
            <div class="nav-actions">
                <button class="theme-toggle" id="themeToggle" aria-label="切换主题">
                    <svg class="sun-icon" viewBox="0 0 24 24" style="width:16px;height:16px;stroke:currentColor;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3"/>
                        <line x1="12" y1="21" x2="12" y2="23"/>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                        <line x1="1" y1="12" x2="3" y2="12"/>
                        <line x1="21" y1="12" x2="23" y2="12"/>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                    </svg>
                    <svg class="moon-icon" viewBox="0 0 24 24" style="width:16px;height:16px;stroke:currentColor;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;display:none;">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </button>
                <div class="user-menu">
                    <div class="user-avatar" id="userAvatar">U</div>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主内容区 -->
    <main class="main-content">
        <!-- 页面标题 -->
        <div class="page-header">
            <h1>成就中心</h1>
            <p>收集成就，展示荣誉，成为传奇</p>
        </div>

        <!-- 统计概览 -->
        <div class="stats-grid" id="statsGrid">
            <!-- 统计卡片将由 JS 渲染 -->
        </div>

        <!-- 分类标签 -->
        <div class="category-tabs">
            <button class="category-tab active" data-category="ALL">
                <svg viewBox="0 0 24 24">
                    <rect x="3" y="3" width="7" height="7"/>
                    <rect x="14" y="3" width="7" height="7"/>
                    <rect x="14" y="14" width="7" height="7"/>
                    <rect x="3" y="14" width="7" height="7"/>
                </svg>
                全部
            </button>
            <button class="category-tab" data-category="PK">
                <svg viewBox="0 0 24 24">
                    <path d="M6 9l6-6 6 6"/>
                    <path d="M6 15l6 6 6-6"/>
                </svg>
                PK对战
            </button>
            <button class="category-tab" data-category="STUDY">
                <svg viewBox="0 0 24 24">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                </svg>
                学习成长
            </button>
            <button class="category-tab" data-category="SOCIAL">
                <svg viewBox="0 0 24 24">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                社交互动
            </button>
            <button class="category-tab" data-category="COLLECTION">
                <svg viewBox="0 0 24 24">
                    <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/>
                    <line x1="7" y1="7" x2="7.01" y2="7"/>
                </svg>
                收藏达成
            </button>
            <button class="category-tab" data-category="SPECIAL">
                <svg viewBox="0 0 24 24">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                </svg>
                特殊成就
            </button>
        </div>

        <!-- 成就网格 -->
        <div class="achievements-grid" id="achievementsGrid">
            <div class="loading-state">
                <svg viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10"/>
                </svg>
                <p>加载中...</p>
            </div>
        </div>

        <!-- 检测成就按钮 -->
        <button class="btn btn-primary btn-lg detect-btn" id="detectBtn">
            <svg viewBox="0 0 24 24" style="width:20px;height:20px;stroke:white;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;">
                <circle cx="11" cy="11" r="8"/>
                <path d="m21 21-4.35-4.35"/>
            </svg>
            检测新成就
        </button>
    </main>

    <script>
        const API_BASE = '/api';
        let currentCategory = 'ALL';
        let allAchievements = [];

        // 主题切换
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }

        function updateThemeIcon(theme) {
            const sunIcon = document.querySelector('.sun-icon');
            const moonIcon = document.querySelector('.moon-icon');
            if (theme === 'dark') {
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
            } else {
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
            }
        }

        document.getElementById('themeToggle')?.addEventListener('click', () => {
            const current = document.documentElement.getAttribute('data-theme');
            const newTheme = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        });

        // 认证检查
        function checkAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/login.html';
                return false;
            }
            return true;
        }

        // 获取成就数据
        async function fetchAchievements() {
            const token = localStorage.getItem('token');
            try {
                const response = await fetch(`${API_BASE}/achievements`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                if (!response.ok) throw new Error('Failed to fetch achievements');
                const data = await response.json();
                return data.data || [];
            } catch (error) {
                console.error('获取成就失败:', error);
                return [];
            }
        }

        // 获取统计数据
        async function fetchStats() {
            const token = localStorage.getItem('token');
            try {
                const response = await fetch(`${API_BASE}/achievements/stats`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                if (!response.ok) throw new Error('Failed to fetch stats');
                const data = await response.json();
                return data.data || {};
            } catch (error) {
                console.error('获取统计失败:', error);
                return {
                    totalAchievements: 0,
                    unlockedAchievements: 0,
                    totalPoints: 0,
                    completionRate: 0
                };
            }
        }

        // 渲染统计卡片
        function renderStats(stats) {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                        </svg>
                    </div>
                    <div class="stat-value">${stats.totalAchievements || 0}</div>
                    <div class="stat-label">总成就数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                    </div>
                    <div class="stat-value">${stats.unlockedAchievements || 0}</div>
                    <div class="stat-label">已解锁</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                        </svg>
                    </div>
                    <div class="stat-value">${stats.totalPoints || 0}</div>
                    <div class="stat-label">总积分</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6v6l4 2"/>
                        </svg>
                    </div>
                    <div class="stat-value">${(stats.completionRate || 0).toFixed(0)}%</div>
                    <div class="stat-label">完成度</div>
                </div>
            `;
        }

        // 获取成就图标
        function getAchievementIcon(category) {
            const icons = {
                'PK': '<circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8l4 4-4 4"/>',
                'STUDY': '<path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>',
                'SOCIAL': '<path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>',
                'COLLECTION': '<path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/>',
                'SPECIAL': '<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>'
            };
            return icons[category] || icons['SPECIAL'];
        }

        // 获取稀有度颜色
        function getRarityColor(rarity) {
            const colors = {
                'COMMON': '#9ca3af',
                'RARE': '#3b82f6',
                'EPIC': '#a855f7',
                'LEGENDARY': '#f59e0b'
            };
            return colors[rarity] || colors['COMMON'];
        }

        // 渲染成就卡片
        function renderAchievements(achievements) {
            const grid = document.getElementById('achievementsGrid');

            if (achievements.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <svg viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                        </svg>
                        <p>暂无成就数据</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = achievements.map(achievement => {
                const isLocked = !achievement.unlocked;
                const progress = achievement.progress || 0;
                const target = achievement.target || 100;
                const percentage = Math.min((progress / target) * 100, 100);
                const rarityClass = `rarity-${(achievement.rarity || 'common').toLowerCase()}`;
                const rarityColor = getRarityColor(achievement.rarity);

                return `
                    <div class="achievement-card ${isLocked ? 'locked' : ''}">
                        ${achievement.rarity ? `<span class="rarity-badge ${rarityClass}">${achievement.rarity}</span>` : ''}

                        <div class="achievement-icon" style="background: linear-gradient(135deg, ${rarityColor} 0%, ${rarityColor}dd 100%);">
                            <svg viewBox="0 0 24 24">${getAchievementIcon(achievement.category)}</svg>
                        </div>

                        <div class="achievement-name">${achievement.name || '未命名成就'}</div>
                        <div class="achievement-description">${achievement.description || '暂无描述'}</div>

                        ${achievement.points ? `
                            <div class="achievement-points">
                                <svg viewBox="0 0 24 24">
                                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                                </svg>
                                ${achievement.points} 积分
                            </div>
                        ` : ''}

                        ${isLocked && target > 0 ? `
                            <div class="achievement-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${percentage}%"></div>
                                </div>
                                <div class="progress-text">${progress} / ${target}</div>
                            </div>
                        ` : ''}

                        ${achievement.unlocked && achievement.unlockDate ? `
                            <div class="unlock-date">
                                <svg viewBox="0 0 24 24">
                                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                                </svg>
                                ${new Date(achievement.unlockDate).toLocaleDateString('zh-CN')} 解锁
                            </div>
                        ` : ''}

                        ${isLocked ? `
                            <div class="lock-icon">
                                <svg viewBox="0 0 24 24">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                </svg>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // 过滤成就
        function filterAchievements(category) {
            if (category === 'ALL') {
                return allAchievements;
            }
            return allAchievements.filter(a => a.category === category);
        }

        // 分类标签点击
        document.querySelectorAll('.category-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentCategory = tab.dataset.category;
                const filtered = filterAchievements(currentCategory);
                renderAchievements(filtered);
            });
        });

        // 检测新成就
        document.getElementById('detectBtn')?.addEventListener('click', async () => {
            const btn = document.getElementById('detectBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = `
                <svg viewBox="0 0 24 24" style="width:20px;height:20px;stroke:white;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;animation:spin 1s linear infinite;">
                    <circle cx="12" cy="12" r="10"/>
                </svg>
                检测中...
            `;
            btn.disabled = true;

            const token = localStorage.getItem('token');
            try {
                const response = await fetch(`${API_BASE}/achievements/detect`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    await loadData();
                    alert('成就检测完成！');
                } else {
                    alert('检测失败，请稍后重试');
                }
            } catch (error) {
                console.error('检测失败:', error);
                alert('检测失败，请稍后重试');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        });

        // 加载数据
        async function loadData() {
            const [achievements, stats] = await Promise.all([
                fetchAchievements(),
                fetchStats()
            ]);

            allAchievements = achievements;
            renderStats(stats);

            const filtered = filterAchievements(currentCategory);
            renderAchievements(filtered);
        }

        // 初始化
        if (checkAuth()) {
            initTheme();
            loadData();
        }

        // 用户头像点击
        document.getElementById('userAvatar')?.addEventListener('click', () => {
            window.location.href = '/profile.html';
        });
    </script>
</body>
</html>
