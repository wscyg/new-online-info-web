<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的订单 - AI 信息未来</title>
    
    <style>
        /* 订单页面专属样式 */
        body {
            padding-top: 48px;
            background: var(--bg-secondary);
        }

        /* Hero 区域 */
        .orders-hero {
            padding: 64px 0 40px;
            text-align: center;
        }

        .orders-hero h1 {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 12px;
            letter-spacing: -0.03em;
        }

        .orders-hero p {
            font-size: 19px;
            color: var(--text-secondary);
        }

        /* 标签页 */
        .tabs {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            padding: 6px;
            display: flex;
            gap: 6px;
            margin-bottom: 32px;
        }

        .tab {
            flex: 1;
            padding: 12px 16px;
            border-radius: var(--radius-md);
            font-size: 15px;
            font-weight: 500;
            color: var(--text-secondary);
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .tab.active {
            background: var(--accent);
            color: #fff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .tab-count {
            font-size: 13px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: var(--radius-full);
            background: rgba(255, 255, 255, 0.2);
            min-width: 24px;
            text-align: center;
        }

        .tab:not(.active) .tab-count {
            background: var(--bg-hover);
            color: var(--text-tertiary);
        }

        .tab-refresh {
            flex: 0 0 auto;
            padding: 12px 20px;
        }

        /* 订单列表容器 */
        .orders-container {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            padding: 32px;
            min-height: 400px;
        }

        /* 订单项 */
        .order-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 24px;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            margin-bottom: 16px;
            transition: all var(--transition-fast);
        }

        .order-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-card);
        }

        .order-info {
            flex: 1;
        }

        .order-title {
            font-size: 19px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .order-meta {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 4px;
            font-family: var(--font-mono);
        }

        .order-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .order-status {
            padding: 6px 14px;
            border-radius: var(--radius-full);
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
        }

        .status-active {
            background: rgba(52, 199, 89, 0.1);
            color: #34c759;
        }

        .status-pending {
            background: rgba(255, 159, 10, 0.1);
            color: #ff9f0a;
        }

        .status-expired,
        .status-cancelled {
            background: rgba(142, 142, 147, 0.1);
            color: var(--text-tertiary);
        }

        /* 操作按钮 */
        .action-btn {
            padding: 10px 20px;
            border-radius: var(--radius-full);
            font-size: 15px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .btn-pay {
            background: var(--accent);
            color: #fff;
        }

        .btn-pay:hover {
            background: var(--accent-hover);
        }

        .btn-cancel {
            background: var(--bg-hover);
            color: var(--text-secondary);
        }

        .btn-cancel:hover {
            background: rgba(255, 59, 48, 0.1);
            color: #ff3b30;
        }

        .btn-learn {
            background: rgba(52, 199, 89, 0.1);
            color: #34c759;
        }

        .btn-learn:hover {
            background: #34c759;
            color: #fff;
        }

        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 80px 32px;
        }

        .empty-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 24px;
            opacity: 0.3;
        }

        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .empty-state p {
            font-size: 17px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        /* 加载状态 */
        .loading-state {
            text-align: center;
            padding: 80px 32px;
        }

        .error-state {
            text-align: center;
            padding: 80px 32px;
        }

        .error-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            opacity: 0.3;
        }

        /* 提示文本 */
        .timeout-tip {
            color: #ff9f0a;
            font-size: 13px;
            margin-left: 8px;
        }

        /* 响应式 */
        @media (max-width: 768px) {
            .orders-hero h1 {
                font-size: 32px;
            }

            .order-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .order-actions {
                width: 100%;
                justify-content: flex-end;
            }

            .tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .tab {
                flex: 0 0 auto;
                min-width: 100px;
            }
        }

        /* SVG 图标样式 */
        .icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        .icon-sm {
            width: 16px;
            height: 16px;
        }
    </style>
  <link rel="stylesheet" href="/assets/apple-design-5104bdc3.css">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="nav">
        <div class="nav-inner">
            <a href="/home.html" class="nav-logo">AI 信息未来</a>
            <div class="nav-menu">
                <a href="/home.html" class="nav-link">首页</a>
                <a href="/src/pages/courses.html" class="nav-link">课程</a>
                <a href="/src/pages/community.html" class="nav-link">社区</a>
                <a href="/src/pages/arena.html" class="nav-link">PK竞技</a>
            </div>
            <div class="nav-actions">
                <button class="theme-toggle" id="themeToggle" aria-label="切换主题">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path class="sun-icon" d="M12 18C8.68629 18 6 15.3137 6 12C6 8.68629 8.68629 6 12 6C15.3137 6 18 8.68629 18 12C18 15.3137 15.3137 18 12 18ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16ZM11 1H13V4H11V1ZM11 20H13V23H11V20ZM3.51472 4.92893L4.92893 3.51472L7.05025 5.63604L5.63604 7.05025L3.51472 4.92893ZM16.9497 18.364L18.364 16.9497L20.4853 19.0711L19.0711 20.4853L16.9497 18.364ZM19.0711 3.51472L20.4853 4.92893L18.364 7.05025L16.9497 5.63604L19.0711 3.51472ZM5.63604 16.9497L7.05025 18.364L4.92893 20.4853L3.51472 19.0711L5.63604 16.9497ZM23 11V13H20V11H23ZM4 11V13H1V11H4Z"/>
                        <path class="moon-icon" style="display:none;" d="M10 7C10 10.866 13.134 14 17 14C18.9584 14 20.729 13.1957 21.9995 11.8995C22 11.933 22 11.9665 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C12.0335 2 12.067 2 12.1005 2.00049C10.8043 3.27098 10 5.04157 10 7Z"/>
                    </svg>
                </button>
                <div class="user-menu" id="userMenu">
                    <!-- 用户菜单将通过 JS 动态加载 -->
                </div>
            </div>
        </div>
    </nav>

    <!-- 主内容 -->
    <main class="container">
        <!-- Hero 区域 -->
        <div class="orders-hero">
            <h1>我的订单</h1>
            <p>管理您的课程订阅和购买记录</p>
        </div>

        <!-- 标签页 -->
        <div class="tabs">
            <button class="tab active" data-status="all" onclick="filterOrders('all')">
                全部订单
                <span class="tab-count" id="totalCount">0</span>
            </button>
            <button class="tab" data-status="pending" onclick="filterOrders('pending')">
                待支付
                <span class="tab-count" id="pendingCount">0</span>
            </button>
            <button class="tab" data-status="active" onclick="filterOrders('active')">
                已完成
                <span class="tab-count" id="activeCount">0</span>
            </button>
            <button class="tab" data-status="cancelled" onclick="filterOrders('cancelled')">
                已取消
                <span class="tab-count" id="cancelledCount">0</span>
            </button>
            <button class="tab" data-status="expired" onclick="filterOrders('expired')">
                已过期
                <span class="tab-count" id="expiredCount">0</span>
            </button>
            <button class="tab tab-refresh" onclick="loadOrders()">
                <svg class="icon icon-sm" viewBox="0 0 24 24">
                    <path d="M5.46257 4.43262C7.21556 2.91688 9.5007 2 12 2C17.5228 2 22 6.47715 22 12C22 14.1361 21.3302 16.1158 20.1892 17.7406L17 12H20C20 7.58172 16.4183 4 12 4C9.84982 4 7.89777 4.84827 6.46023 6.22842L5.46257 4.43262ZM18.5374 19.5674C16.7844 21.0831 14.4993 22 12 22C6.47715 22 2 17.5228 2 12C2 9.86386 2.66979 7.88416 3.8108 6.25944L7 12H4C4 16.4183 7.58172 20 12 20C14.1502 20 16.1022 19.1517 17.5398 17.7716L18.5374 19.5674Z"/>
                </svg>
            </button>
        </div>

        <!-- 订单列表容器 -->
        <div class="orders-container">
            <!-- 加载状态 -->
            <div id="loadingState" class="loading-state">
                <div class="spinner"></div>
                <p style="margin-top: 16px; color: var(--text-secondary);">正在加载订单信息...</p>
            </div>

            <!-- 错误状态 -->
            <div id="errorState" class="error-state" style="display: none;">
                <svg class="error-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22ZM11 15V17H13V15H11ZM11 7V13H13V7H11Z"/>
                </svg>
                <h3>加载失败</h3>
                <p id="errorMessage">无法获取订单信息，请稍后重试</p>
                <button class="btn btn-primary" onclick="loadOrders()">重新加载</button>
            </div>

            <!-- 订单列表 -->
            <div id="ordersContent" style="display: none;">
                <!-- 订单将通过 JS 动态加载 -->
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script>
        const API_BASE = '/api';
        let allOrders = [];
        let currentFilter = 'all';

        // 主题切换
        function initTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
            updateThemeIcon(theme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            const sunIcon = document.querySelector('.sun-icon');
            const moonIcon = document.querySelector('.moon-icon');
            if (theme === 'dark') {
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
            } else {
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
            }
        }

        // 认证检查
        function checkAuth() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/src/pages/login.html?returnUrl=' + encodeURIComponent(location.pathname);
                return false;
            }
            return true;
        }

        // 初始化用户菜单
        function initUserMenu() {
            const token = localStorage.getItem('token');
            const userMenuEl = document.getElementById('userMenu');

            if (token) {
                const username = localStorage.getItem('username') || '用户';
                userMenuEl.innerHTML = `
                    <div class="user-avatar" onclick="toggleDropdown()">
                        ${username.charAt(0).toUpperCase()}
                    </div>
                    <div class="dropdown" id="userDropdown">
                        <div class="dropdown-item" onclick="location.href='/src/pages/dashboard.html'">
                            <svg class="icon icon-sm" viewBox="0 0 24 24">
                                <path d="M4 22C4 17.5817 7.58172 14 12 14C16.4183 14 20 17.5817 20 22H18C18 18.6863 15.3137 16 12 16C8.68629 16 6 18.6863 6 22H4ZM12 13C8.685 13 6 10.315 6 7C6 3.685 8.685 1 12 1C15.315 1 18 3.685 18 7C18 10.315 15.315 13 12 13ZM12 11C14.21 11 16 9.21 16 7C16 4.79 14.21 3 12 3C9.79 3 8 4.79 8 7C8 9.21 9.79 11 12 11Z" fill="currentColor"/>
                            </svg>
                            学习中心
                        </div>
                        <div class="dropdown-item" onclick="location.href='/src/pages/orders.html'">
                            <svg class="icon icon-sm" viewBox="0 0 24 24">
                                <path d="M6.5 2H17.5C17.776 2 18 2.224 18 2.5V21.5C18 21.776 17.776 22 17.5 22H6.5C6.224 22 6 21.776 6 21.5V2.5C6 2.224 6.224 2 6.5 2ZM8 4V20H16V4H8ZM10 6H14V8H10V6ZM10 9H14V11H10V9ZM10 12H14V14H10V12Z" fill="currentColor"/>
                            </svg>
                            我的订单
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item" onclick="logout()">
                            <svg class="icon icon-sm" viewBox="0 0 24 24">
                                <path d="M5 22C4.44772 22 4 21.5523 4 21V3C4 2.44772 4.44772 2 5 2H19C19.5523 2 20 2.44772 20 3V6H18V4H6V20H18V18H20V21C20 21.5523 19.5523 22 19 22H5ZM18 16V13H11V11H18V8L23 12L18 16Z" fill="currentColor"/>
                            </svg>
                            退出登录
                        </div>
                    </div>
                `;
            }
        }

        function toggleDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        // 点击外部关闭下拉菜单
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.user-menu')) {
                const dropdown = document.getElementById('userDropdown');
                if (dropdown) dropdown.classList.remove('show');
            }
        });

        // 退出登录
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('username');
            window.location.href = '/src/pages/login.html';
        }

        // 加载订单
        async function loadOrders() {
            try {
                showLoading();

                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/subscriptions/my?size=100`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (data.success && data.data) {
                    allOrders = data.data.subscriptions || data.data.list || [];

                    // 预处理订单数据
                    allOrders = allOrders.map(order => {
                        order.formattedAmount = formatAmount(order);
                        return order;
                    });

                    updateOrderStats(allOrders);
                    filterOrders(currentFilter);
                    showContent();
                } else {
                    showError(data.message || '获取订单失败');
                }
            } catch (error) {
                console.error('加载订单失败:', error);
                showError('网络连接失败，请检查网络后重试');
            }
        }

        // 更新订单统计
        function updateOrderStats(orders) {
            const stats = {
                total: orders.length,
                pending: 0,
                active: 0,
                cancelled: 0,
                expired: 0
            };

            orders.forEach(order => {
                if (order.status === 'pending') stats.pending++;
                else if (order.status === 'active') stats.active++;
                else if (order.status === 'cancelled') stats.cancelled++;
                else if (order.status === 'expired') stats.expired++;
            });

            document.getElementById('totalCount').textContent = stats.total;
            document.getElementById('pendingCount').textContent = stats.pending;
            document.getElementById('activeCount').textContent = stats.active;
            document.getElementById('cancelledCount').textContent = stats.cancelled;
            document.getElementById('expiredCount').textContent = stats.expired;
        }

        // 筛选订单
        function filterOrders(status) {
            currentFilter = status;

            // 更新标签状态
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.status === status) {
                    tab.classList.add('active');
                }
            });

            // 筛选订单
            let filteredOrders = allOrders;
            if (status !== 'all') {
                filteredOrders = allOrders.filter(order => order.status === status);
            }

            displayOrders(filteredOrders);
        }

        // 显示订单列表
        function displayOrders(orders) {
            const container = document.getElementById('ordersContent');

            if (!orders || orders.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg class="empty-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6.5 2H17.5C17.776 2 18 2.224 18 2.5V21.5C18 21.776 17.776 22 17.5 22H6.5C6.224 22 6 21.776 6 21.5V2.5C6 2.224 6.224 2 6.5 2ZM8 4V20H16V4H8Z"/>
                        </svg>
                        <h3>暂无订单</h3>
                        <p>您还没有购买任何课程</p>
                        <a href="/src/pages/courses.html" class="btn btn-primary">浏览课程</a>
                    </div>
                `;
                return;
            }

            const ordersHTML = orders.map(order => {
                const statusClass = getStatusClass(order.status);
                const statusText = getStatusText(order.status);
                const isPayable = order.status === 'pending' && isOrderPayable(order.createdAt);
                const actionButtons = getActionButtons(order, isPayable);
                const orderTypeLabel = order.type === 'bundle' ?
                    '<span class="badge badge-primary">课程包</span>' :
                    '<span class="badge">单课程</span>';

                return `
                    <div class="order-item">
                        <div class="order-info">
                            <div class="order-title">
                                ${order.courseName || '未知课程'}
                                ${orderTypeLabel}
                            </div>
                            <div class="order-meta">订单号: ${order.orderNo}</div>
                            <div class="order-meta">创建时间: ${formatDate(order.createdAt)}</div>
                            <div class="order-meta">
                                支付方式: ${getPaymentMethodText(order.paymentMethod)} |
                                金额: ¥${order.formattedAmount}
                                ${!isPayable && order.status === 'pending' ? '<span class="timeout-tip">(订单已超时)</span>' : ''}
                            </div>
                        </div>
                        <div class="order-actions">
                            <span class="order-status ${statusClass}">${statusText}</span>
                            ${actionButtons}
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = ordersHTML;
        }

        // 获取操作按钮
        function getActionButtons(order, isPayable) {
            if (order.status === 'pending') {
                return `
                    <button class="action-btn btn-pay" onclick="continuePayment('${order.id}', '${order.orderNo}', '${order.courseName || '课程'}', ${order.amount}, '${order.subscribableType || 'course'}', ${order.subscribableId || order.courseId || 1})">
                        立即支付
                    </button>
                    <button class="action-btn btn-cancel" onclick="cancelOrder('${order.id}', '${order.courseName || '课程'}')">
                        取消订单
                    </button>
                `;
            } else if (order.status === 'active') {
                return `
                    <button class="action-btn btn-learn" onclick="goToLearn(${order.subscribableId || order.courseId})">
                        去学习
                    </button>
                `;
            }
            return '';
        }

        // 继续支付
        async function continuePayment(subscriptionId, orderNo, courseName, amount, subscribableType, subscribableId) {
            try {
                const params = new URLSearchParams({
                    orderNo: orderNo,
                    courseId: subscribableId,
                    type: subscribableType === 'bundle' ? 'bundle' : 'course',
                    courseName: courseName,
                    continuePayment: 'true'
                });

                if (subscribableType === 'bundle') {
                    params.set('bundleId', subscribableId);
                }

                window.location.href = `/src/pages/payment.html?${params.toString()}`;
            } catch (error) {
                console.error('继续支付失败:', error);
                alert('支付失败，请稍后重试');
            }
        }

        // 取消订单
        async function cancelOrder(subscriptionId, courseName) {
            if (!confirm(`确定要取消订单吗？\n课程：${courseName}`)) {
                return;
            }

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/subscriptions/${subscriptionId}/cancel`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    alert('订单已取消');
                    loadOrders();
                } else {
                    alert(`取消失败：${data.message || '未知错误'}`);
                }
            } catch (error) {
                console.error('取消订单失败:', error);
                alert('取消订单失败，请稍后重试');
            }
        }

        // 去学习
        function goToLearn(courseId) {
            window.location.href = '/src/pages/my-courses.html';
        }

        // 工具函数
        function isOrderPayable(createdAt) {
            if (!createdAt) return false;
            const orderTime = new Date(createdAt);
            const now = new Date();
            const diffMinutes = (now - orderTime) / (1000 * 60);
            return diffMinutes <= 30;
        }

        function getStatusClass(status) {
            const classes = {
                'active': 'status-active',
                'pending': 'status-pending',
                'expired': 'status-expired',
                'cancelled': 'status-cancelled'
            };
            return classes[status] || 'status-pending';
        }

        function getStatusText(status) {
            const texts = {
                'active': '已支付',
                'pending': '待支付',
                'expired': '已过期',
                'cancelled': '已取消'
            };
            return texts[status] || '未知';
        }

        function getPaymentMethodText(method) {
            const methods = {
                'alipay': '支付宝',
                'wechat': '微信支付',
                'card': '银行卡',
                'balance': '账户余额',
                'free': '免费'
            };
            return methods[method] || '未知';
        }

        function formatDate(dateString) {
            if (!dateString) return '未知时间';

            if (Array.isArray(dateString) && dateString.length >= 3) {
                const [year, month, day, hour = 0, minute = 0, second = 0] = dateString;
                const date = new Date(year, month - 1, day, hour, minute, second);
                return date.toLocaleDateString('zh-CN') + ' ' + date.toLocaleTimeString('zh-CN');
            }

            const date = new Date(dateString);
            if (isNaN(date.getTime())) return '时间格式错误';
            return date.toLocaleDateString('zh-CN') + ' ' + date.toLocaleTimeString('zh-CN');
        }

        function formatAmount(order) {
            if (typeof order === 'number') {
                return order.toFixed(2);
            }

            if (typeof order === 'object' && order !== null) {
                const possibleFields = ['amount', 'price', 'totalAmount', 'finalPrice', 'cost'];
                for (const field of possibleFields) {
                    const value = order[field];
                    if (value !== null && value !== undefined) {
                        const num = parseFloat(value);
                        if (!isNaN(num)) {
                            return num.toFixed(2);
                        }
                    }
                }
            }

            if (typeof order === 'string') {
                const num = parseFloat(order);
                if (!isNaN(num)) {
                    return num.toFixed(2);
                }
            }

            return '0.00';
        }

        function showLoading() {
            document.getElementById('loadingState').style.display = 'block';
            document.getElementById('errorState').style.display = 'none';
            document.getElementById('ordersContent').style.display = 'none';
        }

        function showError(message) {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('errorState').style.display = 'block';
            document.getElementById('ordersContent').style.display = 'none';
            document.getElementById('errorMessage').textContent = message;
        }

        function showContent() {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('errorState').style.display = 'none';
            document.getElementById('ordersContent').style.display = 'block';
        }

        // 页面初始化
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);

            if (checkAuth()) {
                initUserMenu();
                loadOrders();

                // 自动刷新待支付订单
                setInterval(() => {
                    if (currentFilter === 'pending' || currentFilter === 'all') {
                        loadOrders();
                    }
                }, 30000);
            }
        });
    </script>
</body>
</html>
