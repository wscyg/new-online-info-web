/**\n * 现代化首页脚本\n * 处理首页的交互功能和动画效果\n */\n\nimport { Component, NotificationSystem, LoadingSpinner, Modal, utils } from '../components/modern-ui.js';\nimport { AuthManager } from '../store/auth.js';\n\nclass HomePage {\n  constructor() {\n    this.isLoading = false;\n    this.courses = [];\n    this.init();\n  }\n\n  async init() {\n    this.setupEventListeners();\n    this.setupAnimations();\n    this.setupTheme();\n    await this.loadCourses();\n    this.setupScrollEffects();\n    this.updateAuthState();\n  }\n\n  setupEventListeners() {\n    // 移动端菜单切换\n    const mobileMenuBtn = document.getElementById('mobileMenuBtn');\n    const mobileMenu = document.getElementById('mobileMenu');\n    \n    mobileMenuBtn?.addEventListener('click', () => {\n      mobileMenu.classList.toggle('hidden');\n    });\n\n    // 用户菜单切换\n    window.toggleUserMenu = () => {\n      const userMenu = document.getElementById('userMenu');\n      userMenu?.classList.toggle('hidden');\n    };\n\n    // 点击外部关闭菜单\n    document.addEventListener('click', (e) => {\n      const userMenu = document.getElementById('userMenu');\n      const userProfile = document.getElementById('userProfile');\n      \n      if (userMenu && !userProfile?.contains(e.target)) {\n        userMenu.classList.add('hidden');\n      }\n    });\n\n    // 主题切换\n    window.toggleTheme = () => {\n      window.appStateManager.toggleTheme();\n    };\n\n    // 退出登录\n    window.handleLogout = () => {\n      window.authManager.logout();\n    };\n\n    // 平滑滚动\n    document.querySelectorAll('a[href^=\"#\"]').forEach(anchor => {\n      anchor.addEventListener('click', function (e) {\n        e.preventDefault();\n        const target = document.querySelector(this.getAttribute('href'));\n        if (target) {\n          target.scrollIntoView({\n            behavior: 'smooth',\n            block: 'start'\n          });\n        }\n      });\n    });\n\n    // 联系表单提交\n    const contactForm = document.getElementById('contactForm');\n    contactForm?.addEventListener('submit', this.handleContactSubmit.bind(this));\n\n    // 回到顶部按钮\n    const backToTop = document.getElementById('backToTop');\n    backToTop?.addEventListener('click', () => {\n      window.scrollTo({ top: 0, behavior: 'smooth' });\n    });\n  }\n\n  setupAnimations() {\n    // 设置交叉观察器用于滚动动画\n    const observerOptions = {\n      threshold: 0.1,\n      rootMargin: '0px 0px -50px 0px'\n    };\n\n    const observer = new IntersectionObserver((entries) => {\n      entries.forEach(entry => {\n        if (entry.isIntersecting) {\n          entry.target.classList.add('animate-slide-up');\n        }\n      });\n    }, observerOptions);\n\n    // 观察需要动画的元素\n    document.querySelectorAll('.card, .course-card').forEach(el => {\n      observer.observe(el);\n    });\n  }\n\n  setupTheme() {\n    // 初始化主题\n    const themeToggle = document.getElementById('themeToggle');\n    const currentTheme = localStorage.getItem('theme') || 'light';\n    \n    if (currentTheme === 'dark') {\n      document.documentElement.classList.add('dark');\n    }\n\n    themeToggle?.addEventListener('click', () => {\n      document.documentElement.classList.toggle('dark');\n      const isDark = document.documentElement.classList.contains('dark');\n      localStorage.setItem('theme', isDark ? 'dark' : 'light');\n    });\n  }\n\n  async loadCourses() {\n    try {\n      const courseGrid = document.getElementById('courseGrid');\n      if (!courseGrid) return;\n\n      // 显示加载状态\n      this.setLoading(true);\n\n      // 模拟API调用 - 实际项目中替换为真实API\n      const mockCourses = [\n        {\n          id: 1,\n          title: '机器学习基础',\n          description: '从零开始学习机器学习的核心概念和算法',\n          image: 'https://images.unsplash.com/photo-1555949963-aa79dcee981c?w=400&h=300&fit=crop',\n          price: 299,\n          originalPrice: 499,\n          rating: 4.8,\n          students: 1234,\n          level: '初级',\n          duration: '12周',\n          tags: ['机器学习', 'Python', '数据科学']\n        },\n        {\n          id: 2,\n          title: '深度学习实战',\n          description: '深入理解神经网络，掌握深度学习核心技术',\n          image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=300&fit=crop',\n          price: 399,\n          originalPrice: 699,\n          rating: 4.9,\n          students: 892,\n          level: '中级',\n          duration: '16周',\n          tags: ['深度学习', 'TensorFlow', 'PyTorch']\n        },\n        {\n          id: 3,\n          title: '自然语言处理',\n          description: '掌握NLP技术，构建智能对话系统',\n          image: 'https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=400&h=300&fit=crop',\n          price: 349,\n          originalPrice: 599,\n          rating: 4.7,\n          students: 567,\n          level: '中级',\n          duration: '14周',\n          tags: ['NLP', 'BERT', 'Transformer']\n        }\n      ];\n\n      // 模拟网络延迟\n      await new Promise(resolve => setTimeout(resolve, 1000));\n\n      this.courses = mockCourses;\n      this.renderCourses();\n    } catch (error) {\n      console.error('加载课程失败:', error);\n      window.appState.setState('notification', {\n        type: 'error',\n        title: '加载失败',\n        message: '无法加载课程信息，请稍后重试'\n      });\n    } finally {\n      this.setLoading(false);\n    }\n  }\n\n  renderCourses() {\n    const courseGrid = document.getElementById('courseGrid');\n    if (!courseGrid) return;\n\n    // 清除骨架屏\n    courseGrid.innerHTML = '';\n\n    this.courses.forEach(course => {\n      const courseCard = this.createCourseCard(course);\n      courseGrid.appendChild(courseCard);\n    });\n  }\n\n  createCourseCard(course) {\n    const card = document.createElement('div');\n    card.className = 'course-card card card-hover overflow-hidden group cursor-pointer';\n    card.onclick = () => this.viewCourse(course.id);\n\n    card.innerHTML = `\n      <div class=\"relative\">\n        <img src=\"${course.image}\" alt=\"${course.title}\" class=\"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300\">\n        <div class=\"absolute top-4 left-4\">\n          <span class=\"badge badge-primary\">${course.level}</span>\n        </div>\n        <div class=\"absolute top-4 right-4\">\n          <div class=\"bg-black/50 text-white px-2 py-1 rounded text-sm\">\n            ${course.duration}\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"p-6\">\n        <h3 class=\"text-xl font-bold mb-2 group-hover:text-primary-600 transition-colors\">${course.title}</h3>\n        <p class=\"text-gray-600 dark:text-gray-300 mb-4 text-ellipsis-2\">${course.description}</p>\n        \n        <div class=\"flex items-center space-x-2 mb-4\">\n          <div class=\"flex items-center text-yellow-500\">\n            ${'★'.repeat(Math.floor(course.rating))}\n            <span class=\"text-gray-500 ml-1\">${course.rating}</span>\n          </div>\n          <span class=\"text-gray-400\">•</span>\n          <span class=\"text-gray-500\">${course.students} 学员</span>\n        </div>\n        \n        <div class=\"flex flex-wrap gap-2 mb-4\">\n          ${course.tags.map(tag => `<span class=\"badge badge-secondary text-xs\">${tag}</span>`).join('')}\n        </div>\n        \n        <div class=\"flex items-center justify-between\">\n          <div class=\"flex items-center space-x-2\">\n            <span class=\"text-2xl font-bold text-primary-600\">¥${course.price}</span>\n            <span class=\"text-gray-400 line-through\">¥${course.originalPrice}</span>\n          </div>\n          <button class=\"btn-primary btn-sm\" onclick=\"event.stopPropagation(); window.addToCart(${course.id})\">\n            立即购买\n          </button>\n        </div>\n      </div>\n    `;\n\n    return card;\n  }\n\n  viewCourse(courseId) {\n    window.location.href = `src/pages/course-detail.html?id=${courseId}`;\n  }\n\n  setupScrollEffects() {\n    const navbar = document.getElementById('navbar');\n    const backToTop = document.getElementById('backToTop');\n\n    window.addEventListener('scroll', utils.throttle(() => {\n      const scrollY = window.scrollY;\n\n      // 导航栏背景透明度\n      if (scrollY > 50) {\n        navbar?.classList.add('bg-white/95', 'dark:bg-gray-900/95');\n        navbar?.classList.remove('bg-white/80', 'dark:bg-gray-900/80');\n      } else {\n        navbar?.classList.remove('bg-white/95', 'dark:bg-gray-900/95');\n        navbar?.classList.add('bg-white/80', 'dark:bg-gray-900/80');\n      }\n\n      // 回到顶部按钮\n      if (scrollY > 300) {\n        backToTop?.classList.remove('opacity-0', 'pointer-events-none');\n        backToTop?.classList.add('opacity-100');\n      } else {\n        backToTop?.classList.add('opacity-0', 'pointer-events-none');\n        backToTop?.classList.remove('opacity-100');\n      }\n    }, 100));\n  }\n\n  async handleContactSubmit(e) {\n    e.preventDefault();\n    const form = e.target;\n    const formData = new FormData(form);\n    \n    try {\n      this.setLoading(true);\n      \n      // 模拟API调用\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      \n      window.appState.setState('notification', {\n        type: 'success',\n        title: '发送成功',\n        message: '您的消息已发送，我们会尽快回复您'\n      });\n      \n      form.reset();\n    } catch (error) {\n      window.appState.setState('notification', {\n        type: 'error',\n        title: '发送失败',\n        message: '消息发送失败，请稍后重试'\n      });\n    } finally {\n      this.setLoading(false);\n    }\n  }\n\n  updateAuthState() {\n    const authContainer = document.getElementById('authContainer');\n    const userProfile = document.getElementById('userProfile');\n    \n    if (window.authManager.isAuthenticated) {\n      authContainer?.classList.add('hidden');\n      userProfile?.classList.remove('hidden');\n      \n      // 更新用户信息\n      const userName = document.getElementById('userName');\n      const userAvatar = document.getElementById('userAvatar');\n      \n      if (userName && window.authManager.user) {\n        userName.textContent = window.authManager.user.nickname || window.authManager.user.username;\n      }\n      \n      if (userAvatar && window.authManager.user?.avatar) {\n        userAvatar.src = window.authManager.user.avatar;\n      }\n    } else {\n      authContainer?.classList.remove('hidden');\n      userProfile?.classList.add('hidden');\n    }\n  }\n\n  setLoading(loading) {\n    this.isLoading = loading;\n    window.appStateManager.setLoading(loading);\n  }\n}\n\n// 全局函数\nwindow.addToCart = (courseId) => {\n  if (!window.authManager.requireAuth()) return;\n  \n  window.appState.setState('notification', {\n    type: 'success',\n    title: '添加成功',\n    message: '课程已添加到购物车'\n  });\n  \n  // 这里可以添加实际的购物车逻辑\n  console.log('添加课程到购物车:', courseId);\n};\n\n// 初始化首页\ndocument.addEventListener('DOMContentLoaded', () => {\n  new HomePage();\n});\n\n// 导出首页类\nexport default HomePage;