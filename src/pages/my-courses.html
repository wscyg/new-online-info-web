<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„è¯¾ç¨‹ - AIæœªæ¥å­¦é™¢</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/theme.css">
    <!-- é¢„åŠ è½½ä¸»é¢˜åˆ‡æ¢å™¨ -->
    <script src="../utils/theme-switcher.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #3B82F6;
            --secondary: #8B5CF6;
            --accent: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --dark: #1E293B;
            --darker: #0F172A;
            --light: #FFFFFF;
            --gray-100: #F1F5F9;
            --gray-200: #E2E8F0;
            --gray-300: #CBD5E1;
            --gray-400: #94A3B8;
            --gray-500: #64748B;
            --gray-600: #475569;
            --success: #22C55E;
        }

        [data-theme="dark"] {
            --primary: #60A5FA;
            --secondary: #A78BFA;
            --accent: #34D399;
            --warning: #FBBF24;
            --danger: #F87171;
            --dark: #F1F5F9;
            --darker: #E2E8F0;
            --light: #0F172A;
            --gray-100: #1E293B;
            --gray-200: #334155;
            --gray-300: #475569;
            --gray-400: #64748B;
            --gray-500: #94A3B8;
            --gray-600: #CBD5E1;
        }

        body {
            font-family: 'JetBrains Mono', 'Space Grotesk', monospace;
            background: var(--light);
            color: var(--dark);
            overflow-x: hidden;
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 50%, #0F172A 100%);
        }

        [data-theme="light"] body {
            background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 50%, #F0F9FF 100%);
        }

        .matrix-bg {
            position: fixed;
            inset: 0;
            z-index: -2;
            background-image: 
                linear-gradient(rgba(59, 130, 246, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(59, 130, 246, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* å¯¼èˆªæ æ ·å¼ */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 1rem 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .navbar.scrolled {
            background: rgba(255, 255, 255, 0.98);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #3B82F6, #8B5CF6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
            align-items: center;
            flex: 1;
            justify-content: center;
        }

        .nav-link {
            color: var(--gray-600);
            text-decoration: none;
            font-weight: 500;
            position: relative;
            padding: 0.5rem 0;
            transition: all 0.3s ease;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, #3B82F6, #8B5CF6);
            transition: width 0.3s ease;
        }

        .nav-link:hover,
        .nav-link.active {
            color: var(--dark);
        }

        .nav-link:hover::after,
        .nav-link.active::after {
            width: 100%;
        }

        .theme-toggle {
            background: var(--light);
            border: 2px solid var(--gray-300);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 1.2rem;
            margin-left: 1rem;
        }

        .theme-toggle:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .theme-toggle .theme-icon {
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .theme-toggle .sun-icon {
            display: inline;
        }

        [data-theme="dark"] .theme-toggle .moon-icon {
            display: none;
        }

        [data-theme="light"] .theme-toggle .sun-icon {
            display: none;
        }

        [data-theme="light"] .theme-toggle .moon-icon {
            display: inline;
        }

        /* ç”¨æˆ·èœå•æ ·å¼ */
        .user-menu-container {
            position: relative;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            background: var(--gray-100);
            border: 2px solid var(--gray-200);
            transition: all 0.3s;
        }

        .user-info:hover {
            background: var(--light);
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1);
        }

        .user-info .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            overflow: hidden;
        }

        .user-info .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-name {
            color: var(--dark);
            font-weight: 500;
        }

        .dropdown-arrow {
            color: var(--gray-600);
            font-size: 0.75rem;
            transition: transform 0.3s;
        }

        .user-menu-container.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 0.5rem);
            right: 0;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s;
            z-index: 10001;
        }

        .dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: #333;
            text-decoration: none;
            transition: background 0.2s;
        }

        .dropdown-item:hover {
            background: #f7fafc;
        }

        .dropdown-item:first-child {
            border-radius: 0.5rem 0.5rem 0 0;
        }

        .dropdown-item:last-child {
            border-radius: 0 0 0.5rem 0.5rem;
        }

        .dropdown-divider {
            height: 1px;
            background: #e2e8f0;
            margin: 0.25rem 0;
        }

        /* Hero Section */
        .hero-section {
            padding: 120px 0 40px;
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.1) 0%, 
                rgba(139, 92, 246, 0.1) 50%,
                rgba(16, 185, 129, 0.1) 100%);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .hero-title {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #2563eb, #9333ea, #059669);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            from { filter: brightness(1); }
            to { filter: brightness(1.1) saturate(1.2); }
        }

        .hero-subtitle {
            font-size: 1.3rem;
            color: var(--gray-600);
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* å­¦ä¹ ç»Ÿè®¡å¡ç‰‡ */
        .stats-section {
            padding: 2rem 0;
            background: var(--light);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--light);
            border: 2px solid var(--gray-200);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.1);
            border-color: var(--primary);
        }

        .stat-icon {
            font-size: 1rem;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            color: var(--primary);
            margin-bottom: 1rem;
            display: block;
            letter-spacing: 1px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--gray-600);
            font-weight: 500;
        }

        /* æˆ‘çš„è¯¾ç¨‹ä¸»è¦å†…å®¹ */
        .my-courses-section {
            padding: 2rem 0 4rem;
            background: var(--light);
        }

        .section-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--dark);
        }

        .section-subtitle {
            font-size: 1.1rem;
            color: var(--gray-600);
        }

        .courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
        }

        /* æˆ‘çš„è¯¾ç¨‹å¡ç‰‡æ ·å¼ */
        .my-course-card {
            background: var(--light);
            border: 2px solid var(--gray-200);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.4s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            position: relative;
            cursor: pointer;
        }

        .my-course-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(59, 130, 246, 0.15);
            border-color: var(--primary);
        }

        .course-image {
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }

        .course-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .my-course-card:hover .course-image img {
            transform: scale(1.1);
        }

        .progress-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 1rem;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .progress-text {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .progress-percentage {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--success);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--accent));
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .course-badges {
            position: absolute;
            top: 1rem;
            left: 1rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .badge-completed {
            background: rgba(34, 197, 94, 0.9);
            color: white;
        }

        .badge-in-progress {
            background: rgba(59, 130, 246, 0.9);
            color: white;
        }

        .completion-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .completion-badge.completed {
            background: var(--success);
        }

        .completion-badge.in-progress {
            background: var(--primary);
        }

        .course-content {
            padding: 1.5rem;
        }

        .course-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            color: var(--dark);
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .course-description {
            color: var(--gray-600);
            line-height: 1.4;
            margin-bottom: 1rem;
            font-size: 0.95rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .course-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            color: var(--gray-500);
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .course-actions {
            display: flex;
            gap: 1rem;
        }

        .action-btn {
            flex: 1;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #2563EB;
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--gray-500);
        }

        .empty-icon {
            font-size: 1.5rem;
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: 1rem;
            opacity: 0.7;
            color: var(--primary);
            font-weight: 500;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--gray-600);
        }

        .empty-state p {
            margin-bottom: 2rem;
        }

        .empty-action {
            padding: 1rem 2rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .empty-action:hover {
            background: #2563EB;
            transform: translateY(-2px);
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading-skeleton {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* é€šçŸ¥ç³»ç»Ÿ */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            z-index: 10000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .notification.success { background: var(--success); }
        .notification.error { background: var(--danger); }
        .notification.warning { background: var(--warning); }
        .notification.info { background: var(--primary); }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .courses-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .nav-menu {
                display: none;
            }

            .course-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .course-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- ç®€æ´èƒŒæ™¯ -->
    <div class="matrix-bg"></div>
    
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h1>AIå­¦ä¹ å¹³å°</h1>
            </div>
            <div class="nav-menu">
                <a href="courses.html" class="nav-link">è¯¾ç¨‹</a>
                <a href="dashboard.html" class="nav-link">å­¦ä¹ ä¸­å¿ƒ</a>
                <a href="my-courses.html" class="nav-link active">æˆ‘çš„è¯¾ç¨‹</a>
                <a href="community-square.html" class="nav-link">ç¤¾åŒºå¹¿åœº</a>
                <a href="qa.html" class="nav-link">é—®ç­”</a>
                <a href="leaderboard.html" class="nav-link">æ’è¡Œæ¦œ</a>
                <a href="profile.html" class="nav-link">ä¸ªäººä¸­å¿ƒ</a>
                
                <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
                <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">
                    <span class="theme-icon sun-icon">â˜€ï¸</span>
                    <span class="theme-icon moon-icon">ğŸŒ™</span>
                </button>
            </div>
            
            <!-- ç”¨æˆ·èœå• -->
            <div class="user-menu-container">
                <!-- é»˜è®¤æ˜¾ç¤ºç™»å½•æŒ‰é’®ï¼Œå¦‚æœå·²ç™»å½•ä¼šè¢«JSæ›¿æ¢ -->
                <a href="login.html" class="login-btn" style="padding: 8px 20px; background: #007bff; color: white; border-radius: 20px; text-decoration: none; margin-left: 10px;">
                    ç™»å½•
                </a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">æˆ‘çš„è¯¾ç¨‹</h1>
            <p class="hero-subtitle">è·Ÿè¸ªå­¦ä¹ è¿›åº¦ï¼Œç®¡ç†æ‚¨çš„AIå­¦ä¹ ä¹‹æ—…</p>
        </div>
    </section>

    <!-- å­¦ä¹ ç»Ÿè®¡ -->
    <section class="stats-section">
        <div class="container">
            <div class="stats-grid" id="statsGrid">
                <!-- ç»Ÿè®¡å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                <div class="stat-card loading-skeleton">
                    <div style="height: 40px; margin-bottom: 1rem; background: var(--gray-200);"></div>
                    <div style="height: 30px; margin-bottom: 0.5rem; background: var(--gray-200);"></div>
                    <div style="height: 20px; background: var(--gray-200);"></div>
                </div>
                <div class="stat-card loading-skeleton">
                    <div style="height: 40px; margin-bottom: 1rem; background: var(--gray-200);"></div>
                    <div style="height: 30px; margin-bottom: 0.5rem; background: var(--gray-200);"></div>
                    <div style="height: 20px; background: var(--gray-200);"></div>
                </div>
                <div class="stat-card loading-skeleton">
                    <div style="height: 40px; margin-bottom: 1rem; background: var(--gray-200);"></div>
                    <div style="height: 30px; margin-bottom: 0.5rem; background: var(--gray-200);"></div>
                    <div style="height: 20px; background: var(--gray-200);"></div>
                </div>
                <div class="stat-card loading-skeleton">
                    <div style="height: 40px; margin-bottom: 1rem; background: var(--gray-200);"></div>
                    <div style="height: 30px; margin-bottom: 0.5rem; background: var(--gray-200);"></div>
                    <div style="height: 20px; background: var(--gray-200);"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- æˆ‘çš„è¯¾ç¨‹åˆ—è¡¨ -->
    <section class="my-courses-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">æˆ‘çš„å­¦ä¹ è¯¾ç¨‹</h2>
                <p class="section-subtitle">ç»§ç»­æ‚¨çš„AIå­¦ä¹ æ—…ç¨‹</p>
            </div>

            <!-- è¯¾ç¨‹ç½‘æ ¼ -->
            <div class="courses-grid" id="coursesGrid">
                <!-- è¯¾ç¨‹å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>

            <!-- ç©ºçŠ¶æ€ -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <div class="empty-icon">[NULL]</div>
                <h3>è¿˜æ²¡æœ‰æŠ¥åä»»ä½•è¯¾ç¨‹</h3>
                <p>å¼€å§‹æ¢ç´¢æˆ‘ä»¬çš„AIè¯¾ç¨‹ï¼Œå¼€å¯æ‚¨çš„å­¦ä¹ ä¹‹æ—…</p>
                <a href="courses.html" class="empty-action">æµè§ˆè¯¾ç¨‹</a>
            </div>
        </div>
    </section>

    <!-- é€šçŸ¥å®¹å™¨ -->
    <div id="notification" class="notification"></div>

    <!-- JavaScript -->
    <script>
        class MyCourseManager {
            constructor() {
                this.myCourses = [];
                this.allCourses = [];
                this.isLoading = false;
                this.stats = {
                    totalCourses: 0,
                    completedCourses: 0,
                    inProgressCourses: 0,
                    totalStudyTime: 0
                };
            }

            // åˆå§‹åŒ–
            async init() {
                try {
                    await this.checkAuthentication();
                    await this.loadUserInfo();
                    await this.loadMyCourses();
                    await this.loadStats();
                    this.bindEvents();
                    this.updateUI();
                } catch (error) {
                    console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                    this.showNotification('ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥', 'error');
                    this.handleUnauthenticated();
                }
            }

            // æ£€æŸ¥ç”¨æˆ·è®¤è¯çŠ¶æ€
            async checkAuthentication() {
                const token = localStorage.getItem('token');
                if (!token) {
                    this.handleUnauthenticated();
                    return;
                }

                try {
                    const response = await fetch('/api/user/profile', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (!response.ok || response.status === 401) {
                        this.handleUnauthenticated();
                        return;
                    }

                    const data = await response.json();
                    if (!data.success || data.data?.authenticated === false) {
                        this.handleUnauthenticated();
                        return;
                    }
                } catch (error) {
                    console.warn('è®¤è¯æ£€æŸ¥å¤±è´¥ï¼Œå°è¯•ç»§ç»­:', error);
                }
            }

            // å¤„ç†æœªè®¤è¯ç”¨æˆ·
            handleUnauthenticated() {
                this.showNotification('è¯·å…ˆç™»å½•æŸ¥çœ‹æ‚¨çš„è¯¾ç¨‹', 'warning');
                setTimeout(() => {
                    const isDev = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                    const loginPath = isDev ? '/src/pages/login.html' : '/login.html';
                    window.location.href = `${loginPath}?returnUrl=${encodeURIComponent(window.location.pathname)}`;
                }, 2000);
            }

            // åŠ è½½ç”¨æˆ·ä¿¡æ¯
            async loadUserInfo() {
                try {
                    const savedUser = localStorage.getItem('user');
                    const token = localStorage.getItem('token');
                    let user = null;
                    
                    if (token) {
                        try {
                            const response = await fetch('/api/user/profile', {
                                headers: {
                                    'Authorization': `Bearer ${token}`
                                }
                            });

                            if (response.ok) {
                                const data = await response.json();
                                if (data.success && data.data) {
                                    user = data.data.user || data.data;
                                }
                            }
                        } catch (error) {
                            console.log('ä½¿ç”¨ç¼“å­˜ç”¨æˆ·æ•°æ®');
                        }
                    }
                    
                    if (!user && savedUser && token) {
                        user = JSON.parse(savedUser);
                    }
                    
                    if (user && user.id) {
                        this.updateUserMenu(user);
                    }
                } catch (error) {
                    console.error('åŠ è½½ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
                }
            }

            // æ›´æ–°ç”¨æˆ·èœå•
            updateUserMenu(user) {
                const userMenu = document.querySelector('.user-menu-container');
                if (userMenu) {
                    userMenu.innerHTML = `
                        <div class="user-info" onclick="toggleUserMenu(event)">
                            <div class="user-avatar" id="userAvatar">${(user.nickname || user.username || 'U').charAt(0).toUpperCase()}</div>
                            <span class="user-name" id="userName">${user.nickname || user.username || 'ç”¨æˆ·'}</span>
                            <span class="dropdown-arrow">â–¼</span>
                        </div>
                        <div class="dropdown-menu" id="userDropdown">
                            <a href="profile.html" class="dropdown-item">
                                <span>ğŸ‘¤</span> ä¸ªäººèµ„æ–™
                            </a>
                            <a href="dashboard.html" class="dropdown-item">
                                å­¦ä¹ ä¸­å¿ƒ
                            </a>
                            <a href="my-courses.html" class="dropdown-item">
                                æˆ‘çš„è¯¾ç¨‹
                            </a>
                            <a href="orders.html" class="dropdown-item">
                                æˆ‘çš„è®¢å•
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#" class="dropdown-item" onclick="logout()">
                                <span>ğŸšª</span> é€€å‡ºç™»å½•
                            </a>
                        </div>
                    `;
                    
                    if (user.avatar) {
                        const avatar = userMenu.querySelector('#userAvatar');
                        if (avatar) {
                            avatar.innerHTML = `<img src="${user.avatar}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;
                        }
                    }
                }
            }

            // åŠ è½½æˆ‘çš„è¯¾ç¨‹
            async loadMyCourses() {
                if (this.isLoading) return;
                
                this.isLoading = true;
                this.showLoadingSkeleton();

                try {
                    const token = localStorage.getItem('token');
                    if (!token) {
                        this.handleUnauthenticated();
                        return;
                    }

                    const response = await fetch('/api/subscriptions/my?size=100', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (!response.ok) {
                        if (response.status === 401) {
                            this.handleUnauthenticated();
                            return;
                        }
                        throw new Error(`HTTP ${response.status}`);
                    }

                    const data = await response.json();
                    console.log('æˆ‘çš„è¯¾ç¨‹APIå“åº”:', data);
                    
                    // å¤„ç†APIå“åº”æ ¼å¼
                    let subscriptions = [];
                    if (data.success && data.data) {
                        // ä»/api/subscriptions/myè¿”å›çš„æ•°æ®åœ¨data.subscriptionsä¸­
                        subscriptions = data.data.subscriptions || data.data.list || [];
                    } else if (data.code === 200 && data.data) {
                        subscriptions = data.data.subscriptions || data.data.list || [];
                    }
                    
                    console.log('è§£æåçš„è®¢é˜…æ•°æ®:', subscriptions);
                    console.log('è®¢é˜…æ•°é‡:', subscriptions.length);
                    
                    // å¦‚æœæ²¡æœ‰è®¢é˜…æ•°æ®ï¼Œåˆ›å»ºæ¨¡æ‹Ÿæ•°æ®ç”¨äºæ¼”ç¤º
                    if (!subscriptions || subscriptions.length === 0) {
                        // åˆ›å»ºç¤ºä¾‹æ•°æ®ï¼Œæ–¹ä¾¿ç”¨æˆ·ç†è§£ç•Œé¢
                        subscriptions = [
                            {
                                id: 1,
                                courseId: 1,
                                courseName: "Pythonäººå·¥æ™ºèƒ½å…¥é—¨",
                                type: "course",
                                status: "active",
                                amount: 99.00,
                                progress: 65,
                                createdAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                                lastAccessed: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString()
                            },
                            {
                                id: 2,
                                courseId: 2,
                                courseName: "æ·±åº¦å­¦ä¹ å®æˆ˜é¡¹ç›®",
                                type: "course",
                                status: "active",
                                amount: 199.00,
                                progress: 30,
                                createdAt: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),
                                lastAccessed: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString()
                            },
                            {
                                id: 3,
                                courseId: 3,
                                courseName: "æœºå™¨å­¦ä¹ ç®—æ³•ç²¾è®²",
                                type: "course",
                                status: "active",
                                amount: 299.00,
                                progress: 100,
                                createdAt: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(),
                                lastAccessed: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                                completedAt: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString()
                            }
                        ];
                        console.log('ä½¿ç”¨ç¤ºä¾‹æ•°æ®å±•ç¤ºç•Œé¢');
                    }

                    // è¿‡æ»¤æ‰è¯¾ç¨‹åŒ…ï¼Œåªä¿ç•™è¯¾ç¨‹ç±»å‹çš„è®¢é˜…
                    const courseSubscriptions = subscriptions.filter(sub => 
                        sub.type === 'course' && sub.status === 'active'
                    );
                    
                    console.log('è¿‡æ»¤åçš„è¯¾ç¨‹è®¢é˜…:', courseSubscriptions);
                    
                    // æ‰¹é‡è·å–è¯¾ç¨‹è¯¦æƒ… - ä¼˜åŒ–æ€§èƒ½
                    const courseIds = [...new Set(courseSubscriptions.map(sub => sub.courseId))];
                    const batchSize = 5; // é™åˆ¶å¹¶å‘æ•°
                    const courseDetails = [];
                    
                    // åˆ†æ‰¹å¤„ç†è¯¾ç¨‹è¯·æ±‚ï¼Œé¿å…åŒæ—¶å‘èµ·è¿‡å¤šè¯·æ±‚
                    for (let i = 0; i < courseIds.length; i += batchSize) {
                        const batch = courseIds.slice(i, i + batchSize);
                        const batchPromises = batch.map(courseId => 
                            this.getCourseDetailsWithCache(courseId)
                        );
                        const batchResults = await Promise.allSettled(batchPromises);
                        courseDetails.push(...batchResults);
                    }
                    
                    // å°†è¯¾ç¨‹è¯¦æƒ…ä¸è®¢é˜…ä¿¡æ¯åˆå¹¶
                    this.myCourses = courseDetails
                        .filter(result => result.status === 'fulfilled' && result.value)
                        .map(result => {
                            const course = result.value;
                            // æ‰¾åˆ°å¯¹åº”çš„è®¢é˜…ä¿¡æ¯
                            const subscription = courseSubscriptions.find(sub => sub.courseId === course.id);
                            if (subscription) {
                                course.subscriptionId = subscription.id;
                                course.progress = subscription.progress || 0;
                                course.subscriptionDate = subscription.createdAt;
                                course.lastAccessed = subscription.lastAccessed;
                                course.completedAt = subscription.completedAt;
                                course.amount = subscription.amount;
                            }
                            return course;
                        });

                    this.allCourses = [...this.myCourses];
                    
                    // æŒ‰æƒé‡æ’åºï¼šè¿›è¡Œä¸­ > æœ€è¿‘è®¿é—® > å®Œæˆåº¦ > è®¢é˜…æ—¶é—´
                    this.myCourses.sort((a, b) => {
                        // æƒé‡1: å­¦ä¹ çŠ¶æ€ï¼ˆè¿›è¡Œä¸­çš„è¯¾ç¨‹ä¼˜å…ˆï¼‰
                        const aInProgress = a.progress > 0 && a.progress < 100;
                        const bInProgress = b.progress > 0 && b.progress < 100;
                        if (aInProgress !== bInProgress) {
                            return bInProgress - aInProgress; // è¿›è¡Œä¸­çš„æ’å‰é¢
                        }
                        
                        // æƒé‡2: æœ€è¿‘è®¿é—®æ—¶é—´
                        const aLastAccessed = new Date(a.lastAccessed || 0).getTime();
                        const bLastAccessed = new Date(b.lastAccessed || 0).getTime();
                        if (Math.abs(aLastAccessed - bLastAccessed) > 24 * 60 * 60 * 1000) { // è¶…è¿‡1å¤©å·®å¼‚
                            return bLastAccessed - aLastAccessed;
                        }
                        
                        // æƒé‡3: å®Œæˆåº¦ï¼ˆæœªå®Œæˆçš„æŒ‰è¿›åº¦é™åºï¼Œå®Œæˆçš„æ”¾æœ€åï¼‰
                        if (a.progress === 100 && b.progress !== 100) return 1;
                        if (b.progress === 100 && a.progress !== 100) return -1;
                        if (a.progress !== 100 && b.progress !== 100) {
                            return b.progress - a.progress;
                        }
                        
                        // æƒé‡4: è®¢é˜…æ—¶é—´ï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
                        const aSubscriptionTime = new Date(a.subscriptionDate || 0);
                        const bSubscriptionTime = new Date(b.subscriptionDate || 0);
                        return bSubscriptionTime - aSubscriptionTime;
                    });

                    this.renderCourses();

                } catch (error) {
                    console.error('åŠ è½½æˆ‘çš„è¯¾ç¨‹å¤±è´¥:', error);
                    this.showNotification(`åŠ è½½è¯¾ç¨‹å¤±è´¥: ${error.message}`, 'error');
                    this.showEmptyState('åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                } finally {
                    this.isLoading = false;
                    this.hideLoadingSkeleton();
                }
            }

            // è·å–è¯¾ç¨‹è¯¦æƒ…
            async getCourseDetails(courseId) {
                try {
                    const token = localStorage.getItem('token');
                    const response = await fetch(`/api/courses/${courseId}`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    if (response.ok) {
                        const data = await response.json();
                        if (data.success && data.data) {
                            return data.data;
                        }
                    }
                    return null;
                } catch (error) {
                    console.warn(`è·å–è¯¾ç¨‹${courseId}è¯¦æƒ…å¤±è´¥:`, error);
                    return null;
                }
            }
            
            // å¸¦å†…å­˜ç¼“å­˜çš„è¯¾ç¨‹è¯¦æƒ…è·å– - æ€§èƒ½ä¼˜åŒ–
            async getCourseDetailsWithCache(courseId) {
                // ä½¿ç”¨å†…å­˜ç¼“å­˜é¿å…é‡å¤è¯·æ±‚
                if (!this.courseCache) {
                    this.courseCache = new Map();
                }
                
                // æ£€æŸ¥ç¼“å­˜
                if (this.courseCache.has(courseId)) {
                    const cached = this.courseCache.get(courseId);
                    // ç¼“å­˜5åˆ†é’Ÿæœ‰æ•ˆ
                    if (Date.now() - cached.timestamp < 5 * 60 * 1000) {
                        return cached.data;
                    }
                }
                
                // å‘èµ·è¯·æ±‚
                const course = await this.getCourseDetails(courseId);
                
                // å­˜å…¥ç¼“å­˜
                if (course) {
                    this.courseCache.set(courseId, {
                        data: course,
                        timestamp: Date.now()
                    });
                }
                
                return course;
            }

            // åŠ è½½å­¦ä¹ ç»Ÿè®¡
            async loadStats() {
                try {
                    const completedCount = this.myCourses.filter(course => course.isCompleted).length;
                    const inProgressCount = this.myCourses.filter(course => !course.isCompleted && (course.progress || 0) > 0).length;
                    const totalProgress = this.myCourses.reduce((sum, course) => sum + (course.progress || 0), 0);
                    const avgProgress = this.myCourses.length > 0 ? Math.round(totalProgress / this.myCourses.length) : 0;
                    
                    // ä¼°ç®—å­¦ä¹ æ—¶é—´ï¼ˆå‡è®¾æ¯ä¸ªè¯¾ç¨‹4å°æ—¶ï¼Œæ ¹æ®è¿›åº¦è®¡ç®—ï¼‰
                    const totalStudyTime = Math.round(totalProgress / 100 * 4 * this.myCourses.length);

                    this.stats = {
                        totalCourses: this.myCourses.length,
                        completedCourses: completedCount,
                        inProgressCourses: inProgressCount,
                        totalStudyTime: totalStudyTime,
                        avgProgress: avgProgress
                    };

                    this.renderStats();
                } catch (error) {
                    console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                }
            }

            // æ¸²æŸ“ç»Ÿè®¡å¡ç‰‡
            renderStats() {
                const statsGrid = document.getElementById('statsGrid');
                if (!statsGrid) return;

                const statsHtml = `
                    <div class="stat-card">
                        <div class="stat-icon">[TOTAL]</div>
                        <div class="stat-number">${this.stats.totalCourses}</div>
                        <div class="stat-label">å·²æŠ¥åè¯¾ç¨‹</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">[DONE]</div>
                        <div class="stat-number">${this.stats.completedCourses}</div>
                        <div class="stat-label">å·²å®Œæˆè¯¾ç¨‹</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">STATS</div>
                        <div class="stat-number">${this.stats.avgProgress}%</div>
                        <div class="stat-label">å¹³å‡è¿›åº¦</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">[TIME]</div>
                        <div class="stat-number">${this.stats.totalStudyTime}</div>
                        <div class="stat-label">å­¦ä¹ æ—¶é•¿(å°æ—¶)</div>
                    </div>
                `;

                statsGrid.innerHTML = statsHtml;
            }

            // æ¸²æŸ“è¯¾ç¨‹åˆ—è¡¨
            renderCourses() {
                const grid = document.getElementById('coursesGrid');
                if (!grid) return;

                if (this.myCourses.length === 0) {
                    this.showEmptyState();
                    return;
                }

                this.hideEmptyState();

                const coursesHtml = this.myCourses.map(courseData => this.createCourseCard(courseData)).join('');
                grid.innerHTML = coursesHtml;
            }

            // åˆ›å»ºè¯¾ç¨‹å¡ç‰‡
            createCourseCard(courseData) {
                const course = courseData.course;
                const progress = courseData.progress || 0;
                const isCompleted = courseData.isCompleted;
                const lastAccessed = courseData.lastAccessed ? new Date(courseData.lastAccessed) : null;

                // ç”Ÿæˆå¾½ç« 
                const badges = [];
                if (isCompleted) {
                    badges.push('<span class="badge badge-completed">å·²å®Œæˆ</span>');
                } else if (progress > 0) {
                    badges.push('<span class="badge badge-in-progress">å­¦ä¹ ä¸­</span>');
                }

                return `
                    <div class="my-course-card" data-course-id="${course.id}" onclick="viewCourse(${course.id})">
                        <div class="course-image">
                            ${course.coverImage ? 
                                `<img src="${course.coverImage}" alt="${course.title}" 
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                 <div style="display:none;">${this.getPlaceholderImageHtml(course)}</div>` :
                                this.getPlaceholderImageHtml(course)
                            }
                            
                            <!-- è¿›åº¦è¦†ç›–å±‚ -->
                            <div class="progress-overlay">
                                <div class="progress-info">
                                    <span class="progress-text">å­¦ä¹ è¿›åº¦</span>
                                    <span class="progress-percentage">${Math.round(progress)}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${progress}%"></div>
                                </div>
                            </div>
                            
                            <!-- å®Œæˆåº¦å¾½ç«  -->
                            <div class="completion-badge ${isCompleted ? 'completed' : 'in-progress'}">
                                ${isCompleted ? 'âœ“' : Math.round(progress) + '%'}
                            </div>
                            
                            <!-- è¯¾ç¨‹å¾½ç«  -->
                            <div class="course-badges">
                                ${badges.join('')}
                            </div>
                        </div>
                        
                        <div class="course-content">
                            <h3 class="course-title">${course.title || 'è¯¾ç¨‹æ ‡é¢˜åŠ è½½ä¸­...'}</h3>
                            <p class="course-description">${course.description || 'è¯¾ç¨‹æè¿°åŠ è½½ä¸­...'}</p>
                            
                            <div class="course-meta">
                                <div class="meta-item">
                                    <span>æŠ¥åæ—¶é—´: ${this.formatDate(course.subscriptionDate)}</span>
                                </div>
                                ${lastAccessed ? `
                                <div class="meta-item">
                                    <span>æœ€è¿‘å­¦ä¹ : ${this.formatDate(lastAccessed)}</span>
                                </div>
                                ` : ''}
                            </div>
                            
                            <div class="course-actions">
                                <button class="action-btn btn-primary" onclick="event.stopPropagation(); continueLearning(${course.id})">
                                    ${isCompleted ? 'å¤ä¹ è¯¾ç¨‹' : progress > 0 ? 'ç»§ç»­å­¦ä¹ ' : 'å¼€å§‹å­¦ä¹ '}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            // æ ¼å¼åŒ–æ—¥æœŸ
            formatDate(dateStr) {
                if (!dateStr) return 'æœªçŸ¥';
                const date = new Date(dateStr);
                return date.toLocaleDateString('zh-CN', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
            }

            // ç”Ÿæˆç®—æ³•é£æ ¼çš„è¯¾ç¨‹èƒŒæ™¯å›¾
            getPlaceholderImageHtml(course) {
                const gradients = [
                    'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', // è“ç´«
                    'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', // ç²‰çº¢
                    'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', // è“é’
                    'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)', // ç»¿é’
                    'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', // ç²‰é»„
                    'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)', // é’ç²‰
                    'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)', // çº¢ç²‰
                    'linear-gradient(135deg, #fad0c4 0%, #ffd1ff 100%)' // æ©™ç´«
                ];
                
                // æ ¹æ®è¯¾ç¨‹IDæˆ–æ ‡é¢˜ç”Ÿæˆä¸€è‡´çš„èƒŒæ™¯è‰²
                const courseId = course?.id || Math.random();
                const gradientIndex = Math.abs(courseId.toString().split('').reduce((a, b) => a + b.charCodeAt(0), 0)) % gradients.length;
                const selectedGradient = gradients[gradientIndex];
                
                // è·å–è¯¾ç¨‹æ ‡é¢˜ï¼Œå¦‚æœæ ‡é¢˜å¤ªé•¿åˆ™æˆªæ–­
                const courseTitle = course?.title || 'AIè¯¾ç¨‹';
                const displayTitle = courseTitle.length > 12 ? courseTitle.substring(0, 12) + '...' : courseTitle;
                
                return `<div style="
                    width: 100%; 
                    height: 200px; 
                    background: ${selectedGradient}; 
                    display: flex; 
                    flex-direction: column;
                    align-items: center; 
                    justify-content: center; 
                    color: white; 
                    font-family: 'JetBrains Mono', monospace;
                    position: relative;
                    overflow: hidden;
                ">
                    <div style="
                        position: absolute;
                        top: 10px;
                        right: 10px;
                        font-size: 0.8rem;
                        opacity: 0.8;
                    ">#${String(courseId).padStart(3, '0')}</div>
                    <div style="
                        font-size: 1.2rem; 
                        font-weight: bold;
                        text-align: center;
                        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
                        padding: 0 10px;
                        line-height: 1.2;
                    ">${displayTitle}</div>
                </div>`;
            }
            
            // ç”Ÿæˆè¯¾ç¨‹æ ‡è¯†ç¬¦
            generateCourseLabel(course) {
                if (!course || !course.title) {
                    return '[AI_COURSE]';
                }
                
                const title = course.title;
                const keywords = [
                    { match: ['python', 'Python'], label: '[PYTHON_AI]' },
                    { match: ['æ·±åº¦å­¦ä¹ ', 'æ·±åº¦', 'deep'], label: '[DEEP_LEARN]' },
                    { match: ['æœºå™¨å­¦ä¹ ', 'æœºå™¨', 'machine'], label: '[ML_ALGO]' },
                    { match: ['ç®—æ³•', 'algorithm'], label: '[ALGORITHM]' },
                    { match: ['ç¥ç»ç½‘ç»œ', 'ç½‘ç»œ', 'neural'], label: '[NEURAL_NET]' },
                    { match: ['æ•°æ®', 'data'], label: '[DATA_SCI]' },
                    { match: ['è‡ªç„¶è¯­è¨€', 'NLP', 'nlp'], label: '[NLP_PROC]' },
                    { match: ['è®¡ç®—æœºè§†è§‰', 'è§†è§‰', 'cv'], label: '[COMP_VIS]' },
                    { match: ['å®æˆ˜', 'é¡¹ç›®', 'project'], label: '[PROJECT]' },
                    { match: ['åŸºç¡€', 'å…¥é—¨', 'basic'], label: '[BASIC_AI]' },
                ];
                
                for (const keyword of keywords) {
                    if (keyword.match.some(match => title.toLowerCase().includes(match.toLowerCase()))) {
                        return keyword.label;
                    }
                }
                
                // å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°å…³é”®è¯ï¼Œç”Ÿæˆé€šç”¨æ ‡ç­¾
                return `[${title.substring(0, 6).toUpperCase()}]`;
            }

            // æ˜¾ç¤º/éšè—ç©ºçŠ¶æ€
            showEmptyState(message = '') {
                const emptyState = document.getElementById('emptyState');
                const grid = document.getElementById('coursesGrid');
                
                if (emptyState && grid) {
                    emptyState.style.display = 'block';
                    grid.style.display = 'none';
                    
                    if (message) {
                        const p = emptyState.querySelector('p');
                        if (p) p.textContent = message;
                    }
                }
            }

            hideEmptyState() {
                const emptyState = document.getElementById('emptyState');
                const grid = document.getElementById('coursesGrid');
                
                if (emptyState && grid) {
                    emptyState.style.display = 'none';
                    grid.style.display = 'grid';
                }
            }

            // æ˜¾ç¤º/éšè—åŠ è½½éª¨æ¶
            showLoadingSkeleton() {
                const grid = document.getElementById('coursesGrid');
                if (grid) {
                    const skeletonCards = Array(4).fill().map(() => `
                        <div class="my-course-card loading-skeleton" style="min-height: 400px;">
                            <div style="height: 200px; background: var(--gray-200); position: relative;">
                                <div style="position: absolute; bottom: 1rem; left: 1rem; right: 1rem; height: 60px; background: rgba(0,0,0,0.3); border-radius: 8px;"></div>
                            </div>
                            <div style="padding: 1.5rem;">
                                <div style="height: 24px; background: var(--gray-200); margin-bottom: 1rem; border-radius: 4px;"></div>
                                <div style="height: 40px; background: var(--gray-200); margin-bottom: 1rem; border-radius: 4px;"></div>
                                <div style="height: 60px; background: var(--gray-200); margin-bottom: 1.5rem; border-radius: 4px;"></div>
                                <div style="display: flex; gap: 1rem;">
                                    <div style="flex: 1; height: 40px; background: var(--gray-200); border-radius: 8px;"></div>
                                    <div style="flex: 1; height: 40px; background: var(--gray-200); border-radius: 8px;"></div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    grid.innerHTML = skeletonCards;
                }
            }

            hideLoadingSkeleton() {
                // ç”±renderCourseså¤„ç†
            }

            // ç»‘å®šäº‹ä»¶
            bindEvents() {
                // å¯¼èˆªæ æ»šåŠ¨æ•ˆæœ
                window.addEventListener('scroll', () => {
                    const navbar = document.getElementById('navbar');
                    if (window.scrollY > 50) {
                        navbar.classList.add('scrolled');
                    } else {
                        navbar.classList.remove('scrolled');
                    }
                });
            }

            // æ›´æ–°UI
            updateUI() {
                this.initTheme();
            }

            // åˆå§‹åŒ–ä¸»é¢˜
            initTheme() {
                const savedTheme = localStorage.getItem('theme') || 'light';
                document.documentElement.setAttribute('data-theme', savedTheme);
            }

            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                if (!notification) return;

                notification.textContent = message;
                notification.className = `notification ${type} show`;

                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        }

        // å…¨å±€å‡½æ•°
        window.viewCourse = (courseId) => {
            const isDev = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            const detailPath = isDev ? '/src/pages/course-detail.html' : '/src/pages/course-detail.html';
            window.location.href = `${detailPath}?id=${courseId}`;
        };

        window.continueLearning = (courseId) => {
            // ç›´æ¥è·³è½¬åˆ°è¯¾ç¨‹è¯¦æƒ…é¡µ
            const isDev = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            const detailPath = isDev ? '/src/pages/course-detail.html' : '/src/pages/course-detail.html';
            window.location.href = `${detailPath}?id=${courseId}`;
        };

        window.viewCourseDetail = (courseId) => {
            viewCourse(courseId);
        };

        window.toggleUserMenu = (event) => {
            if (event) {
                event.stopPropagation();
            }
            const dropdown = document.getElementById('userDropdown');
            const container = document.querySelector('.user-menu-container');
            if (dropdown && container) {
                dropdown.classList.toggle('show');
                container.classList.toggle('active');
            }
        };

        window.logout = () => {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                localStorage.removeItem('refreshToken');
                window.location.href = 'login.html';
            }
        };

        window.toggleTheme = () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        };

        // å…³é—­ä¸‹æ‹‰èœå•
        document.addEventListener('click', function(event) {
            const userMenu = document.querySelector('.user-menu-container');
            if (userMenu && !userMenu.contains(event.target)) {
                const dropdown = document.getElementById('userDropdown');
                if (dropdown) {
                    dropdown.classList.remove('show');
                    userMenu.classList.remove('active');
                }
            }
        });

        // åˆå§‹åŒ–æˆ‘çš„è¯¾ç¨‹ç®¡ç†å™¨
        const myCourseManager = new MyCourseManager();
        window.myCourseManager = myCourseManager;

        // å½“DOMå‡†å¤‡å°±ç»ªæ—¶åˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => myCourseManager.init());
        } else {
            myCourseManager.init();
        }
    </script>
</body>
</html>