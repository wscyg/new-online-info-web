<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PK赛季 - AI 信息未来</title>
    <link rel="stylesheet" href="../styles/apple-design.css">
    <style>
        body {
            padding-top: 48px;
        }

        .page-header {
            background: linear-gradient(135deg, #0071e3 0%, #147ce5 100%);
            color: white;
            padding: 60px 0;
            margin-top: -48px;
            padding-top: 108px;
        }

        .header-content {
            max-width: 980px;
            margin: 0 auto;
            padding: 0 22px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
        }

        .back-link {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            opacity: 0.9;
            font-size: 15px;
            transition: opacity var(--transition-fast);
        }

        .back-link:hover {
            opacity: 1;
        }

        .refresh-btn {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: var(--radius-full);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: background var(--transition-fast);
        }

        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .season-title {
            font-size: 48px;
            font-weight: 700;
            letter-spacing: -0.02em;
            margin-bottom: 8px;
        }

        .season-theme {
            font-size: 21px;
            opacity: 0.9;
            margin-bottom: 32px;
        }

        .season-meta {
            display: flex;
            align-items: center;
            gap: 32px;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
        }

        .main-content {
            max-width: 980px;
            margin: 0 auto;
            padding: 48px 22px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            padding: 4px;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            margin-bottom: 32px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px 20px;
            font-size: 15px;
            color: var(--text-secondary);
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .tab-btn.active {
            background: var(--bg-card);
            color: var(--text-primary);
            box-shadow: var(--shadow-sm);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 24px;
            border-left: 3px solid var(--accent);
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: -0.02em;
            margin-bottom: 4px;
        }

        .stat-subtext {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .description-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 32px;
            margin-bottom: 32px;
        }

        .leaderboard-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .leaderboard-actions {
            display: flex;
            gap: 8px;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-table thead {
            background: var(--bg-secondary);
        }

        .leaderboard-table th {
            padding: 12px 16px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .leaderboard-table td {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .leaderboard-table tr:hover {
            background: var(--bg-hover);
        }

        .rank-badge {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .rank-1 { background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); color: white; }
        .rank-2 { background: linear-gradient(135deg, #C0C0C0 0%, #808080 100%); color: white; }
        .rank-3 { background: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%); color: white; }

        .player-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .player-details {
            display: flex;
            flex-direction: column;
        }

        .player-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .player-id {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .tier-badge {
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 500;
        }

        .tier-BRONZE { background: rgba(205, 127, 50, 0.15); color: #cd7f32; }
        .tier-SILVER { background: rgba(192, 192, 192, 0.15); color: #808080; }
        .tier-GOLD { background: rgba(255, 215, 0, 0.15); color: #c5a300; }
        .tier-PLATINUM { background: rgba(229, 228, 226, 0.15); color: #86868b; }
        .tier-DIAMOND { background: rgba(185, 242, 255, 0.15); color: #0066cc; }
        .tier-MASTER { background: rgba(138, 43, 226, 0.15); color: #8a2be2; }
        .tier-GRANDMASTER { background: rgba(255, 20, 147, 0.15); color: #ff1493; }
        .tier-CHALLENGER { background: rgba(255, 69, 0, 0.15); color: #ff4500; }

        .rewards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
        }

        .reward-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transition: transform var(--transition-fast), box-shadow var(--transition-fast);
        }

        .reward-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-card);
        }

        .reward-header {
            padding: 32px 24px;
            text-align: center;
            color: white;
        }

        .reward-header.champion {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        }

        .reward-header.top3 {
            background: linear-gradient(135deg, #C0C0C0 0%, #808080 100%);
        }

        .reward-header.top10 {
            background: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%);
        }

        .reward-header.default {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .reward-title {
            font-size: 21px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .reward-rank {
            font-size: 13px;
            opacity: 0.9;
        }

        .reward-body {
            padding: 24px;
        }

        .reward-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .reward-item:last-child {
            border-bottom: none;
        }

        .reward-label {
            font-size: 15px;
            color: var(--text-secondary);
        }

        .reward-value {
            font-size: 15px;
            font-weight: 600;
            color: var(--accent);
        }

        .reward-desc {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-top: 12px;
            line-height: 1.5;
        }

        .tasks-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 32px;
            margin-bottom: 24px;
        }

        .tasks-section-title {
            font-size: 21px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
        }

        .task-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            margin-bottom: 12px;
            transition: background var(--transition-fast);
        }

        .task-item:hover {
            background: var(--bg-hover);
        }

        .task-item:last-child {
            margin-bottom: 0;
        }

        .task-info {
            flex: 1;
        }

        .task-name {
            font-size: 15px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .task-desc {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .task-reward {
            text-align: right;
            margin-left: 16px;
        }

        .task-points {
            font-size: 17px;
            font-weight: 600;
            color: var(--accent);
        }

        .task-requirement {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        .icon {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        @media (max-width: 768px) {
            .season-title {
                font-size: 32px;
            }

            .season-theme {
                font-size: 17px;
            }

            .season-meta {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }

            .tabs {
                flex-direction: column;
            }

            .leaderboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .leaderboard-table {
                display: block;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body data-theme="light">
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-inner">
            <a href="dashboard.html" class="nav-logo">学习平台</a>
            <div class="nav-menu">
                <a href="dashboard.html" class="nav-link">首页</a>
                <a href="courses.html" class="nav-link">课程</a>
                <a href="community.html" class="nav-link">社区</a>
                <a href="arena.html" class="nav-link active">PK竞技</a>
            </div>
            <div class="nav-actions">
                <button class="theme-toggle" onclick="toggleTheme()">
                    <svg class="icon" id="theme-icon-light" style="display: block;">
                        <circle cx="10" cy="10" r="5"></circle>
                        <line x1="10" y1="1" x2="10" y2="3"></line>
                        <line x1="10" y1="17" x2="10" y2="19"></line>
                        <line x1="3.22" y1="3.22" x2="4.64" y2="4.64"></line>
                        <line x1="15.36" y1="15.36" x2="16.78" y2="16.78"></line>
                        <line x1="1" y1="10" x2="3" y2="10"></line>
                        <line x1="17" y1="10" x2="19" y2="10"></line>
                        <line x1="3.22" y1="16.78" x2="4.64" y2="15.36"></line>
                        <line x1="15.36" y1="4.64" x2="16.78" y2="3.22"></line>
                    </svg>
                    <svg class="icon" id="theme-icon-dark" style="display: none;">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
                <div class="user-menu">
                    <div class="user-avatar" onclick="toggleUserMenu()">
                        <span id="user-initial">U</span>
                    </div>
                    <div class="dropdown" id="user-dropdown">
                        <div class="dropdown-item" onclick="location.href='profile.html'">个人资料</div>
                        <div class="dropdown-item" onclick="location.href='settings.html'">设置</div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item" onclick="logout()">退出登录</div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <div class="page-header">
        <div class="header-content">
            <div class="header-actions">
                <a href="dashboard.html" class="back-link">
                    <svg class="icon">
                        <line x1="19" y1="10" x2="5" y2="10"></line>
                        <polyline points="12 17 5 10 12 3"></polyline>
                    </svg>
                    返回主页
                </a>
                <button class="refresh-btn" onclick="refreshData()">
                    <svg class="icon">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <polyline points="1 16 1 10 7 10"></polyline>
                        <path d="M3.51 15a9 9 0 0 0 14.85-3.36L23 10M1 10l4.64 1.64A9 9 0 0 0 20.49 5"></path>
                    </svg>
                    刷新
                </button>
            </div>

            <h1 class="season-title" id="seasonTitle">加载中...</h1>
            <p class="season-theme" id="seasonTheme">正在获取赛季信息...</p>

            <div class="season-meta">
                <div class="meta-item">
                    <svg class="icon">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <span id="seasonDates">...</span>
                </div>
                <div class="meta-item">
                    <svg class="icon">
                        <circle cx="10" cy="10" r="8"></circle>
                        <polyline points="10 6 10 10 13 11"></polyline>
                    </svg>
                    <span id="seasonTimeLeft">...</span>
                </div>
                <div class="meta-item">
                    <svg class="icon">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <span id="participantCount">...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="overview" onclick="switchTab('overview')">
                <svg class="icon">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                赛季概览
            </button>
            <button class="tab-btn" data-tab="leaderboard" onclick="switchTab('leaderboard')">
                <svg class="icon">
                    <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                    <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                    <path d="M4 22h16"></path>
                    <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
                    <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
                    <path d="M18 2H6v7a6 6 0 0 0 12 0V2z"></path>
                </svg>
                排行榜
            </button>
            <button class="tab-btn" data-tab="rewards" onclick="switchTab('rewards')">
                <svg class="icon">
                    <polyline points="20 12 20 22 4 22 4 12"></polyline>
                    <rect x="2" y="7" width="20" height="5"></rect>
                    <line x1="12" y1="22" x2="12" y2="7"></line>
                    <path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path>
                    <path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path>
                </svg>
                奖励
            </button>
            <button class="tab-btn" data-tab="tasks" onclick="switchTab('tasks')">
                <svg class="icon">
                    <polyline points="9 11 12 14 22 4"></polyline>
                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                </svg>
                任务
            </button>
        </div>

        <!-- Overview Tab -->
        <div class="tab-content active" id="tab-overview">
            <h2 style="font-size: 28px; font-weight: 600; margin-bottom: 24px;">我的赛季数据</h2>
            <div class="stats-grid" id="userStatsGrid">
                <!-- Stats will be loaded here -->
            </div>

            <div class="description-card">
                <h2 style="font-size: 24px; font-weight: 600; margin-bottom: 16px;">赛季说明</h2>
                <p style="color: var(--text-secondary); line-height: 1.6;" id="seasonDescription">
                    加载中...
                </p>
            </div>
        </div>

        <!-- Leaderboard Tab -->
        <div class="tab-content" id="tab-leaderboard">
            <div style="background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: 32px;">
                <div class="leaderboard-header">
                    <h2 style="font-size: 28px; font-weight: 600; margin: 0;">赛季排行榜</h2>
                    <div class="leaderboard-actions">
                        <button class="btn btn-sm btn-secondary" onclick="loadLeaderboard(10)">Top 10</button>
                        <button class="btn btn-sm btn-secondary" onclick="loadLeaderboard(50)">Top 50</button>
                        <button class="btn btn-sm btn-primary" onclick="loadLeaderboard(100)">Top 100</button>
                    </div>
                </div>

                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>排名</th>
                            <th>玩家</th>
                            <th>ELO</th>
                            <th>段位</th>
                            <th>对战</th>
                            <th>胜率</th>
                            <th>连胜</th>
                            <th>奖励</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <!-- Leaderboard rows will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Rewards Tab -->
        <div class="tab-content" id="tab-rewards">
            <div class="rewards-grid" id="rewardsGrid">
                <!-- Reward cards will be loaded here -->
            </div>
        </div>

        <!-- Tasks Tab -->
        <div class="tab-content" id="tab-tasks">
            <div id="tasksContainer">
                <!-- Task sections will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';
        let currentSeasonId = null;
        let seasonData = null;

        // Theme management
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            const lightIcon = document.getElementById('theme-icon-light');
            const darkIcon = document.getElementById('theme-icon-dark');
            if (theme === 'dark') {
                lightIcon.style.display = 'none';
                darkIcon.style.display = 'block';
            } else {
                lightIcon.style.display = 'block';
                darkIcon.style.display = 'none';
            }
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }

        // User menu
        function toggleUserMenu() {
            const dropdown = document.getElementById('user-dropdown');
            dropdown.classList.toggle('show');
        }

        document.addEventListener('click', (e) => {
            const userMenu = document.querySelector('.user-menu');
            if (!userMenu.contains(e.target)) {
                document.getElementById('user-dropdown').classList.remove('show');
            }
        });

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            location.href = 'login.html';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            initTheme();
            checkAuth();
            await loadCurrentSeason();
            await loadUserStats();
        });

        function checkAuth() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');

            if (!token) {
                location.href = 'login.html';
                return;
            }

            if (user) {
                try {
                    const userData = JSON.parse(user);
                    const initial = userData.username ? userData.username[0].toUpperCase() : 'U';
                    document.getElementById('user-initial').textContent = initial;
                } catch (e) {
                    console.error('Error parsing user data:', e);
                }
            }
        }

        // Load current season
        async function loadCurrentSeason() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/seasons/current`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();

                if (data.code === 200) {
                    seasonData = data.data;
                    currentSeasonId = seasonData.id;
                    renderSeasonInfo(seasonData);
                    await loadSeasonDetails();
                }
            } catch (error) {
                console.error('加载赛季信息失败:', error);
            }
        }

        // Render season info
        function renderSeasonInfo(season) {
            document.getElementById('seasonTitle').textContent = season.seasonName;
            document.getElementById('seasonTheme').textContent = `主题: ${season.theme}`;

            const startDate = new Date(season.startDate).toLocaleDateString('zh-CN');
            const endDate = new Date(season.endDate).toLocaleDateString('zh-CN');
            document.getElementById('seasonDates').textContent = `${startDate} - ${endDate}`;

            updateTimeLeft(season.endDate);
            document.getElementById('participantCount').textContent = `${season.totalParticipants || 0} 名参与者`;
            document.getElementById('seasonDescription').textContent = season.description || '暂无描述';
        }

        // Update time left
        function updateTimeLeft(endDate) {
            const now = new Date();
            const end = new Date(endDate);
            const diff = end - now;

            if (diff <= 0) {
                document.getElementById('seasonTimeLeft').textContent = '赛季已结束';
                return;
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            document.getElementById('seasonTimeLeft').textContent = `剩余 ${days}天 ${hours}小时`;
        }

        // Load season details
        async function loadSeasonDetails() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/seasons/${currentSeasonId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();

                if (data.code === 200) {
                    renderRewards(data.data.rewards);
                    renderTasks(data.data.tasks);
                }
            } catch (error) {
                console.error('加载赛季详情失败:', error);
            }
        }

        // Load user stats
        async function loadUserStats() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/seasons/my-stats`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();

                if (data.code === 200) {
                    renderUserStats(data.data.ranking);
                }
            } catch (error) {
                console.error('加载用户统计失败:', error);
            }
        }

        // Render user stats
        function renderUserStats(ranking) {
            const grid = document.getElementById('userStatsGrid');
            const rankChange = ranking.rankChange || 0;
            const changeSymbol = rankChange > 0 ? '↑' : rankChange < 0 ? '↓' : '—';

            grid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">当前排名</div>
                    <div class="stat-value">#${ranking.currentRank || '未上榜'}</div>
                    <div class="stat-subtext">${changeSymbol} ${Math.abs(rankChange)}</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">赛季ELO</div>
                    <div class="stat-value">${ranking.currentElo}</div>
                    <div class="stat-subtext">峰值: ${ranking.peakElo}</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">对战记录</div>
                    <div class="stat-value">${ranking.wins}胜${ranking.losses}负</div>
                    <div class="stat-subtext">胜率: ${ranking.winRate || 0}%</div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">连胜记录</div>
                    <div class="stat-value">${ranking.currentStreak || 0}</div>
                    <div class="stat-subtext">最高: ${ranking.maxWinStreak || 0}</div>
                </div>
            `;
        }

        // Load leaderboard
        async function loadLeaderboard(limit = 100) {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/seasons/${currentSeasonId}/leaderboard?limit=${limit}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();

                if (data.code === 200) {
                    renderLeaderboard(data.data);
                }
            } catch (error) {
                console.error('加载排行榜失败:', error);
            }
        }

        // Render leaderboard
        function renderLeaderboard(leaderboard) {
            const tbody = document.getElementById('leaderboardBody');
            tbody.innerHTML = leaderboard.map((entry, index) => {
                const ranking = entry.ranking;
                const reward = entry.reward;
                const rankDisplay = index < 3
                    ? `<div class="rank-badge rank-${index + 1}">${index + 1}</div>`
                    : `<div style="font-weight: 600; color: var(--text-primary);">${index + 1}</div>`;

                return `
                    <tr>
                        <td>${rankDisplay}</td>
                        <td>
                            <div class="player-info">
                                <div class="player-avatar"></div>
                                <div class="player-details">
                                    <div class="player-name">${ranking.username || '匿名用户'}</div>
                                    <div class="player-id">ID: ${ranking.userId}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div style="font-size: 19px; font-weight: 600; color: var(--accent);">${ranking.currentElo}</div>
                        </td>
                        <td>
                            <span class="tier-badge tier-${getTier(ranking.currentElo)}">${getTier(ranking.currentElo)}</span>
                        </td>
                        <td>${ranking.totalBattles || 0}</td>
                        <td>
                            <div style="font-weight: 600; color: #34c759;">${ranking.winRate || 0}%</div>
                        </td>
                        <td>
                            <div style="font-weight: 600; color: #ff9500;">${ranking.currentStreak || 0}</div>
                        </td>
                        <td>
                            <div style="font-size: 13px; color: var(--text-secondary);">${reward ? reward.pointsReward + ' 积分' : '参与奖'}</div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Render rewards
        function renderRewards(rewards) {
            const grid = document.getElementById('rewardsGrid');
            grid.innerHTML = rewards.map(reward => {
                const headerClass = reward.rankType === 'champion' ? 'champion' :
                                   reward.rankType === 'top3' ? 'top3' :
                                   reward.rankType === 'top10' ? 'top10' : 'default';

                return `
                    <div class="reward-card">
                        <div class="reward-header ${headerClass}">
                            <div class="reward-title">${reward.titleName || '参与奖'}</div>
                            <div class="reward-rank">第 ${reward.rankRangeStart} - ${reward.rankRangeEnd} 名</div>
                        </div>

                        <div class="reward-body">
                            <div class="reward-item">
                                <span class="reward-label">积分奖励</span>
                                <span class="reward-value">${reward.pointsReward}</span>
                            </div>
                            ${reward.vipDays > 0 ? `
                            <div class="reward-item">
                                <span class="reward-label">VIP天数</span>
                                <span class="reward-value">${reward.vipDays}天</span>
                            </div>
                            ` : ''}
                            ${reward.badgeReward ? `
                            <div class="reward-item">
                                <span class="reward-label">专属徽章</span>
                                <span class="reward-value">${reward.badgeReward}</span>
                            </div>
                            ` : ''}
                            ${reward.description ? `
                            <div class="reward-desc">${reward.description}</div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render tasks
        function renderTasks(tasks) {
            const daily = tasks.filter(t => t.taskType === 'daily');
            const weekly = tasks.filter(t => t.taskType === 'weekly');
            const season = tasks.filter(t => t.taskType === 'season');

            const container = document.getElementById('tasksContainer');
            container.innerHTML = `
                ${renderTaskSection('每日任务', daily)}
                ${renderTaskSection('每周任务', weekly)}
                ${renderTaskSection('赛季任务', season)}
            `;
        }

        function renderTaskSection(title, tasks) {
            if (!tasks || tasks.length === 0) return '';

            return `
                <div class="tasks-section">
                    <h3 class="tasks-section-title">${title}</h3>
                    <div>
                        ${tasks.map(task => `
                            <div class="task-item">
                                <div class="task-info">
                                    <div class="task-name">${task.taskName}</div>
                                    <div class="task-desc">${task.taskDescription}</div>
                                </div>
                                <div class="task-reward">
                                    <div class="task-points">${task.pointsReward} 积分</div>
                                    <div class="task-requirement">要求: ${task.requirementValue}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Get tier from ELO
        function getTier(elo) {
            if (elo < 1200) return 'BRONZE';
            if (elo < 1400) return 'SILVER';
            if (elo < 1600) return 'GOLD';
            if (elo < 1800) return 'PLATINUM';
            if (elo < 2000) return 'DIAMOND';
            if (elo < 2200) return 'MASTER';
            if (elo < 2400) return 'GRANDMASTER';
            return 'CHALLENGER';
        }

        // Switch tab
        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`tab-${tab}`).classList.add('active');

            // Load data if needed
            if (tab === 'leaderboard' && document.getElementById('leaderboardBody').children.length === 0) {
                loadLeaderboard();
            }
        }

        // Refresh data
        async function refreshData() {
            await loadCurrentSeason();
            await loadUserStats();
            const activeTab = document.querySelector('.tab-btn.active').getAttribute('data-tab');
            if (activeTab === 'leaderboard') {
                await loadLeaderboard();
            }
        }
    </script>
</body>
</html>
