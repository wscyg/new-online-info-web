<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>邀请好友 - AI 信息未来</title>
    <link rel="stylesheet" href="/assets/skins/app-shell.css">
<link rel="stylesheet" href="../styles/apple-design.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .page-header { padding: 100px 0 60px; text-align: center; background: var(--bg-secondary); }
        .page-title { font-size: 48px; font-weight: 700; margin-bottom: 12px; }
        .page-desc { font-size: 19px; color: var(--text-secondary); }
        .invite-section { padding: 48px 0 80px; }
        .invite-container { max-width: 800px; margin: 0 auto; }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 40px; }
        @media (max-width: 640px) { .stats-grid { grid-template-columns: 1fr; } }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 24px; text-align: center; }
        .stat-value { font-size: 36px; font-weight: 700; color: var(--accent); margin-bottom: 8px; }
        .stat-label { font-size: 15px; color: var(--text-secondary); }
        .invite-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 20px; padding: 32px; margin-bottom: 32px; }
        .invite-card-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; }
        .invite-code-box { background: var(--bg-secondary); border-radius: 12px; padding: 20px; display: flex; align-items: center; justify-content: space-between; gap: 16px; margin-bottom: 20px; }
        .invite-code { font-size: 24px; font-weight: 700; font-family: monospace; letter-spacing: 2px; }
        .copy-btn { padding: 10px 20px; font-size: 14px; font-weight: 500; background: var(--accent); color: #fff; border: none; border-radius: 8px; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
        .copy-btn:hover { transform: scale(1.05); }
        .invite-link-box { display: flex; gap: 12px; }
        .invite-link-input { flex: 1; padding: 14px 16px; font-size: 14px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 10px; color: var(--text-primary); }
        .rewards-section { margin-top: 40px; }
        .rewards-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; }
        .rewards-list { display: flex; flex-direction: column; gap: 16px; }
        .reward-item { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 20px 24px; display: flex; align-items: center; gap: 20px; }
        .reward-icon { width: 56px; height: 56px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 14px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .reward-icon svg { width: 28px; height: 28px; color: #fff; }
        .reward-info { flex: 1; }
        .reward-title { font-weight: 600; margin-bottom: 4px; }
        .reward-desc { font-size: 14px; color: var(--text-tertiary); }
        .reward-value { font-size: 18px; font-weight: 700; color: #f59e0b; }
        .history-section { margin-top: 48px; }
        .history-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; }
        .history-list { display: flex; flex-direction: column; gap: 12px; }
        .history-item { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 16px 20px; display: flex; justify-content: space-between; align-items: center; }
        .history-user { font-weight: 600; }
        .history-time { font-size: 14px; color: var(--text-tertiary); }
        .history-reward { font-size: 15px; color: var(--success); font-weight: 500; }
        .empty-state { text-align: center; padding: 40px 20px; color: var(--text-tertiary); }
        .empty-state svg { width: 60px; height: 60px; margin-bottom: 16px; opacity: 0.5; }
        /* 分享按钮样式 */
        .share-btn { display: inline-flex; align-items: center; gap: 8px; padding: 12px 20px; font-size: 14px; font-weight: 500; border: none; border-radius: 10px; cursor: pointer; transition: all 0.2s; }
        .share-btn i { font-size: 16px; }
        .share-btn:hover { transform: translateY(-2px); }
        .share-btn.wechat { background: #07c160; color: white; }
        .share-btn.weibo { background: #e6162d; color: white; }
        .share-btn.qq { background: #12b7f5; color: white; }
        .share-btn.link { background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color); }
        /* 排行榜样式 */
        .leaderboard-section { margin-top: 48px; }
        .leaderboard-title { font-size: 20px; font-weight: 600; margin-bottom: 20px; display: flex; align-items: center; gap: 8px; }
        .leaderboard-title i { color: #f59e0b; }
        .leaderboard-list { display: flex; flex-direction: column; gap: 12px; }
        .leaderboard-item { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 16px 20px; display: flex; align-items: center; gap: 16px; }
        .leaderboard-rank { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px; }
        .leaderboard-rank.gold { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white; }
        .leaderboard-rank.silver { background: linear-gradient(135deg, #9ca3af, #6b7280); color: white; }
        .leaderboard-rank.bronze { background: linear-gradient(135deg, #d97706, #b45309); color: white; }
        .leaderboard-rank.normal { background: var(--bg-secondary); color: var(--text-secondary); }
        .leaderboard-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; }
        .leaderboard-info { flex: 1; }
        .leaderboard-name { font-weight: 600; }
        .leaderboard-count { font-size: 13px; color: var(--text-tertiary); }
        .leaderboard-points { font-weight: 700; color: #f59e0b; }
    </style>
    <!-- QRCode库 -->
    <script></script>
</head>
<body>
    <nav class="nav">
        <div class="nav-inner">
            <a href="home.html" class="nav-logo">AI 信息未来</a>
            <div class="nav-menu">
                <a href="home.html" class="nav-link">首页</a>
                <a href="courses.html" class="nav-link">课程</a>
                <a href="online-plaza.html" class="nav-link">在线广场</a>
                <a href="community.html" class="nav-link">社区</a>
                <a href="pk-arena.html" class="nav-link">PK竞技</a>
            </div>
            <div class="nav-actions">
                <button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></button>
                <div id="authArea"></div>
            </div>
        </div>
    </nav>

    <header class="page-header">
        <div class="container">
            <h1 class="page-title">邀请好友</h1>
            <p class="page-desc">邀请好友一起学习，双方都能获得奖励</p>
        </div>
    </header>

    <section class="invite-section">
        <div class="container">
            <div class="invite-container">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="inviteCount">0</div>
                        <div class="stat-label">已邀请好友</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="successCount">0</div>
                        <div class="stat-label">成功注册</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="rewardPoints">0</div>
                        <div class="stat-label">累计获得积分</div>
                    </div>
                </div>

                <div class="invite-card">
                    <h3 class="invite-card-title">我的邀请码</h3>
                    <div class="invite-code-box">
                        <span class="invite-code" id="inviteCode">------</span>
                        <button class="copy-btn" onclick="copyCode()">复制邀请码</button>
                    </div>
                    <h3 class="invite-card-title">邀请链接</h3>
                    <div class="invite-link-box">
                        <input type="text" class="invite-link-input" id="inviteLink" readonly>
                        <button class="copy-btn" onclick="copyLink()">复制链接</button>
                    </div>

                    <!-- 二维码区域 -->
                    <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border-color);">
                        <h3 class="invite-card-title">扫码邀请</h3>
                        <div style="display: flex; align-items: center; gap: 24px; flex-wrap: wrap;">
                            <div id="qrcode" style="width: 150px; height: 150px; background: white; border-radius: 12px; padding: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);"></div>
                            <div style="flex: 1; min-width: 200px;">
                                <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 16px;">扫描二维码，快速分享给好友</p>
                                <button class="copy-btn" onclick="downloadQR()" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                                    <i class="fas fa-download" style="margin-right: 8px;"></i>保存二维码
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 社交分享 -->
                    <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border-color);">
                        <h3 class="invite-card-title">分享到</h3>
                        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                            <button class="share-btn wechat" onclick="shareToWechat()">
                                <i class="fab fa-weixin"></i> 微信
                            </button>
                            <button class="share-btn weibo" onclick="shareToWeibo()">
                                <i class="fab fa-weibo"></i> 微博
                            </button>
                            <button class="share-btn qq" onclick="shareToQQ()">
                                <i class="fab fa-qq"></i> QQ
                            </button>
                            <button class="share-btn link" onclick="copyLink()">
                                <i class="fas fa-link"></i> 复制链接
                            </button>
                        </div>
                    </div>
                </div>

                <div class="rewards-section">
                    <h3 class="rewards-title">邀请奖励</h3>
                    <div class="rewards-list">
                        <div class="reward-item">
                            <div class="reward-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 4-6 8-6s8 2 8 6"/></svg>
                            </div>
                            <div class="reward-info">
                                <div class="reward-title">好友注册成功</div>
                                <div class="reward-desc">好友通过你的链接注册账号</div>
                            </div>
                            <div class="reward-value">+50 积分</div>
                        </div>
                        <div class="reward-item">
                            <div class="reward-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
                            </div>
                            <div class="reward-info">
                                <div class="reward-title">好友首次购课</div>
                                <div class="reward-desc">好友购买任意付费课程</div>
                            </div>
                            <div class="reward-value">+200 积分</div>
                        </div>
                        <div class="reward-item">
                            <div class="reward-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                            </div>
                            <div class="reward-info">
                                <div class="reward-title">好友获得奖励</div>
                                <div class="reward-desc">新用户专享注册礼包</div>
                            </div>
                            <div class="reward-value">+100 积分</div>
                        </div>
                    </div>
                </div>

                <div class="history-section">
                    <h3 class="history-title">邀请记录</h3>
                    <div class="history-list" id="historyList">
                        <div class="empty-state">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 4-6 8-6s8 2 8 6"/><path d="M16 4l2 2 4-4"/></svg>
                            <p>还没有邀请记录，快去邀请好友吧</p>
                        </div>
                    </div>
                </div>

                <!-- 邀请排行榜 -->
                <div class="leaderboard-section">
                    <h3 class="leaderboard-title"><i class="fas fa-trophy"></i> 邀请排行榜</h3>
                    <div class="leaderboard-list" id="leaderboardList">
                        <div class="empty-state">
                            <p>暂无排行数据</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-text">2025 AI 信息未来</div>
                <div class="footer-links"><a href="#" class="footer-link">关于我们</a><a href="#" class="footer-link">使用条款</a></div>
            </div>
        </div>
    </footer>

    <div id="toast" class="toast"></div>

    <script>
        const API_BASE = '/api';
        let inviteCode = '';

        document.addEventListener('DOMContentLoaded', () => { initTheme();  loadInviteData(); });

        function initTheme() {
            const saved = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', saved);
            updateThemeIcon(saved);
            document.getElementById('themeToggle').addEventListener('click', () => {
                const current = document.documentElement.getAttribute('data-theme');
                const next = current === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', next);
                localStorage.setItem('theme', next);
                updateThemeIcon(next);
            });
        }

        function updateThemeIcon(theme) { document.querySelector('#themeToggle i').className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon'; }

                }

                function logout() { localStorage.removeItem('token'); localStorage.removeItem('user'); location.reload(); }
        
        async function loadInviteData() {
            try {
                const res = await fetch(`${API_BASE}/invitation/my`, { headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` } });
                const data = await res.json();
                if (data.code === 200 && data.data) {
                    inviteCode = data.data.inviteCode || generateCode();
                    document.getElementById('inviteCode').textContent = inviteCode;
                    document.getElementById('inviteLink').value = `${window.location.origin}/pages/register.html?ref=${inviteCode}`;
                    document.getElementById('inviteCount').textContent = data.data.inviteCount || 0;
                    document.getElementById('successCount').textContent = data.data.successCount || 0;
                    document.getElementById('rewardPoints').textContent = data.data.rewardPoints || 0;
                    if (data.data.records && data.data.records.length > 0) {
                        renderHistory(data.data.records);
                    }
                } else {
                    setDefaultCode();
                }
            } catch (e) {
                setDefaultCode();
            }
        }

        function setDefaultCode() {
            inviteCode = generateCode();
            document.getElementById('inviteCode').textContent = inviteCode;
            document.getElementById('inviteLink').value = `${window.location.origin}/pages/register.html?ref=${inviteCode}`;
        }

        function generateCode() {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            return (user.username || 'USER').toUpperCase().slice(0, 4) + Math.random().toString(36).substring(2, 6).toUpperCase();
        }

        function renderHistory(list) {
            const container = document.getElementById('historyList');
            container.innerHTML = list.map(item => `
                <div class="history-item">
                    <div>
                        <div class="history-user">${item.username || '用户'}</div>
                        <div class="history-time">${formatDate(item.createdAt)}</div>
                    </div>
                    <div class="history-reward">+${item.reward || 50} 积分</div>
                </div>
            `).join('');
        }

        function copyCode() {
            navigator.clipboard.writeText(inviteCode).then(() => showToast('邀请码已复制')).catch(() => showToast('复制失败'));
        }

        function copyLink() {
            const link = document.getElementById('inviteLink').value;
            navigator.clipboard.writeText(link).then(() => showToast('链接已复制')).catch(() => showToast('复制失败'));
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('zh-CN');
        }

        function showToast(msg) { const t = document.getElementById('toast'); t.textContent = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 3000); }

        // 二维码生成
        let qrInstance = null;
        function generateQRCode() {
            const link = document.getElementById('inviteLink').value;
            if (!link) return;

            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';

            qrInstance = new QRCode(qrContainer, {
                text: link,
                width: 130,
                height: 130,
                colorDark: '#000000',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.M
            });
        }

        function downloadQR() {
            const canvas = document.querySelector('#qrcode canvas');
            if (!canvas) {
                showToast('请先生成二维码');
                return;
            }
            const link = document.createElement('a');
            link.download = 'invite-qrcode.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
            showToast('二维码已保存');
        }

        // 社交分享
        function shareToWechat() {
            showToast('请截图保存二维码分享到微信');
        }

        function shareToWeibo() {
            const link = document.getElementById('inviteLink').value;
            const text = encodeURIComponent('我在AI信息未来学习AI课程，快来和我一起学习吧！');
            const url = encodeURIComponent(link);
            window.open(`https://service.weibo.com/share/share.php?title=${text}&url=${url}`, '_blank', 'width=600,height=500');
        }

        function shareToQQ() {
            const link = document.getElementById('inviteLink').value;
            const title = encodeURIComponent('AI信息未来 - 专业AI学习平台');
            const summary = encodeURIComponent('我正在学习AI课程，使用我的邀请码注册可以获得额外积分奖励！');
            const url = encodeURIComponent(link);
            window.open(`https://connect.qq.com/widget/shareqq/index.html?url=${url}&title=${title}&summary=${summary}`, '_blank', 'width=600,height=500');
        }

        // 加载邀请排行榜
        async function loadLeaderboard() {
            try {
                const res = await fetch(`${API_BASE}/invitation/leaderboard`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                    }
                });
                });
                const data = await res.json();
                if (data.code === 200 && data.data && data.data.length > 0) {
                    renderLeaderboard(data.data);
                } else {
                    // 使用示例数据
                    renderLeaderboard([
                        { username: '学习达人', inviteCount: 28, rewardPoints: 2800 },
                        { username: 'AI探索者', inviteCount: 19, rewardPoints: 1900 },
                        { username: '技术先锋', inviteCount: 15, rewardPoints: 1500 }
                    ]);
                }
            } catch (e) {
                // 使用示例数据
                renderLeaderboard([
                    { username: '学习达人', inviteCount: 28, rewardPoints: 2800 },
                    { username: 'AI探索者', inviteCount: 19, rewardPoints: 1900 },
                    { username: '技术先锋', inviteCount: 15, rewardPoints: 1500 }
                ]);
            }
        }

        function renderLeaderboard(list) {
            const container = document.getElementById('leaderboardList');
            const rankClasses = ['gold', 'silver', 'bronze'];

            container.innerHTML = list.slice(0, 10).map((item, index) => {
                const rankClass = index < 3 ? rankClasses[index] : 'normal';
                const initial = (item.username || 'U').charAt(0).toUpperCase();
                return `
                    <div class="leaderboard-item">
                        <div class="leaderboard-rank ${rankClass}">${index + 1}</div>
                        <div class="leaderboard-avatar">${initial}</div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">${item.username || '用户'}</div>
                            <div class="leaderboard-count">邀请 ${item.inviteCount || 0} 人</div>
                        </div>
                        <div class="leaderboard-points">+${item.rewardPoints || 0}</div>
                    </div>
                `;
            }).join('');
        }

        // 初始化时加载排行榜和生成二维码
        setTimeout(() => {
            generateQRCode();
            loadLeaderboard();
        }, 500);
        });
    </script>
    <script src="/js/app-shell.js"></script>
    
</body>
</html>
