<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人主页 - 学习圈</title>
    <link rel="stylesheet" href="/assets/skins/app-shell.css">
<link rel="stylesheet" href="../styles/apple-design.css">
    <style>
        /* 页面布局 */
        body {
            padding-top: 48px;
            min-height: 100vh;
        }

        /* 返回导航 */
        .back-nav {
            position: fixed;
            top: 48px;
            left: 0;
            right: 0;
            height: 52px;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 22px;
            z-index: 999;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 15px;
            transition: color var(--transition-fast);
        }

        .back-btn:hover {
            color: var(--accent);
        }

        .back-icon {
            width: 20px;
            height: 20px;
            stroke: currentColor;
        }

        .nav-actions {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .icon-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: var(--bg-hover);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .icon-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .icon-btn svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
        }

        /* 个人信息区 */
        .profile-section {
            margin-top: 52px;
            padding: 48px 0 32px;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
        }

        .profile-header {
            max-width: 980px;
            margin: 0 auto;
            padding: 0 22px;
            display: grid;
            grid-template-columns: 120px 1fr auto;
            gap: 32px;
            align-items: start;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-badge {
            position: absolute;
            bottom: 4px;
            right: 4px;
            width: 28px;
            height: 28px;
            background: #ffd700;
            border: 3px solid var(--bg-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .badge-icon {
            width: 16px;
            height: 16px;
            fill: #fff;
        }

        .profile-info {
            min-width: 0;
        }

        .profile-name {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .verified-badge {
            background: var(--accent);
            color: white;
            padding: 3px 10px;
            border-radius: var(--radius-full);
            font-size: 13px;
            font-weight: 500;
        }

        .profile-id {
            font-size: 14px;
            color: var(--text-tertiary);
            margin-bottom: 16px;
        }

        .profile-bio {
            font-size: 15px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .profile-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .profile-tag {
            padding: 5px 12px;
            background: var(--bg-secondary);
            border-radius: var(--radius-full);
            font-size: 13px;
            color: var(--text-secondary);
        }

        .profile-stats {
            display: flex;
            gap: 32px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-size: 21px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        .profile-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .follow-btn {
            padding: 10px 28px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: var(--radius-full);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
        }

        .follow-btn:hover {
            background: var(--accent-hover);
        }

        .follow-btn.following {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-strong);
        }

        .message-btn, .edit-profile-btn {
            padding: 10px 28px;
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-strong);
            border-radius: var(--radius-full);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
        }

        .message-btn:hover, .edit-profile-btn:hover {
            background: var(--bg-hover);
        }

        /* 内容标签页 */
        .content-tabs {
            position: sticky;
            top: 100px;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            z-index: 998;
        }

        .tabs-wrapper {
            max-width: 980px;
            margin: 0 auto;
            padding: 0 22px;
            display: flex;
            gap: 32px;
        }

        .tab {
            padding: 16px 0;
            color: var(--text-secondary);
            cursor: pointer;
            position: relative;
            transition: color var(--transition-fast);
            font-size: 15px;
            font-weight: 400;
        }

        .tab:hover {
            color: var(--text-primary);
        }

        .tab.active {
            color: var(--text-primary);
            font-weight: 500;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent);
            border-radius: 1px;
        }

        .tab-count {
            margin-left: 6px;
            color: var(--text-tertiary);
            font-size: 14px;
        }

        /* 内容区域 */
        .content-area {
            max-width: 980px;
            margin: 0 auto;
            padding: 32px 22px 80px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* 笔记网格 */
        .notes-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        .note-item {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            overflow: hidden;
            cursor: pointer;
            transition: transform var(--transition-fast), box-shadow var(--transition-fast);
            border: 1px solid var(--border-color);
        }

        .note-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-card);
        }

        .note-cover {
            position: relative;
            aspect-ratio: 1;
            background: var(--bg-secondary);
        }

        .note-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .note-type {
            position: absolute;
            top: 8px;
            left: 8px;
            padding: 4px 10px;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 12px;
            border-radius: 6px;
            font-weight: 500;
        }

        .note-info {
            padding: 12px;
        }

        .note-title {
            font-size: 15px;
            color: var(--text-primary);
            line-height: 1.4;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .note-stats {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 13px;
            color: var(--text-tertiary);
        }

        .note-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .note-stat svg {
            width: 14px;
            height: 14px;
            stroke: currentColor;
        }

        /* 收藏展示 */
        .collection-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .collection-item {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            padding: 20px;
            cursor: pointer;
            transition: transform var(--transition-fast), box-shadow var(--transition-fast);
            border: 1px solid var(--border-color);
        }

        .collection-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-card);
        }

        .collection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .collection-title {
            font-size: 17px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .collection-count {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        .collection-preview {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
            border-radius: 8px;
            overflow: hidden;
        }

        .preview-item {
            aspect-ratio: 1;
            background: var(--bg-secondary);
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* 点赞列表 */
        .likes-list {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .like-item {
            display: flex;
            gap: 16px;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .like-item:last-child {
            border-bottom: none;
        }

        .like-item:hover {
            background: var(--bg-hover);
            margin: 0 -20px;
            padding-left: 20px;
            padding-right: 20px;
            border-radius: var(--radius-sm);
        }

        .like-thumbnail {
            width: 80px;
            height: 80px;
            border-radius: var(--radius-sm);
            background: var(--bg-secondary);
            flex-shrink: 0;
            overflow: hidden;
        }

        .like-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .like-content {
            flex: 1;
            min-width: 0;
        }

        .like-title {
            font-size: 15px;
            color: var(--text-primary);
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .like-author {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-bottom: 8px;
        }

        .like-stats {
            display: flex;
            gap: 16px;
            font-size: 13px;
            color: var(--text-tertiary);
        }

        .like-stats svg {
            width: 14px;
            height: 14px;
            stroke: currentColor;
        }

        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
        }

        .empty-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            opacity: 0.3;
            stroke: var(--text-tertiary);
        }

        .empty-text {
            font-size: 17px;
            color: var(--text-tertiary);
        }

        /* 响应式设计 */
        @media (max-width: 1024px) {
            .notes-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .collection-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .profile-header {
                grid-template-columns: 1fr;
                gap: 24px;
                text-align: center;
            }

            .profile-avatar {
                width: 100px;
                height: 100px;
                font-size: 40px;
                margin: 0 auto;
            }

            .profile-name {
                justify-content: center;
            }

            .profile-stats {
                justify-content: center;
            }

            .profile-actions {
                flex-direction: row;
            }

            .notes-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .collection-grid {
                grid-template-columns: 1fr;
            }

            .tabs-wrapper {
                gap: 24px;
            }

            .tab {
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .profile-avatar {
                width: 80px;
                height: 80px;
                font-size: 32px;
            }

            .profile-name {
                font-size: 24px;
            }

            .notes-grid {
                grid-template-columns: 1fr;
            }

            .tabs-wrapper {
                gap: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="nav">
        <div class="nav-inner">
            <a href="/" class="nav-logo">学习平台</a>
            <div class="nav-menu">
                <a href="/" class="nav-link">首页</a>
                <a href="/courses.html" class="nav-link">课程</a>
                <a href="/community.html" class="nav-link active">社区</a>
                <a href="/arena.html" class="nav-link">PK竞技</a>
            </div>
            <div class="nav-actions">
                <div id="authArea"></div>
                <button class="theme-toggle" onclick="toggleTheme()" aria-label="切换主题">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3"/>
                        <line x1="12" y1="21" x2="12" y2="23"/>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                        <line x1="1" y1="12" x2="3" y2="12"/>
                        <line x1="21" y1="12" x2="23" y2="12"/>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                    </svg>
                </button>
                
                </div>
            </div>
        </div>
    </nav>

    <!-- 返回导航 -->
    <div class="back-nav">
        <a href="community.html" class="back-btn">
            <svg class="back-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
            <span>返回</span>
        </a>
        <div class="nav-actions">
                <div id="authArea"></div>
            <button class="icon-btn" aria-label="搜索">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.35-4.35"/>
                </svg>
            </button>
            <button class="icon-btn" aria-label="设置">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M12 1v6m0 6v6M1 12h6m6 0h6"/>
                </svg>
            </button>
            <button class="icon-btn" aria-label="分享">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8M16 6l-4-4-4 4M12 2v13"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- 个人信息区 -->
    <div class="profile-section">
        <div class="profile-header">
            <div class="profile-avatar" id="profileAvatar">
                <span id="avatarText">用</span>
                <div class="avatar-badge">
                    <svg class="badge-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                    </svg>
                </div>
            </div>

            <div class="profile-info">
                <h1 class="profile-name">
                    <span id="userName">用户名</span>
                    <span class="verified-badge" id="verifiedBadge" style="display: none;">认证用户</span>
                </h1>
                <div class="profile-id" id="profileId">ID: 000000</div>
                <div class="profile-bio" id="profileBio">这个人很懒，什么都没有留下...</div>
                <div class="profile-tags" id="profileTags"></div>
                <div class="profile-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="followersCount">0</div>
                        <div class="stat-label">粉丝</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="followingCount">0</div>
                        <div class="stat-label">关注</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="likesCount">0</div>
                        <div class="stat-label">获赞</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="notesCount">0</div>
                        <div class="stat-label">笔记</div>
                    </div>
                </div>
            </div>

            <div class="profile-actions">
                <button class="follow-btn" id="followBtn" onclick="toggleFollow()" style="display: none;">关注</button>
                <button class="message-btn" id="messageBtn" onclick="sendMessage()" style="display: none;">私信</button>
                <button class="edit-profile-btn" id="editProfileBtn" onclick="editProfile()" style="display: none;">编辑资料</button>
            </div>
        </div>
    </div>

    <!-- 内容标签页 -->
    <div class="content-tabs">
        <div class="tabs-wrapper">
            <div class="tab active" onclick="switchTab('notes', this)">
                笔记<span class="tab-count" id="notesTabCount">0</span>
            </div>
            <div class="tab" onclick="switchTab('collections', this)">
                收藏<span class="tab-count" id="collectionsTabCount">0</span>
            </div>
            <div class="tab" onclick="switchTab('likes', this)">
                点赞<span class="tab-count" id="likesTabCount">0</span>
            </div>
        </div>
    </div>

    <!-- 内容区域 -->
    <div class="content-area">
        <!-- 笔记内容 -->
        <div id="notes" class="tab-content active">
            <div class="notes-grid" id="notesGrid">
                <!-- 笔记将通过 JavaScript 动态加载 -->
            </div>
        </div>

        <!-- 收藏内容 -->
        <div id="collections" class="tab-content">
            <div class="collection-grid" id="collectionsGrid">
                <!-- 收藏将通过 JavaScript 动态加载 -->
            </div>
        </div>

        <!-- 点赞内容 -->
        <div id="likes" class="tab-content">
            <div class="likes-list" id="likesList">
                <!-- 点赞将通过 JavaScript 动态加载 -->
            </div>
        </div>
    </div>

    <script>
        // API 配置
        const API_BASE = '/api';

        // 获取 URL 参数
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('userId');

        // 获取当前用户信息
        let currentUser = null;
        const token = localStorage.getItem('token');
        const userStr = localStorage.getItem('user');
        if (userStr) {
            try {
                currentUser = JSON.parse(userStr);
            } catch (e) {
                console.error('解析用户信息失败:', e);
            }
        }

        // 是否是自己的主页
        const isOwnProfile = !userId || (currentUser && userId == currentUser.id);

        // 主题切换
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // 初始化主题
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        }

        // 切换标签页
        function switchTab(tabName, element) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            element.classList.add('active');

            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
        }

        // 切换关注状态
        async function toggleFollow() {
            if (!token) {
                alert('请先登录');
                window.location.href = 'login.html';
                return;
            }

            const btn = document.getElementById('followBtn');
            const isFollowing = btn.classList.contains('following');

            try {
                const response = await fetch(`${API_BASE}/user/${userId}/follow`, {
                    method: isFollowing ? 'DELETE' : 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'

                if (response.ok) {
                    if (isFollowing) {
                        btn.classList.remove('following');
                        btn.textContent = '关注';
                    } else {
                        btn.classList.add('following');
                        btn.textContent = '已关注';
                    }
                    loadUserProfile();
                } else {
                    throw new Error('操作失败');
                }
            } catch (error) {
                console.error('关注操作失败:', error);
                alert('操作失败，请重试');
            }
        }

        // 发送私信
        function sendMessage() {
            if (!token) {
                alert('请先登录');
                window.location.href = 'login.html';
                return;
            }
            alert('私信功能开发中...');
        }

        // 编辑资料
        function editProfile() {
            window.location.href = 'profile-enhanced.html';
        }

        // 查看笔记详情
        function viewNote(noteId) {
            window.location.href = `note-detail.html?id=${noteId}`;
        }

        // 查看收藏夹
        function viewCollection(collectionId) {
            window.location.href = `collection.html?id=${collectionId}`;
        }

        // 加载用户资料
        async function loadUserProfile() {
            try {
                const targetUserId = userId || (currentUser ? currentUser.id : null);
                if (!targetUserId) {
                    showError('用户ID不存在');
                    return;
                }

                const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
                const response = await fetch(`${API_BASE}/user/profile/${targetUserId}`, { headers });

                if (response.ok) {
                    const data = await response.json();
                    const profile = data.data || data;

                    // 更新头像
                    const avatarText = document.getElementById('avatarText');
                    avatarText.textContent = profile.username ? profile.username.charAt(0).toUpperCase() : 'U';

                    // 更新用户名
                    document.getElementById('userName').textContent = profile.username || '未知用户';

                    // 更新 ID
                    document.getElementById('profileId').textContent = `ID: ${profile.id || '000000'}`;

                    // 更新简介
                    if (profile.bio) {
                        document.getElementById('profileBio').textContent = profile.bio;
                    }

                    // 更新标签
                    if (profile.tags && profile.tags.length > 0) {
                        const tagsHtml = profile.tags.map(tag =>
                            `<span class="profile-tag">${tag}</span>`
                        ).join('');
                        document.getElementById('profileTags').innerHTML = tagsHtml;
                    }

                    // 更新统计数据
                    document.getElementById('followersCount').textContent = formatNumber(profile.followersCount || 0);
                    document.getElementById('followingCount').textContent = formatNumber(profile.followingCount || 0);
                    document.getElementById('likesCount').textContent = formatNumber(profile.likesCount || 0);
                    document.getElementById('notesCount').textContent = formatNumber(profile.notesCount || 0);

                    // 更新标签页计数
                    document.getElementById('notesTabCount').textContent = profile.notesCount || 0;
                    document.getElementById('collectionsTabCount').textContent = profile.collectionsCount || 0;
                    document.getElementById('likesTabCount').textContent = profile.likesCount || 0;

                    // 显示认证徽章
                    if (profile.verified) {
                        document.getElementById('verifiedBadge').style.display = 'inline-block';
                    }

                    // 显示操作按钮
                    if (isOwnProfile) {
                        document.getElementById('editProfileBtn').style.display = 'block';
                    } else {
                        const followBtn = document.getElementById('followBtn');
                        const messageBtn = document.getElementById('messageBtn');

                        followBtn.style.display = 'block';
                        messageBtn.style.display = 'block';

                        if (profile.isFollowing) {
                            followBtn.classList.add('following');
                            followBtn.textContent = '已关注';
                        }
                    }
                } else {
                    throw new Error('加载用户资料失败');
                }
            } catch (error) {
                console.error('加载用户资料失败:', error);
                showError('加载失败，请刷新重试');
            }
        }

        // 加载笔记
        async function loadNotes() {
            try {
                const targetUserId = userId || (currentUser ? currentUser.id : null);
                const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
                const response = await fetch(`${API_BASE}/social/notes/user/${targetUserId}`, { headers });

                if (response.ok) {
                    const data = await response.json();
                    const notes = data.data || data || [];

                    const grid = document.getElementById('notesGrid');
                    if (notes.length === 0) {
                        grid.innerHTML = createEmptyState('暂无笔记');
                        return;
                    }

                    grid.innerHTML = notes.map(note => `
                        <div class="note-item" onclick="viewNote(${note.id})">
                            <div class="note-cover">
                                ${note.coverImage ? `<img src="${note.coverImage}" alt="${note.title}">` :
                                  `<div style="width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>`}
                                <span class="note-type">${note.type || '笔记'}</span>
                            </div>
                            <div class="note-info">
                                <div class="note-title">${note.title}</div>
                                <div class="note-stats">
                                    <span class="note-stat">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                        </svg>
                                        ${formatNumber(note.likes || 0)}
                                    </span>
                                    <span class="note-stat">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                        </svg>
                                        ${formatNumber(note.comments || 0)}
                                    </span>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('加载笔记失败:', error);
                document.getElementById('notesGrid').innerHTML = createEmptyState('加载失败');
            }
        }

        // 加载收藏
        async function loadCollections() {
            try {
                const targetUserId = userId || (currentUser ? currentUser.id : null);
                const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
                const response = await fetch(`${API_BASE}/social/collections/user/${targetUserId}`, { headers });

                if (response.ok) {
                    const data = await response.json();
                    const collections = data.data || data || [];

                    const grid = document.getElementById('collectionsGrid');
                    if (collections.length === 0) {
                        grid.innerHTML = createEmptyState('暂无收藏');
                        return;
                    }

                    grid.innerHTML = collections.map(collection => `
                        <div class="collection-item" onclick="viewCollection(${collection.id})">
                            <div class="collection-header">
                                <h3 class="collection-title">${collection.title}</h3>
                                <span class="collection-count">${collection.count || 0}篇</span>
                            </div>
                            <div class="collection-preview">
                                ${(collection.previews || []).slice(0, 6).map(preview => `
                                    <div class="preview-item">
                                        ${preview.image ? `<img src="${preview.image}" alt="">` :
                                          `<div style="width: 100%; height: 100%; background: linear-gradient(135deg, ${getRandomColor()} 0%, ${getRandomColor()} 100%);"></div>`}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('加载收藏失败:', error);
                document.getElementById('collectionsGrid').innerHTML = createEmptyState('加载失败');
            }
        }

        // 加载点赞
        async function loadLikes() {
            try {
                const targetUserId = userId || (currentUser ? currentUser.id : null);
                const headers = token ? { 'Authorization': `Bearer ${token}` } : {};
                const response = await fetch(`${API_BASE}/social/likes/user/${targetUserId}`, { headers });

                if (response.ok) {
                    const data = await response.json();
                    const likes = data.data || data || [];

                    const list = document.getElementById('likesList');
                    if (likes.length === 0) {
                        list.innerHTML = createEmptyState('暂无点赞');
                        return;
                    }

                    list.innerHTML = likes.map(like => `
                        <div class="like-item" onclick="viewNote(${like.noteId || like.id})">
                            <div class="like-thumbnail">
                                ${like.thumbnail ? `<img src="${like.thumbnail}" alt="${like.title}">` :
                                  `<div style="width: 100%; height: 100%; background: linear-gradient(135deg, ${getRandomColor()} 0%, ${getRandomColor()} 100%);"></div>`}
                            </div>
                            <div class="like-content">
                                <div class="like-title">${like.title}</div>
                                <div class="like-author">${like.author || '未知作者'}</div>
                                <div class="like-stats">
                                    <span>${formatNumber(like.likes || 0)} 赞</span>
                                    <span>${formatNumber(like.comments || 0)} 评论</span>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('加载点赞失败:', error);
                document.getElementById('likesList').innerHTML = createEmptyState('加载失败');
            }
        }

        // 格式化数字
        function formatNumber(num) {
            if (num >= 10000) {
                return (num / 10000).toFixed(1) + 'w';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'k';
            }
            return num.toString();
        }

        // 获取随机颜色
        function getRandomColor() {
            const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#fa709a', '#fee140',
                           '#a8edea', '#fed6e3', '#ffecd2', '#fcb69f', '#a1c4fd', '#c2e9fb'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // 创建空状态
        function createEmptyState(text) {
            return `
                <div class="empty-state">
                    <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                    <div class="empty-text">${text}</div>
                </div>
            `;
        }

        // 显示错误
        function showError(message) {
            alert(message);
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();

            // 设置当前用户初始字母
            if (currentUser && currentUser.username) {
                document.getElementById('userInitial').textContent = currentUser.username.charAt(0).toUpperCase();
            }

            // 加载数据
            loadUserProfile();
            loadNotes();
            loadCollections();
            loadLikes();
        });
    </script>
    <script src="/js/app-shell.js"></script>
    
</body>
</html>
