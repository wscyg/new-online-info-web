<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学习小组 - AI 信息未来</title>
    <link rel="stylesheet" href="/assets/skins/app-shell.css">
<link rel="stylesheet" href="../styles/apple-design.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }

        /* 主布局 */
        .app-container {
            display: flex;
            height: 100vh;
            padding-top: 48px;
            background: var(--bg-secondary);
        }

        /* 侧边栏 */
        .sidebar {
            width: 72px;
            background: var(--bg-card);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 16px 0;
            gap: 8px;
        }

        .sidebar-item {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
        }

        .sidebar-item:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .sidebar-item.active {
            background: var(--accent);
            color: white;
        }

        .sidebar-item svg {
            width: 24px;
            height: 24px;
        }

        .notification-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 6px;
            height: 6px;
            background: #ff3b30;
            border-radius: 50%;
        }

        /* 群组列表面板 */
        .groups-panel {
            width: 300px;
            background: var(--bg-card);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            padding: 20px 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .panel-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 10px 16px 10px 36px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 15px;
            color: var(--text-primary);
            transition: all var(--transition-fast);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
        }

        .search-icon svg {
            width: 16px;
            height: 16px;
        }

        /* 标签切换 */
        .group-tabs {
            display: flex;
            padding: 0 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .tab-item {
            flex: 1;
            padding: 12px 0;
            text-align: center;
            font-size: 14px;
            color: var(--text-secondary);
            cursor: pointer;
            position: relative;
            transition: color var(--transition-fast);
        }

        .tab-item.active {
            color: var(--accent);
            font-weight: 500;
        }

        .tab-item.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent);
        }

        .tab-count {
            background: var(--accent);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 11px;
            margin-left: 4px;
            font-weight: 500;
        }

        /* 群组列表 */
        .groups-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .group-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: background var(--transition-fast);
            margin-bottom: 4px;
            position: relative;
        }

        .group-item:hover {
            background: var(--bg-hover);
        }

        .group-item.active {
            background: var(--bg-hover);
        }

        .group-avatar {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            flex-shrink: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .group-info {
            flex: 1;
            min-width: 0;
        }

        .group-name {
            font-weight: 500;
            font-size: 15px;
            color: var(--text-primary);
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .group-badge {
            padding: 2px 6px;
            background: #34c759;
            color: white;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
        }

        .group-last-message {
            font-size: 13px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .group-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }

        .group-time {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .unread-count {
            background: var(--accent);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 11px;
            min-width: 18px;
            text-align: center;
            font-weight: 500;
        }

        .online-indicator {
            width: 10px;
            height: 10px;
            background: #34c759;
            border-radius: 50%;
            position: absolute;
            bottom: 12px;
            left: 48px;
            border: 2px solid var(--bg-card);
        }

        /* 创建按钮 */
        .create-group-btn {
            margin: 12px 16px;
            width: calc(100% - 32px);
        }

        /* 聊天区域 */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
        }

        .chat-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-card);
        }

        .chat-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .chat-info {
            display: flex;
            flex-direction: column;
        }

        .chat-name {
            font-size: 17px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chat-status {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .chat-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: var(--bg-hover);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .action-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .action-btn svg {
            width: 18px;
            height: 18px;
        }

        /* 消息区域 */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            display: flex;
            gap: 12px;
            max-width: 70%;
        }

        .message.self {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .message-content {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .message-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .message.self .message-info {
            justify-content: flex-end;
        }

        .message-bubble {
            padding: 10px 14px;
            background: var(--bg-card);
            border-radius: 16px;
            font-size: 15px;
            line-height: 1.4;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .message.self .message-bubble {
            background: var(--accent);
            color: white;
            border: none;
        }

        .message-image {
            max-width: 300px;
            border-radius: var(--radius-md);
            cursor: pointer;
        }

        .system-message {
            text-align: center;
            font-size: 12px;
            color: var(--text-tertiary);
            padding: 8px;
        }

        /* 输入区域 */
        .input-area {
            padding: 16px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            align-items: flex-end;
            background: var(--bg-card);
        }

        .input-tools {
            display: flex;
            gap: 8px;
        }

        .tool-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: var(--bg-hover);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .tool-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .tool-btn svg {
            width: 18px;
            height: 18px;
        }

        .message-input {
            flex: 1;
            padding: 10px 14px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-family: var(--font-sans);
            font-size: 15px;
            color: var(--text-primary);
            resize: none;
            min-height: 36px;
            max-height: 120px;
            line-height: 1.4;
            transition: all var(--transition-fast);
        }

        .message-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.1);
        }

        .send-btn {
            height: 36px;
        }

        /* 右侧信息面板 */
        .info-panel {
            width: 300px;
            background: var(--bg-card);
            border-left: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .info-section {
            padding: 20px 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .section-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .member-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .member-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: background var(--transition-fast);
        }

        .member-item:hover {
            background: var(--bg-hover);
        }

        .member-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            position: relative;
        }

        .member-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            position: absolute;
            bottom: 0;
            right: 0;
            border: 2px solid var(--bg-card);
        }

        .status-online { background: #34c759; }
        .status-away { background: #ff9500; }
        .status-offline { background: var(--text-tertiary); }

        .member-info {
            flex: 1;
        }

        .member-name {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .member-role {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .mentor-badge {
            padding: 2px 6px;
            background: #ff3b30;
            color: white;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
        }

        /* 快速操作 */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .quick-action {
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .quick-action:hover {
            background: var(--bg-hover);
            transform: translateY(-2px);
        }

        .quick-action svg {
            width: 24px;
            height: 24px;
            color: var(--accent);
            margin-bottom: 4px;
        }

        .quick-action-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* 师徒卡片 */
        .mentor-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: var(--radius-md);
            padding: 16px;
            color: white;
        }

        .mentor-title {
            font-size: 14px;
            margin-bottom: 12px;
            opacity: 0.9;
        }

        .mentor-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .mentor-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .mentor-details {
            flex: 1;
        }

        .mentor-name {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .mentor-level {
            font-size: 13px;
            opacity: 0.9;
        }

        .mentor-btn {
            padding: 6px 14px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: var(--radius-full);
            font-size: 13px;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .mentor-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 480px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--bg-hover);
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all var(--transition-fast);
        }

        .modal-close:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .btn-cancel {
            background: var(--bg-hover);
            color: var(--text-secondary);
        }

        .btn-cancel:hover {
            background: var(--bg-secondary);
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="nav">
        <div class="nav-inner">
            <div class="nav-logo">AI 信息未来</div>
            <div class="nav-menu">
                <a href="../index.html" class="nav-link">首页</a>
                <a href="courses.html" class="nav-link">课程</a>
                <a href="community.html" class="nav-link">社区</a>
                <a href="code-arena.html" class="nav-link">PK竞技</a>
            </div>
            <div class="nav-actions">
                <div id="authArea"></div>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <line x1="12" y1="1" x2="12" y2="3"/>
                        <line x1="12" y1="21" x2="12" y2="23"/>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                        <line x1="1" y1="12" x2="3" y2="12"/>
                        <line x1="21" y1="12" x2="23" y2="12"/>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                    </svg>
                </button>
                
                </div>
            </div>
        </div>
    </nav>

    <!-- 主容器 -->
    <div class="app-container">
        <!-- 左侧边栏 -->
        <div class="sidebar">
            <div class="sidebar-item active">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                </svg>
                <span class="notification-badge"></span>
            </div>
            <div class="sidebar-item" onclick="showContacts()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
            </div>
            <div class="sidebar-item" onclick="showStudyGroups()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                </svg>
            </div>
            <div class="sidebar-item" onclick="showMentorSystem()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
                    <path d="M6 12v5c3 3 9 3 12 0v-5"/>
                </svg>
            </div>
            <div class="sidebar-item" onclick="showOnlineUsers()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 6v6l4 2"/>
                </svg>
            </div>
        </div>

        <!-- 群组列表面板 -->
        <div class="groups-panel">
            <div class="panel-header">
                <h2 class="panel-title">消息</h2>
                <div class="search-box">
                    <span class="search-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="m21 21-4.35-4.35"/>
                        </svg>
                    </span>
                    <input type="text" class="search-input" placeholder="搜索群组或用户...">
                </div>
            </div>

            <div class="group-tabs">
                <div class="tab-item active" onclick="switchTab('all', this)">
                    全部
                    <span class="tab-count">5</span>
                </div>
                <div class="tab-item" onclick="switchTab('groups', this)">
                    群组
                </div>
                <div class="tab-item" onclick="switchTab('private', this)">
                    私聊
                </div>
            </div>

            <div class="groups-list">
                <!-- 学习小组 -->
                <div class="group-item active" onclick="selectGroup(this, 'group')">
                    <div class="group-avatar">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                        </svg>
                    </div>
                    <div class="group-info">
                        <div class="group-name">
                            前端进阶学习组
                            <span class="group-badge">156人</span>
                        </div>
                        <div class="group-last-message">李明: 今晚8点直播分享Vue3...</div>
                    </div>
                    <div class="group-meta">
                        <div class="group-time">10:23</div>
                        <div class="unread-count">12</div>
                    </div>
                </div>

                <!-- 师徒群 -->
                <div class="group-item" onclick="selectGroup(this, 'mentor')">
                    <div class="group-avatar">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <path d="M22 10v6M2 10l10-5 10 5-10 5z"/>
                            <path d="M6 12v5c3 3 9 3 12 0v-5"/>
                        </svg>
                    </div>
                    <div class="group-info">
                        <div class="group-name">
                            张老师的门下
                            <span class="group-badge">师徒</span>
                        </div>
                        <div class="group-last-message">师父: 作业都完成了吗？</div>
                    </div>
                    <div class="group-meta">
                        <div class="group-time">昨天</div>
                        <div class="unread-count">3</div>
                    </div>
                </div>

                <!-- 私聊 -->
                <div class="group-item" onclick="selectGroup(this, 'private')">
                    <div class="group-avatar">王</div>
                    <div class="group-info">
                        <div class="group-name">王小芳</div>
                        <div class="group-last-message">好的，我看看这个问题</div>
                    </div>
                    <div class="group-meta">
                        <div class="group-time">15:30</div>
                    </div>
                    <div class="online-indicator"></div>
                </div>

                <!-- 项目组 -->
                <div class="group-item" onclick="selectGroup(this, 'group')">
                    <div class="group-avatar">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 16v-4"/>
                            <path d="M12 8h.01"/>
                        </svg>
                    </div>
                    <div class="group-info">
                        <div class="group-name">
                            React项目实战组
                            <span class="group-badge">89人</span>
                        </div>
                        <div class="group-last-message">赵强: 代码已提交到GitHub</div>
                    </div>
                    <div class="group-meta">
                        <div class="group-time">2小时前</div>
                    </div>
                </div>

                <!-- 私聊 -->
                <div class="group-item" onclick="selectGroup(this, 'private')">
                    <div class="group-avatar">刘</div>
                    <div class="group-info">
                        <div class="group-name">刘洋</div>
                        <div class="group-last-message">明天一起复习算法吗？</div>
                    </div>
                    <div class="group-meta">
                        <div class="group-time">周三</div>
                        <div class="unread-count">1</div>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary create-group-btn" onclick="showCreateGroup()">创建学习小组</button>
        </div>

        <!-- 聊天区域 -->
        <div class="chat-area">
            <div class="chat-header">
                <div class="chat-title">
                    <div class="chat-avatar">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                        </svg>
                    </div>
                    <div class="chat-info">
                        <div class="chat-name">前端进阶学习组</div>
                        <div class="chat-status">156位成员 · 23人在线</div>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="action-btn" onclick="startVoiceCall()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                        </svg>
                    </button>
                    <button class="action-btn" onclick="startVideoCall()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="23 7 16 12 23 17 23 7"/>
                            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                        </svg>
                    </button>
                    <button class="action-btn" onclick="showGroupInfo()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="16" x2="12" y2="12"/>
                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="messages-container" id="messagesContainer">
                <!-- 系统消息 -->
                <div class="system-message">
                    2024年3月15日
                </div>

                <!-- 其他人的消息 -->
                <div class="message">
                    <div class="message-avatar">李</div>
                    <div class="message-content">
                        <div class="message-info">
                            <span>李明</span>
                            <span>10:23</span>
                        </div>
                        <div class="message-bubble">
                            大家好！今晚8点我会在群里直播分享Vue3的Composition API使用技巧，欢迎大家参加！
                        </div>
                    </div>
                </div>

                <!-- 自己的消息 -->
                <div class="message self">
                    <div class="message-avatar">我</div>
                    <div class="message-content">
                        <div class="message-info">
                            <span>15:30</span>
                        </div>
                        <div class="message-bubble">
                            太好了，正好想学习这方面的内容！
                        </div>
                    </div>
                </div>

                <!-- 图片消息 -->
                <div class="message">
                    <div class="message-avatar">王</div>
                    <div class="message-content">
                        <div class="message-info">
                            <span>王小芳</span>
                            <span>16:45</span>
                        </div>
                        <div class="message-bubble">
                            这是我整理的Vue3学习脑图，分享给大家
                        </div>
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='200'%3E%3Crect width='300' height='200' fill='%23f0f0f0'/%3E%3Ctext x='150' y='100' text-anchor='middle' fill='%23999' font-size='16'%3EVue3 脑图%3C/text%3E%3C/svg%3E"
                             class="message-image" onclick="viewImage(this)">
                    </div>
                </div>

                <!-- 更多消息 -->
                <div class="message">
                    <div class="message-avatar">赵</div>
                    <div class="message-content">
                        <div class="message-info">
                            <span>赵强</span>
                            <span>17:20</span>
                        </div>
                        <div class="message-bubble">
                            有人一起刷LeetCode吗？我创建了一个刷题小组，每天打卡
                        </div>
                    </div>
                </div>

                <div class="message self">
                    <div class="message-avatar">我</div>
                    <div class="message-content">
                        <div class="message-info">
                            <span>17:25</span>
                        </div>
                        <div class="message-bubble">
                            我加入！正好需要提升算法能力
                        </div>
                    </div>
                </div>

                <!-- 系统通知 -->
                <div class="system-message">
                    群公告：本周六下午2点组织线下交流会，地点：北京中关村
                </div>
            </div>

            <div class="input-area">
                <div class="input-tools">
                    <button class="tool-btn" onclick="selectEmoji()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M8 14s1.5 2 4 2 4-2 4-2"/>
                            <line x1="9" y1="9" x2="9.01" y2="9"/>
                            <line x1="15" y1="9" x2="15.01" y2="9"/>
                        </svg>
                    </button>
                    <button class="tool-btn" onclick="selectFile()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
                        </svg>
                    </button>
                    <button class="tool-btn" onclick="selectImage()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <circle cx="8.5" cy="8.5" r="1.5"/>
                            <polyline points="21 15 16 10 5 21"/>
                        </svg>
                    </button>
                </div>
                <textarea class="message-input" id="messageInput" placeholder="输入消息..." onkeypress="handleKeyPress(event)"></textarea>
                <button class="btn btn-primary send-btn" onclick="sendMessage()">发送</button>
            </div>
        </div>

        <!-- 右侧信息面板 -->
        <div class="info-panel">
            <!-- 师徒关系 -->
            <div class="info-section">
                <div class="mentor-card">
                    <div class="mentor-title">我的导师</div>
                    <div class="mentor-info">
                        <div class="mentor-avatar">张</div>
                        <div class="mentor-details">
                            <div class="mentor-name">张教授</div>
                            <div class="mentor-level">高级讲师 · 10年经验</div>
                        </div>
                        <button class="mentor-btn" onclick="chatWithMentor()">私聊</button>
                    </div>
                </div>
            </div>

            <!-- 群成员 -->
            <div class="info-section">
                <h3 class="section-title">在线成员 (23)</h3>
                <div class="member-list">
                    <div class="member-item" onclick="startPrivateChat('李明')">
                        <div class="member-avatar">
                            李
                            <span class="member-status status-online"></span>
                        </div>
                        <div class="member-info">
                            <div class="member-name">
                                李明
                                <span class="mentor-badge">管理员</span>
                            </div>
                            <div class="member-role">前端架构师</div>
                        </div>
                    </div>

                    <div class="member-item" onclick="startPrivateChat('王小芳')">
                        <div class="member-avatar">
                            王
                            <span class="member-status status-online"></span>
                        </div>
                        <div class="member-info">
                            <div class="member-name">王小芳</div>
                            <div class="member-role">UI设计师</div>
                        </div>
                    </div>

                    <div class="member-item" onclick="startPrivateChat('赵强')">
                        <div class="member-avatar">
                            赵
                            <span class="member-status status-away"></span>
                        </div>
                        <div class="member-info">
                            <div class="member-name">赵强</div>
                            <div class="member-role">全栈工程师</div>
                        </div>
                    </div>

                    <div class="member-item" onclick="startPrivateChat('刘洋')">
                        <div class="member-avatar">
                            刘
                            <span class="member-status status-offline"></span>
                        </div>
                        <div class="member-info">
                            <div class="member-name">刘洋</div>
                            <div class="member-role">后端开发</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 快速操作 -->
            <div class="info-section">
                <h3 class="section-title">快速操作</h3>
                <div class="quick-actions">
                    <div class="quick-action" onclick="createStudyPlan()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        <div class="quick-action-label">学习计划</div>
                    </div>
                    <div class="quick-action" onclick="shareResource()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                            <polyline points="13 2 13 9 20 9"/>
                        </svg>
                        <div class="quick-action-label">共享资源</div>
                    </div>
                    <div class="quick-action" onclick="startLive()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="23 7 16 12 23 17 23 7"/>
                            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                        </svg>
                        <div class="quick-action-label">开始直播</div>
                    </div>
                    <div class="quick-action" onclick="createPoll()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"/>
                            <line x1="12" y1="20" x2="12" y2="4"/>
                            <line x1="6" y1="20" x2="6" y2="14"/>
                        </svg>
                        <div class="quick-action-label">发起投票</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 创建群组模态框 -->
    <div class="modal" id="createGroupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">创建学习小组</h3>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">小组名称</label>
                    <input type="text" class="form-input" placeholder="例如：Vue3进阶学习组">
                </div>
                <div class="form-group">
                    <label class="form-label">小组简介</label>
                    <textarea class="form-input" placeholder="介绍一下小组的学习目标和计划..." style="min-height: 100px; resize: vertical;"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">小组类型</label>
                    <select class="form-input">
                        <option>学习小组</option>
                        <option>项目团队</option>
                        <option>考试备考</option>
                        <option>兴趣交流</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">加入方式</label>
                    <select class="form-input">
                        <option>自由加入</option>
                        <option>需要审核</option>
                        <option>邀请加入</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeModal()">取消</button>
                <button class="btn btn-primary" onclick="createGroup()">创建小组</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';

        let currentRoomId = null;
        let studyRooms = [];

        // 主题切换
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // 初始化主题
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        }

        // 初始化用户信息
        function initUser() {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            if (user.nickname) {
                document.getElementById('userInitial').textContent = user.nickname[0];
            }
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', async function() {
            initTheme();
            initUser();
            await loadStudyRooms();
        });

        // 加载学习室列表
        async function loadStudyRooms() {
            try {
                const response = await fetch(`${API_BASE}/studyrooms/list?page=1&size=50`);
                const result = await response.json();

                if (result.code === 200 && result.data) {
                    studyRooms = result.data.rooms || [];
                    renderStudyRooms(studyRooms);
                }
            } catch (error) {
                console.error('加载学习室失败:', error);
            }
        }

        // 渲染学习室列表
        function renderStudyRooms(rooms) {
            const container = document.querySelector('.groups-list');
            if (!container || rooms.length === 0) return;

            const existingItems = container.querySelectorAll('.group-item');
            const staticCount = 2;

            rooms.forEach((room, index) => {
                const existingItem = existingItems[staticCount + index];
                if (existingItem) {
                    existingItem.querySelector('.group-name').textContent = room.name;
                    existingItem.querySelector('.group-badge').textContent = `${room.memberCount || 0}人`;
                    existingItem.querySelector('.group-last-message').textContent = room.lastMessage || '暂无消息';
                    existingItem.onclick = () => selectStudyRoom(existingItem, room.id);
                } else {
                    const roomEl = document.createElement('div');
                    roomEl.className = 'group-item';
                    roomEl.onclick = () => selectStudyRoom(roomEl, room.id);

                    const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#fa709a'];
                    const color = colors[index % colors.length];

                    roomEl.innerHTML = `
                        <div class="group-avatar" style="background: ${color}">${room.name[0]}</div>
                        <div class="group-info">
                            <div class="group-name">
                                ${room.name}
                                <span class="group-badge">${room.memberCount || 0}人</span>
                            </div>
                            <div class="group-last-message">${room.lastMessage || '暂无消息'}</div>
                        </div>
                        <div class="group-meta">
                            <span class="group-time">${room.updatedAt ? new Date(room.updatedAt).toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'}) : ''}</span>
                        </div>
                    `;
                    container.appendChild(roomEl);
        }

        // 选择学习室
        async function selectStudyRoom(element, roomId) {
            document.querySelectorAll('.group-item').forEach(item => {
                item.classList.remove('active');
            });
            element.classList.add('active');

            currentRoomId = roomId;

            const room = studyRooms.find(r => r.id === roomId);
            if (room) {
                document.querySelector('.chat-name').textContent = room.name;
                document.querySelector('.chat-status').textContent = `${room.memberCount || 0}人 · ${room.onlineCount || 0}人在线`;
            }

            await loadRoomMessages(roomId);
        }

        // 选择群组（保留原有功能）
        function selectGroup(element, type) {
            document.querySelectorAll('.group-item').forEach(item => {
                item.classList.remove('active');
            });
            element.classList.add('active');

            currentRoomId = null;
            updateChatInterface(type);
        }

        // 更新聊天界面
        function updateChatInterface(type) {
            const chatName = document.querySelector('.chat-name');
            const chatStatus = document.querySelector('.chat-status');

            if (type === 'private') {
                chatName.textContent = '王小芳';
                chatStatus.textContent = '在线';
            } else if (type === 'mentor') {
                chatName.textContent = '张老师的门下';
                chatStatus.textContent = '12位弟子 · 5人在线';
            }

            loadMessages(type);
        }

        // 加载消息（静态示例）
        function loadMessages(type) {
            console.log('加载消息:', type);
        }

        // 加载房间消息
        async function loadRoomMessages(roomId) {
            const container = document.getElementById('messagesContainer');
            container.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-tertiary);">加载中...</div>';

            try {
                const response = await fetch(`${API_BASE}/studyrooms/${roomId}/messages?page=1&size=50`);
                const result = await response.json();

                if (result.code === 200 && result.data) {
                    const messages = result.data.messages || [];
                    renderMessages(messages);
                } else {
                    container.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-tertiary);">暂无消息</div>';
                }
            } catch (error) {
                console.error('加载消息失败:', error);
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-tertiary);">加载失败</div>';
            }
        }

        // 渲染消息
        function renderMessages(messages) {
            const container = document.getElementById('messagesContainer');
            const currentUser = JSON.parse(localStorage.getItem('user') || '{}');
            const currentUserId = currentUser.id;

            if (messages.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-tertiary);">暂无消息，开始聊天吧！</div>';
                return;
            }

            container.innerHTML = messages.map(msg => {
                const isSelf = msg.userId === currentUserId;
                const time = new Date(msg.createdAt).toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'});
                const avatar = msg.nickname ? msg.nickname[0] : '匿';

                return `
                    <div class="message ${isSelf ? 'self' : ''}">
                        <div class="message-avatar">${avatar}</div>
                        <div class="message-content">
                            <div class="message-info">
                                <span>${msg.nickname || '匿名'}</span>
                                <span>${time}</span>
                            </div>
                            <div class="message-bubble">${msg.content}</div>
                        </div>
                    </div>
                `;
            }).join('');

            container.scrollTop = container.scrollHeight;
        }

        // 切换标签
        function switchTab(tab, element) {
            document.querySelectorAll('.tab-item').forEach(item => {
                item.classList.remove('active');
            });
            element.classList.add('active');

            filterStudyRooms(tab);
        }

        // 筛选学习室
        function filterStudyRooms(type) {
            const container = document.querySelector('.groups-list');
            const items = container.querySelectorAll('.group-item');

            items.forEach(item => {
                if (type === 'all') {
                    item.style.display = 'flex';
                } else {
                    const roomType = item.dataset.type || 'study';
                    item.style.display = (roomType === type) ? 'flex' : 'none';
        }

        // 发送消息
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();

            if (!message) return;

            const token = localStorage.getItem('token');
            if (!token) {
                alert('请先登录');
                return;
            }

            if (currentRoomId) {
                try {
                    const response = await fetch(`${API_BASE}/studyrooms/${currentRoomId}/message?content=${encodeURIComponent(message)}&messageType=text`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`

                    const result = await response.json();

                    if (result.code === 200) {
                        addLocalMessage(message);
                        input.value = '';
                        input.style.height = 'auto';
                    } else {
                        alert('发送失败: ' + result.message);
                    }
                } catch (error) {
                    console.error('发送消息失败:', error);
                    addLocalMessage(message);
                    input.value = '';
                }
            } else {
                addLocalMessage(message);
                input.value = '';
                input.style.height = 'auto';
            }
        }

        // 添加本地消息显示
        function addLocalMessage(message) {
            const currentUser = JSON.parse(localStorage.getItem('user') || '{}');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message self';
            messageDiv.innerHTML = `
                <div class="message-avatar">${currentUser.nickname ? currentUser.nickname[0] : '我'}</div>
                <div class="message-content">
                    <div class="message-info">
                        <span>${new Date().toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'})}</span>
                    </div>
                    <div class="message-bubble">${message}</div>
                </div>
            `;

            const container = document.getElementById('messagesContainer');
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // 处理回车键
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // 开始私聊
        function startPrivateChat(username) {
            console.log('开始与', username, '私聊');
        }

        // 显示创建群组模态框
        function showCreateGroup() {
            document.getElementById('createGroupModal').classList.add('show');
        }

        // 关闭模态框
        function closeModal() {
            document.getElementById('createGroupModal').classList.remove('show');
        }

        // 创建群组
        async function createGroup() {
            const nameInput = document.querySelector('#createGroupModal input[placeholder*="例如"]');
            const descInput = document.querySelector('#createGroupModal textarea');

            const name = nameInput?.value?.trim();
            const description = descInput?.value?.trim();

            if (!name) {
                alert('请输入群组名称');
                return;
            }

            const token = localStorage.getItem('token');
            if (!token) {
                alert('请先登录');
                return;
            }

            try {
                const params = new URLSearchParams({
                    name,
                    description: description || '',
                    maxMembers: 100,
                    roomType: 'study'
                });

                const response = await fetch(`${API_BASE}/studyrooms/create?${params}`, {
                    method: 'POST',
                    headers: {
                    }
                });
                        'Authorization': `Bearer ${token}`

                const result = await response.json();

                if (result.code === 200) {
                    alert('创建成功！');
                    closeModal();
                    if (nameInput) nameInput.value = '';
                    if (descInput) descInput.value = '';
                    await loadStudyRooms();
                } else {
                    alert('创建失败: ' + result.message);
                }
            } catch (error) {
                console.error('创建群组失败:', error);
                alert('创建失败，请稍后重试');
            }
        }

        // 与导师聊天
        function chatWithMentor() {
            console.log('与导师聊天');
        }

        // 显示在线用户
        function showOnlineUsers() {
            console.log('显示在线用户');
        }

        // 显示师徒系统
        function showMentorSystem() {
            console.log('显示师徒系统');
        }

        // 显示学习小组
        function showStudyGroups() {
            console.log('显示学习小组');
        }

        // 显示通讯录
        function showContacts() {
            console.log('显示通讯录');
        }

        // 开始语音通话
        function startVoiceCall() {
            alert('语音通话功能开发中...');
        }

        // 开始视频通话
        function startVideoCall() {
            alert('视频通话功能开发中...');
        }

        // 显示群组信息
        function showGroupInfo() {
            console.log('显示群组信息');
        }

        // 创建学习计划
        function createStudyPlan() {
            alert('创建学习计划功能开发中...');
        }

        // 共享资源
        function shareResource() {
            alert('共享资源功能开发中...');
        }

        // 开始直播
        function startLive() {
            alert('直播功能开发中...');
        }

        // 创建投票
        function createPoll() {
            alert('投票功能开发中...');
        }

        // 选择表情
        function selectEmoji() {
            alert('表情选择器开发中...');
        }

        // 选择文件
        function selectFile() {
            alert('文件选择功能开发中...');
        }

        // 选择图片
        function selectImage() {
            alert('图片选择功能开发中...');
        }

        // 查看图片
        function viewImage(img) {
            console.log('查看图片');
        }

        // 自动调整输入框高度
        document.getElementById('messageInput').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        // 用户菜单
            </script>
    <script src="/js/app-shell.js"></script>
    
</body>
</html>
