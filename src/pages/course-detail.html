<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>课程详情 - AI 信息未来</title>
    <link rel="stylesheet" href="../styles/apple-design.css">
    <style>
        /* ==================== 课程详情专属样式 ==================== */

        /* 顶部Hero区域 */
        .course-hero {
            background: linear-gradient(135deg, #1e3a5f 0%, #0f2744 50%, #0a1929 100%);
            padding: 100px 0 80px;
            position: relative;
            overflow: hidden;
        }

        .course-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3z' fill='%23ffffff' fill-opacity='0.03'/%3E%3C/svg%3E");
            opacity: 0.5;
        }

        .course-hero-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
            position: relative;
            z-index: 1;
        }

        .course-hero-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 60px;
            align-items: start;
        }

        @media (max-width: 1024px) {
            .course-hero-grid {
                grid-template-columns: 1fr;
                gap: 40px;
            }
        }

        /* 左侧课程信息 */
        .course-info {
            color: white;
        }

        .course-breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 24px;
        }

        .course-breadcrumb a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: color 0.2s;
        }

        .course-breadcrumb a:hover {
            color: white;
        }

        .course-badges {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .course-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }

        .course-badge.category {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            color: white;
        }

        .course-badge.difficulty {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .course-badge.new {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .course-badge.hot {
            background: linear-gradient(135deg, #ef4444, #f97316);
            color: white;
        }

        .course-title {
            font-size: 42px;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 20px;
            color: white;
        }

        .course-subtitle {
            font-size: 18px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 28px;
        }

        .course-stats {
            display: flex;
            gap: 32px;
            flex-wrap: wrap;
            margin-bottom: 28px;
        }

        .course-stat {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .course-stat-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .course-stat-icon svg {
            width: 20px;
            height: 20px;
            color: #60a5fa;
        }

        .course-stat-value {
            font-size: 20px;
            font-weight: 700;
            color: white;
        }

        .course-stat-label {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
        }

        /* 讲师信息 */
        .instructor-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .instructor-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 700;
            color: white;
            flex-shrink: 0;
        }

        .instructor-info {
            flex: 1;
        }

        .instructor-name {
            font-size: 16px;
            font-weight: 600;
            color: white;
            margin-bottom: 4px;
        }

        .instructor-title {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        .instructor-badge {
            padding: 6px 12px;
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }

        /* 右侧卡片 */
        .course-sidebar {
            position: sticky;
            top: 80px;
        }

        .course-card {
            background: var(--bg-primary);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .course-preview {
            position: relative;
            aspect-ratio: 16/9;
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            overflow: hidden;
        }

        .course-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .course-preview-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
            cursor: pointer;
        }

        .course-preview:hover .course-preview-overlay {
            opacity: 1;
        }

        .play-btn {
            width: 72px;
            height: 72px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s;
        }

        .play-btn svg {
            width: 32px;
            height: 32px;
            color: var(--primary);
            margin-left: 4px;
        }

        .course-preview:hover .play-btn {
            transform: scale(1.1);
        }

        .course-card-body {
            padding: 28px;
        }

        .price-section {
            display: flex;
            align-items: baseline;
            gap: 12px;
            margin-bottom: 8px;
        }

        .course-price {
            font-size: 36px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .course-price.free {
            color: #10b981;
        }

        .original-price {
            font-size: 18px;
            color: var(--text-tertiary);
            text-decoration: line-through;
        }

        .discount-badge {
            padding: 4px 10px;
            background: linear-gradient(135deg, #ef4444, #f97316);
            color: white;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
        }

        .price-note {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .enroll-btn {
            width: 100%;
            padding: 18px;
            font-size: 17px;
            font-weight: 600;
            border-radius: 14px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .enroll-btn.primary {
            background: linear-gradient(135deg, var(--primary), #6366f1);
            color: white;
        }

        .enroll-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        }

        .enroll-btn.enrolled {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .share-btn {
            width: 100%;
            padding: 14px;
            margin-top: 12px;
            font-size: 15px;
            font-weight: 500;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .share-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .course-features {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border-color);
        }

        .course-feature {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            font-size: 15px;
            color: var(--text-secondary);
        }

        .course-feature svg {
            width: 20px;
            height: 20px;
            color: #10b981;
            flex-shrink: 0;
        }

        /* 学习进度（已报名用户） */
        .progress-section {
            margin-bottom: 20px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 12px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .progress-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .progress-percent {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary);
        }

        .progress-bar {
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), #6366f1);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* 主内容区域 */
        .course-main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* 标签导航 */
        .tabs-container {
            position: sticky;
            top: 64px;
            background: var(--bg-primary);
            z-index: 50;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 40px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            padding: 16px 0;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 12px 24px;
            font-size: 15px;
            font-weight: 500;
            color: var(--text-secondary);
            background: transparent;
            border: 1px solid transparent;
            border-radius: 24px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab-btn:hover {
            color: var(--text-primary);
            background: var(--bg-secondary);
        }

        .tab-btn.active {
            color: white;
            background: var(--primary);
            border-color: var(--primary);
        }

        .tab-panel {
            display: none;
            padding-bottom: 60px;
        }

        .tab-panel.active {
            display: block;
        }

        /* 课程大纲 */
        .outline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .outline-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .outline-meta {
            font-size: 15px;
            color: var(--text-secondary);
        }

        .chapter-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .chapter-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.3s;
        }

        .chapter-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .chapter-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 24px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .chapter-header:hover {
            background: var(--bg-secondary);
        }

        .chapter-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .chapter-number {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary), #6366f1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
            color: white;
            flex-shrink: 0;
        }

        .chapter-info h3 {
            font-size: 17px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .chapter-info p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .chapter-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .chapter-meta {
            text-align: right;
        }

        .chapter-count {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .chapter-duration {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        .chapter-toggle {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s;
        }

        .chapter-toggle svg {
            width: 20px;
            height: 20px;
            color: var(--text-tertiary);
        }

        .chapter-card.expanded .chapter-toggle {
            transform: rotate(180deg);
        }

        .lesson-list {
            padding: 0 24px 24px;
            display: none;
        }

        .chapter-card.expanded .lesson-list {
            display: block;
        }

        .lesson-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            margin-top: 8px;
            background: var(--bg-secondary);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .lesson-item:hover {
            background: var(--bg-tertiary);
            transform: translateX(4px);
        }

        .lesson-item.completed {
            border-left: 3px solid #10b981;
        }

        .lesson-left {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .lesson-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .lesson-icon.video {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
        }

        .lesson-icon.text {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .lesson-icon.quiz {
            background: linear-gradient(135deg, #f59e0b, #ef4444);
        }

        .lesson-icon svg {
            width: 20px;
            height: 20px;
            color: white;
        }

        .lesson-title {
            font-size: 15px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .lesson-meta {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        .lesson-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .lesson-status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lesson-status.completed {
            background: #10b981;
        }

        .lesson-status.completed svg {
            width: 14px;
            height: 14px;
            color: white;
        }

        .lesson-status.locked svg {
            width: 16px;
            height: 16px;
            color: var(--text-tertiary);
        }

        /* 评价区域 */
        .reviews-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .reviews-summary {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .rating-big {
            text-align: center;
        }

        .rating-value {
            font-size: 56px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
        }

        .rating-stars {
            display: flex;
            gap: 4px;
            justify-content: center;
            margin-top: 8px;
        }

        .rating-stars svg {
            width: 20px;
            height: 20px;
            color: #fbbf24;
        }

        .rating-count {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 6px;
        }

        .rating-bars {
            flex: 1;
            max-width: 300px;
        }

        .rating-bar-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .rating-bar-label {
            font-size: 13px;
            color: var(--text-secondary);
            width: 20px;
        }

        .rating-bar-track {
            flex: 1;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }

        .rating-bar-fill {
            height: 100%;
            background: #fbbf24;
            border-radius: 4px;
        }

        .rating-bar-count {
            font-size: 13px;
            color: var(--text-tertiary);
            width: 30px;
            text-align: right;
        }

        .review-list {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .review-card {
            padding: 24px;
            background: var(--bg-secondary);
            border-radius: 16px;
        }

        .review-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .review-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
            color: white;
            flex-shrink: 0;
        }

        .review-user-info {
            flex: 1;
        }

        .review-username {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .review-date {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        .review-rating {
            display: flex;
            gap: 3px;
        }

        .review-rating svg {
            width: 16px;
            height: 16px;
        }

        .review-rating svg.filled {
            color: #fbbf24;
        }

        .review-rating svg.empty {
            color: var(--border-color);
        }

        .review-content {
            font-size: 15px;
            line-height: 1.7;
            color: var(--text-secondary);
        }

        /* 问答区域 */
        .qa-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .ask-btn {
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ask-btn:hover {
            background: var(--primary-hover);
        }

        /* 相关课程 */
        .related-section {
            padding: 60px 0;
            background: var(--bg-secondary);
        }

        .related-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 32px;
            text-align: center;
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }

        @media (max-width: 900px) {
            .related-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .related-grid {
                grid-template-columns: 1fr;
            }
        }

        .related-card {
            background: var(--bg-primary);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
            cursor: pointer;
        }

        .related-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
        }

        .related-cover {
            aspect-ratio: 16/9;
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .related-cover svg {
            width: 48px;
            height: 48px;
            color: white;
            opacity: 0.8;
        }

        .related-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .related-body {
            padding: 20px;
        }

        .related-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .related-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .related-price {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }

        .related-price.free {
            color: #10b981;
        }

        .related-students {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-secondary);
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            color: var(--text-tertiary);
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--text-primary);
            color: var(--bg-primary);
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* 加载状态 */
        .skeleton {
            background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--bg-tertiary) 50%, var(--bg-secondary) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: 8px;
        }

        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* 响应式 */
        @media (max-width: 768px) {
            .course-title {
                font-size: 28px;
            }

            .course-stats {
                gap: 16px;
            }

            .course-card-body {
                padding: 20px;
            }

            .course-price {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-inner">
            <a href="/" class="nav-logo">AI 信息未来</a>
            <div class="nav-menu">
                <a href="courses.html" class="nav-link">课程</a>
                <a href="dashboard.html" class="nav-link">学习中心</a>
                <a href="my-courses.html" class="nav-link">我的课程</a>
                <a href="profile.html" class="nav-link">个人中心</a>
            </div>
            <div class="nav-actions">
                <button class="theme-toggle" id="themeToggle" aria-label="切换主题">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path class="sun-icon" d="M10 2.5a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 2.5zM10 15a5 5 0 100-10 5 5 0 000 10zm6.5-5a.75.75 0 01.75.75v.5a.75.75 0 01-1.5 0v-.5a.75.75 0 01.75-.75z"/>
                        <path class="moon-icon" d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" style="display: none;"/>
                    </svg>
                </button>
                <div class="user-menu" id="authArea">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="dropdown" id="userDropdown">
                        <a href="profile.html" class="dropdown-item">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 8a3 3 0 100-6 3 3 0 000 6zM8 10c-4 0-6 2-6 4v1h12v-1c0-2-2-4-6-4z"/></svg>
                            个人资料
                        </a>
                        <a href="my-courses.html" class="dropdown-item">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M3 2a1 1 0 00-1 1v10a1 1 0 001 1h10a1 1 0 001-1V3a1 1 0 00-1-1H3zm5 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3z"/></svg>
                            我的课程
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item" onclick="logout()">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M6 2a1 1 0 00-1 1v10a1 1 0 001 1h1V2H6zm4 0v12h1a1 1 0 001-1V3a1 1 0 00-1-1h-1z"/></svg>
                            退出登录
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero区域 -->
    <section class="course-hero">
        <div class="course-hero-container">
            <div class="course-hero-grid">
                <div class="course-info">
                    <div class="course-breadcrumb">
                        <a href="courses.html">课程</a>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
                        <span id="categoryName">分类</span>
                    </div>
                    <div class="course-badges" id="courseBadges"></div>
                    <h1 class="course-title" id="courseTitle">加载中...</h1>
                    <p class="course-subtitle" id="courseDesc">课程简介加载中...</p>

                    <div class="course-stats">
                        <div class="course-stat">
                            <div class="course-stat-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 4-6 8-6s8 2 8 6"/></svg>
                            </div>
                            <div>
                                <div class="course-stat-value" id="enrollCount">0</div>
                                <div class="course-stat-label">学习人数</div>
                            </div>
                        </div>
                        <div class="course-stat">
                            <div class="course-stat-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
                            </div>
                            <div>
                                <div class="course-stat-value" id="lessonCount">0</div>
                                <div class="course-stat-label">课时数量</div>
                            </div>
                        </div>
                        <div class="course-stat">
                            <div class="course-stat-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                            </div>
                            <div>
                                <div class="course-stat-value" id="rating">5.0</div>
                                <div class="course-stat-label">课程评分</div>
                            </div>
                        </div>
                    </div>

                    <div class="instructor-card" id="instructorCard">
                        <div class="instructor-avatar" id="instructorAvatar">讲</div>
                        <div class="instructor-info">
                            <div class="instructor-name" id="instructorName">课程讲师</div>
                            <div class="instructor-title" id="instructorTitle">高级AI工程师</div>
                        </div>
                        <div class="instructor-badge">认证讲师</div>
                    </div>
                </div>

                <div class="course-sidebar">
                    <div class="course-card">
                        <div class="course-preview" id="coursePreview" onclick="playPreview()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:64px;height:64px;color:rgba(255,255,255,0.8);">
                                <path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                            </svg>
                            <div class="course-preview-overlay">
                                <div class="play-btn">
                                    <svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                                </div>
                            </div>
                        </div>
                        <div class="course-card-body">
                            <!-- 学习进度（已报名显示） -->
                            <div class="progress-section" id="progressSection" style="display: none;">
                                <div class="progress-header">
                                    <span class="progress-title">学习进度</span>
                                    <span class="progress-percent" id="progressPercent">0%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                                </div>
                            </div>

                            <div class="price-section">
                                <span class="course-price" id="coursePrice">加载中</span>
                                <span class="original-price" id="originalPrice" style="display: none;"></span>
                                <span class="discount-badge" id="discountBadge" style="display: none;"></span>
                            </div>
                            <p class="price-note">报名后永久有效</p>

                            <button class="enroll-btn primary" id="enrollBtn" onclick="handleEnroll()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 14l9-5-9-5-9 5 9 5z"/>
                                    <path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"/>
                                </svg>
                                立即报名
                            </button>

                            <button class="share-btn" onclick="shareCourse()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="18" cy="5" r="3"/>
                                    <circle cx="6" cy="12" r="3"/>
                                    <circle cx="18" cy="19" r="3"/>
                                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                                </svg>
                                分享课程
                            </button>

                            <div class="course-features">
                                <div class="course-feature">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                    <span>永久有效，随时学习</span>
                                </div>
                                <div class="course-feature">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                    <span>高清内容，流畅体验</span>
                                </div>
                                <div class="course-feature">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                    <span>课后答疑，专属社群</span>
                                </div>
                                <div class="course-feature">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                                    <span>学完颁发结业证书</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 标签导航 -->
    <div class="tabs-container">
        <div class="course-main">
            <div class="tabs">
                <button class="tab-btn active" data-tab="outline">课程大纲</button>
                <button class="tab-btn" data-tab="reviews">学员评价</button>
                <button class="tab-btn" data-tab="qa">课程问答</button>
                <button class="tab-btn" data-tab="notes">学习笔记</button>
            </div>
        </div>
    </div>

    <!-- 内容区域 -->
    <div class="course-main">
        <!-- 课程大纲 -->
        <div class="tab-panel active" id="outline">
            <div class="outline-header">
                <h2 class="outline-title">课程大纲</h2>
                <span class="outline-meta" id="outlineMeta">共 0 章 0 节</span>
            </div>
            <div class="chapter-list" id="chapterList">
                <div class="skeleton" style="height: 100px; margin-bottom: 16px;"></div>
                <div class="skeleton" style="height: 100px; margin-bottom: 16px;"></div>
                <div class="skeleton" style="height: 100px;"></div>
            </div>
        </div>

        <!-- 学员评价 -->
        <div class="tab-panel" id="reviews">
            <div class="reviews-header">
                <div class="reviews-summary">
                    <div class="rating-big">
                        <div class="rating-value" id="ratingBig">5.0</div>
                        <div class="rating-stars">
                            <svg viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                            <svg viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                            <svg viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                            <svg viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                            <svg viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                        </div>
                        <div class="rating-count" id="reviewCount">0 条评价</div>
                    </div>
                    <div class="rating-bars" id="ratingBars">
                        <!-- 动态生成 -->
                    </div>
                </div>
            </div>
            <div class="review-list" id="reviewList">
                <div class="skeleton" style="height: 150px; margin-bottom: 24px;"></div>
                <div class="skeleton" style="height: 150px;"></div>
            </div>
        </div>

        <!-- 课程问答 -->
        <div class="tab-panel" id="qa">
            <div class="qa-header">
                <h2 class="outline-title">课程问答</h2>
                <button class="ask-btn" onclick="askQuestion()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 8v8M8 12h8"/>
                    </svg>
                    提问
                </button>
            </div>
            <div class="empty-state">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3M12 17h.01"/>
                </svg>
                <h3>暂无问答</h3>
                <p>有问题？点击上方按钮提问</p>
            </div>
        </div>

        <!-- 学习笔记 -->
        <div class="tab-panel" id="notes">
            <div class="empty-state">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                    <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                </svg>
                <h3>暂无笔记</h3>
                <p>学习过程中记录的笔记会显示在这里</p>
            </div>
        </div>
    </div>

    <!-- 相关课程 -->
    <section class="related-section">
        <h2 class="related-title">相关推荐</h2>
        <div class="related-grid" id="relatedCourses">
            <div class="skeleton" style="height: 280px;"></div>
            <div class="skeleton" style="height: 280px;"></div>
            <div class="skeleton" style="height: 280px;"></div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p class="footer-text">2024 AI 信息未来. 保留所有权利.</p>
                <div class="footer-links">
                    <a href="#" class="footer-link">关于我们</a>
                    <a href="#" class="footer-link">隐私政策</a>
                    <a href="#" class="footer-link">使用条款</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        const API_BASE = '/api';
        let currentCourse = null;
        let isEnrolled = false;
        let userProgress = 0;

        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            checkAuth();
            loadCourse();
            setupTabs();
            setupEventListeners();
        });

        // ==================== 主题切换 ====================
        function initTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
            updateThemeIcon();
        }

        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const theme = document.documentElement.getAttribute('data-theme');
            const sunIcon = document.querySelector('.sun-icon');
            const moonIcon = document.querySelector('.moon-icon');
            if (theme === 'dark') {
                sunIcon.style.display = 'inline';
                moonIcon.style.display = 'none';
            } else {
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'inline';
            }
        }

        function setupEventListeners() {
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);

            const avatar = document.getElementById('userAvatar');
            avatar.addEventListener('click', (e) => {
                e.stopPropagation();
                document.getElementById('userDropdown').classList.toggle('show');
            });

            document.addEventListener('click', () => {
                document.getElementById('userDropdown').classList.remove('show');
            });
        }

        // ==================== 认证检查 ====================
        function checkAuth() {
            const token = localStorage.getItem('token');
            const userStr = localStorage.getItem('user');

            if (token && userStr) {
                const user = JSON.parse(userStr);
                const initial = (user.nickname || user.username || 'U').charAt(0).toUpperCase();
                document.getElementById('userAvatar').textContent = initial;
            } else {
                document.getElementById('authArea').innerHTML = `
                    <a href="login.html" class="btn btn-secondary" style="margin-right: 8px;">登录</a>
                    <a href="register.html" class="btn btn-primary">注册</a>
                `;
            }
        }

        // ==================== 加载课程 ====================
        async function loadCourse() {
            const courseId = new URLSearchParams(window.location.search).get('id');
            if (!courseId) {
                showToast('课程ID无效');
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/courses/${courseId}`);
                const data = await res.json();
                if (data.code === 200 && data.data) {
                    currentCourse = data.data;
                    renderCourse(currentCourse);
                    loadChapters(courseId);
                    loadReviews(courseId);
                    checkEnrollment(courseId);
                    loadRelatedCourses(currentCourse.categoryId);
                } else {
                    showToast(data.message || '加载课程失败');
                }
            } catch (e) {
                showToast('网络错误');
            }
        }

        function renderCourse(course) {
            document.title = `${course.title} - AI 信息未来`;
            document.getElementById('courseTitle').textContent = course.title;
            document.getElementById('courseDesc').textContent = course.description || '暂无简介';
            document.getElementById('enrollCount').textContent = course.enrollmentCount || 0;
            document.getElementById('lessonCount').textContent = course.lessonCount || 0;
            document.getElementById('rating').textContent = (course.rating || 5.0).toFixed(1);
            document.getElementById('ratingBig').textContent = (course.rating || 5.0).toFixed(1);

            // 分类
            if (course.category) {
                document.getElementById('categoryName').textContent = course.category.name || course.category;
            }

            // 徽章
            const badgesHtml = [];
            if (course.category) {
                badgesHtml.push(`<span class="course-badge category">${course.category.name || course.category}</span>`);
            }
            if (course.difficulty) {
                badgesHtml.push(`<span class="course-badge difficulty">${course.difficulty}</span>`);
            }
            if (course.isNew) {
                badgesHtml.push(`<span class="course-badge new">新课</span>`);
            }
            if (course.isHot) {
                badgesHtml.push(`<span class="course-badge hot">热门</span>`);
            }
            document.getElementById('courseBadges').innerHTML = badgesHtml.join('');

            // 价格
            const priceEl = document.getElementById('coursePrice');
            if (course.isFree) {
                priceEl.textContent = '免费';
                priceEl.classList.add('free');
            } else {
                priceEl.textContent = `¥${course.price}`;
                if (course.originalPrice && course.originalPrice > course.price) {
                    document.getElementById('originalPrice').textContent = `¥${course.originalPrice}`;
                    document.getElementById('originalPrice').style.display = 'inline';
                    const discount = Math.round((1 - course.price / course.originalPrice) * 100);
                    document.getElementById('discountBadge').textContent = `-${discount}%`;
                    document.getElementById('discountBadge').style.display = 'inline';
                }
            }

            // 封面
            if (course.coverImage) {
                document.getElementById('coursePreview').innerHTML = `
                    <img src="${course.coverImage}" alt="${course.title}">
                    <div class="course-preview-overlay">
                        <div class="play-btn">
                            <svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                        </div>
                    </div>
                `;
            }

            // 讲师
            if (course.instructor) {
                document.getElementById('instructorName').textContent = course.instructor.name || '课程讲师';
                document.getElementById('instructorTitle').textContent = course.instructor.title || '高级讲师';
                const initial = (course.instructor.name || '讲').charAt(0);
                document.getElementById('instructorAvatar').textContent = initial;
            }
        }

        // ==================== 加载章节 ====================
        async function loadChapters(courseId) {
            try {
                const res = await fetch(`${API_BASE}/content/courses/${courseId}/chapters`);
                const data = await res.json();
                if (data.code === 200 && data.data) {
                    renderChapters(data.data);
                }
            } catch (e) {
                document.getElementById('chapterList').innerHTML = '<p style="color:var(--text-tertiary);text-align:center;">加载失败</p>';
            }
        }

        function renderChapters(chapters) {
            const container = document.getElementById('chapterList');
            let totalLessons = 0;
            chapters.forEach(c => totalLessons += (c.lessons?.length || 0));

            document.getElementById('outlineMeta').textContent = `共 ${chapters.length} 章 ${totalLessons} 节`;

            if (!chapters.length) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                        <h3>暂无章节</h3>
                        <p>课程内容正在准备中</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = chapters.map((chapter, idx) => `
                <div class="chapter-card" onclick="toggleChapter(this)">
                    <div class="chapter-header">
                        <div class="chapter-left">
                            <div class="chapter-number">${idx + 1}</div>
                            <div class="chapter-info">
                                <h3>${chapter.title}</h3>
                                <p>${chapter.description || '本章内容概述'}</p>
                            </div>
                        </div>
                        <div class="chapter-right">
                            <div class="chapter-meta">
                                <div class="chapter-count">${chapter.lessons?.length || 0} 节</div>
                                <div class="chapter-duration">${chapter.duration || '约30分钟'}</div>
                            </div>
                            <div class="chapter-toggle">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                            </div>
                        </div>
                    </div>
                    <div class="lesson-list">
                        ${(chapter.lessons || []).map(lesson => `
                            <div class="lesson-item" onclick="event.stopPropagation(); goToLesson('${lesson.id}')">
                                <div class="lesson-left">
                                    <div class="lesson-icon ${lesson.type || 'video'}">
                                        ${getLessonIcon(lesson.type)}
                                    </div>
                                    <div>
                                        <div class="lesson-title">${lesson.title}</div>
                                        <div class="lesson-meta">${lesson.duration || '约10分钟'}</div>
                                    </div>
                                </div>
                                <div class="lesson-right">
                                    ${isEnrolled ?
                                        (lesson.completed ?
                                            '<div class="lesson-status completed"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div>' :
                                            '') :
                                        '<div class="lesson-status locked"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg></div>'
                                    }
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function getLessonIcon(type) {
            switch(type) {
                case 'text':
                    return '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg>';
                case 'quiz':
                    return '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3M12 17h.01"/></svg>';
                default:
                    return '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>';
            }
        }

        function toggleChapter(el) {
            el.classList.toggle('expanded');
        }

        function goToLesson(lessonId) {
            const courseId = new URLSearchParams(window.location.search).get('id');
            if (!isEnrolled && !currentCourse?.isFree) {
                showToast('请先报名课程');
                return;
            }
            window.location.href = `study.html?courseId=${courseId}&chapterId=${lessonId}`;
        }

        // ==================== 加载评价 ====================
        async function loadReviews(courseId) {
            try {
                const res = await fetch(`${API_BASE}/reviews/course/${courseId}`);
                const data = await res.json();
                const container = document.getElementById('reviewList');

                if (data.code === 200 && data.data && data.data.length > 0) {
                    const reviews = data.data;
                    document.getElementById('reviewCount').textContent = `${reviews.length} 条评价`;

                    // 评分分布
                    const distribution = [0, 0, 0, 0, 0];
                    reviews.forEach(r => {
                        if (r.rating >= 1 && r.rating <= 5) {
                            distribution[r.rating - 1]++;
                        }
                    });
                    const total = reviews.length;
                    document.getElementById('ratingBars').innerHTML = [5, 4, 3, 2, 1].map(star => {
                        const count = distribution[star - 1];
                        const percent = total > 0 ? (count / total) * 100 : 0;
                        return `
                            <div class="rating-bar-item">
                                <span class="rating-bar-label">${star}</span>
                                <div class="rating-bar-track">
                                    <div class="rating-bar-fill" style="width: ${percent}%"></div>
                                </div>
                                <span class="rating-bar-count">${count}</span>
                            </div>
                        `;
                    }).join('');

                    container.innerHTML = reviews.map(review => `
                        <div class="review-card">
                            <div class="review-header">
                                <div class="review-avatar">${(review.username || 'U').charAt(0).toUpperCase()}</div>
                                <div class="review-user-info">
                                    <div class="review-username">${review.username || '匿名用户'}</div>
                                    <div class="review-date">${formatDate(review.createdAt)}</div>
                                </div>
                                <div class="review-rating">
                                    ${[1,2,3,4,5].map(i => `
                                        <svg class="${i <= review.rating ? 'filled' : 'empty'}" viewBox="0 0 24 24" fill="currentColor">
                                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                                        </svg>
                                    `).join('')}
                                </div>
                            </div>
                            <p class="review-content">${review.content}</p>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = `
                        <div class="empty-state">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>
                            </svg>
                            <h3>暂无评价</h3>
                            <p>学完课程后可以发表评价</p>
                        </div>
                    `;
                }
            } catch (e) {
                document.getElementById('reviewList').innerHTML = '<p style="color:var(--text-tertiary);text-align:center;">加载失败</p>';
            }
        }

        // ==================== 检查报名状态 ====================
        async function checkEnrollment(courseId) {
            const token = localStorage.getItem('token');
            if (!token) return;

            try {
                const res = await fetch(`${API_BASE}/subscriptions/check/${courseId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                if (data.code === 200 && data.data) {
                    isEnrolled = true;
                    userProgress = data.data.progress || 0;
                    updateEnrolledUI();
                }
            } catch (e) {}
        }

        function updateEnrolledUI() {
            const btn = document.getElementById('enrollBtn');
            btn.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="5 3 19 12 5 21 5 3"/>
                </svg>
                继续学习
            `;
            btn.classList.remove('primary');
            btn.classList.add('enrolled');

            // 显示进度
            document.getElementById('progressSection').style.display = 'block';
            document.getElementById('progressPercent').textContent = `${userProgress}%`;
            document.getElementById('progressFill').style.width = `${userProgress}%`;

            // 重新加载章节以显示完成状态
            const courseId = new URLSearchParams(window.location.search).get('id');
            loadChapters(courseId);
        }

        // ==================== 报名处理 ====================
        async function handleEnroll() {
            if (isEnrolled) {
                const lessons = document.querySelectorAll('.lesson-item');
                if (lessons.length > 0) lessons[0].click();
                return;
            }

            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = `login.html?returnUrl=${encodeURIComponent(window.location.href)}`;
                return;
            }

            const courseId = new URLSearchParams(window.location.search).get('id');

            if (currentCourse?.isFree) {
                try {
                    const res = await fetch(`${API_BASE}/orders/subscribe/course/${courseId}`, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    const data = await res.json();
                    if (data.code === 200) {
                        showToast('报名成功！开始学习吧');
                        isEnrolled = true;
                        updateEnrolledUI();
                    } else {
                        showToast(data.message || '报名失败');
                    }
                } catch (e) {
                    showToast('网络错误');
                }
            } else {
                window.location.href = `payment.html?courseId=${courseId}`;
            }
        }

        // ==================== 相关课程 ====================
        async function loadRelatedCourses(categoryId) {
            try {
                const res = await fetch(`${API_BASE}/courses?limit=3${categoryId ? `&categoryId=${categoryId}` : ''}`);
                const data = await res.json();
                const container = document.getElementById('relatedCourses');

                if (data.code === 200 && data.data && data.data.length > 0) {
                    const currentId = new URLSearchParams(window.location.search).get('id');
                    const courses = data.data.filter(c => c.id != currentId).slice(0, 3);

                    if (courses.length === 0) {
                        container.innerHTML = '<p style="text-align:center;color:var(--text-tertiary);grid-column:1/-1;">暂无相关课程</p>';
                        return;
                    }

                    container.innerHTML = courses.map(course => `
                        <div class="related-card" onclick="location.href='course-detail.html?id=${course.id}'">
                            <div class="related-cover">
                                ${course.coverImage ?
                                    `<img src="${course.coverImage}" alt="${course.title}">` :
                                    `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>`
                                }
                            </div>
                            <div class="related-body">
                                <h3 class="related-name">${course.title}</h3>
                                <div class="related-meta">
                                    <span class="related-price ${course.isFree ? 'free' : ''}">${course.isFree ? '免费' : '¥' + course.price}</span>
                                    <span class="related-students">${course.enrollmentCount || 0} 人学习</span>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<p style="text-align:center;color:var(--text-tertiary);grid-column:1/-1;">暂无相关课程</p>';
                }
            } catch (e) {
                document.getElementById('relatedCourses').innerHTML = '<p style="text-align:center;color:var(--text-tertiary);grid-column:1/-1;">加载失败</p>';
            }
        }

        // ==================== 标签切换 ====================
        function setupTabs() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
                    btn.classList.add('active');
                    document.getElementById(btn.dataset.tab).classList.add('active');
                });
            });
        }

        // ==================== 其他功能 ====================
        function playPreview() {
            showToast('预览功能即将上线');
        }

        function shareCourse() {
            if (navigator.share) {
                navigator.share({
                    title: currentCourse?.title || '精品课程',
                    text: currentCourse?.description || '来AI 信息未来学习这门精品课程',
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                showToast('链接已复制到剪贴板');
            }
        }

        function askQuestion() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = `login.html?returnUrl=${encodeURIComponent(window.location.href)}`;
                return;
            }
            showToast('问答功能即将上线');
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('zh-CN');
        }

        function showToast(msg) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = msg;
            document.body.appendChild(toast);

            requestAnimationFrame(() => {
                toast.classList.add('show');
            });

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function logout() {
            if (confirm('确定要退出登录吗？')) {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                window.location.href = 'login.html';
            }
        }
    </script>
</body>
</html>
