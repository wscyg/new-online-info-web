<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PKç«æŠ€åœº - åœ¨çº¿å­¦ä¹ å¹³å°</title>

    <!-- CSS -->
    <link rel="stylesheet" href="../styles/pk-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- å¤–éƒ¨ä¾èµ– -->
    <script src="https://cdn.jsdelivr.net/npm/zustand@4.4.1/index.umd.js"></script>
    <script src="https://unpkg.com/dompurify@3.0.6/dist/purify.min.js"></script>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="pk-navbar">
        <div class="pk-nav-container">
            <a href="../pages/dashboard.html" class="pk-nav-brand">ğŸ“ åœ¨çº¿å­¦ä¹ å¹³å°</a>
            <ul class="pk-nav-menu">
                <li><a href="dashboard.html" class="pk-nav-link">ä»ªè¡¨ç›˜</a></li>
                <li><a href="courses.html" class="pk-nav-link">è¯¾ç¨‹</a></li>
                <li><a href="pk-arena-new.html" class="pk-nav-link active">PKç«æŠ€åœº</a></li>
                <li><a href="pk-rankings-new.html" class="pk-nav-link">æ’è¡Œæ¦œ</a></li>
                <li><a href="pk-friends-new.html" class="pk-nav-link">å¥½å‹</a></li>
                <li><a href="profile.html" class="pk-nav-link">ä¸ªäººä¸­å¿ƒ</a></li>
            </ul>
        </div>
    </nav>

    <!-- ä¸»å®¹å™¨ -->
    <div class="pk-container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="pk-page-header">
            <h1 class="pk-page-title">âš”ï¸ PKç«æŠ€åœº</h1>
            <p class="pk-page-subtitle">æŒ‘æˆ˜ä½ çš„å¯¹æ‰‹ï¼Œå±•ç°ä½ çš„å®åŠ›ï¼</p>
        </div>

        <!-- ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="pk-card pk-mb-4" id="userStatsCard">
            <div class="pk-flex pk-flex-between">
                <div>
                    <h3 class="pk-card-title">æˆ‘çš„æˆ˜ç»©</h3>
                    <div class="pk-flex pk-flex-gap pk-mt-2">
                        <div class="pk-stat-box">
                            <div class="pk-stat-value" id="userElo">1200</div>
                            <div class="pk-stat-label">ELOåˆ†æ•°</div>
                        </div>
                        <div class="pk-stat-box">
                            <div class="pk-stat-value" id="userWins">0</div>
                            <div class="pk-stat-label">èƒœåœº</div>
                        </div>
                        <div class="pk-stat-box">
                            <div class="pk-stat-value" id="userLosses">0</div>
                            <div class="pk-stat-label">è´Ÿåœº</div>
                        </div>
                        <div class="pk-stat-box">
                            <div class="pk-stat-value" id="userWinRate">0%</div>
                            <div class="pk-stat-label">èƒœç‡</div>
                        </div>
                    </div>
                </div>
                <div>
                    <span class="pk-player-tier" id="userTier"></span>
                </div>
            </div>
        </div>

        <!-- å¯¹æˆ˜æ¨¡å¼é€‰æ‹© -->
        <div class="pk-card pk-mb-4">
            <h3 class="pk-card-title pk-mb-3">é€‰æ‹©å¯¹æˆ˜æ¨¡å¼</h3>
            <div class="pk-grid pk-grid-3 pk-grid-gap">
                <div class="pk-mode-card" data-mode="QUICK">
                    <div class="pk-mode-icon">âš¡</div>
                    <div class="pk-mode-name">å¿«é€Ÿæ¨¡å¼</div>
                    <div class="pk-mode-desc">5é¢˜ Â· 10åˆ†é’Ÿ</div>
                </div>
                <div class="pk-mode-card active" data-mode="STANDARD">
                    <div class="pk-mode-icon">ğŸ¯</div>
                    <div class="pk-mode-name">æ ‡å‡†æ¨¡å¼</div>
                    <div class="pk-mode-desc">10é¢˜ Â· 20åˆ†é’Ÿ</div>
                </div>
                <div class="pk-mode-card" data-mode="LONG">
                    <div class="pk-mode-icon">ğŸ”¥</div>
                    <div class="pk-mode-name">é•¿ç¯‡æ¨¡å¼</div>
                    <div class="pk-mode-desc">20é¢˜ Â· 40åˆ†é’Ÿ</div>
                </div>
            </div>
        </div>

        <!-- åŒ¹é…åŒºåŸŸ -->
        <div class="pk-card pk-mb-4">
            <div id="matchingIdleView">
                <h3 class="pk-card-title pk-mb-3">å¼€å§‹åŒ¹é…</h3>

                <!-- è¯¾ç¨‹é€‰æ‹© -->
                <div class="pk-form-group">
                    <label class="pk-form-label">é€‰æ‹©è¯¾ç¨‹</label>
                    <select class="pk-form-select" id="courseSelect">
                        <option value="">åŠ è½½ä¸­...</option>
                    </select>
                </div>

                <!-- åŒ¹é…æŒ‰é’® -->
                <div class="pk-flex pk-flex-gap">
                    <button class="pk-btn pk-btn-primary pk-btn-lg pk-btn-full" id="quickMatchBtn">
                        <span>ğŸ²</span>
                        <span>å¿«é€ŸåŒ¹é…</span>
                    </button>
                    <button class="pk-btn pk-btn-outline pk-btn-lg" id="inviteFriendBtn">
                        <span>ğŸ‘¥</span>
                        <span>é‚€è¯·å¥½å‹</span>
                    </button>
                </div>
            </div>

            <!-- åŒ¹é…ä¸­è§†å›¾ -->
            <div id="matchingView" class="pk-hidden">
                <div class="pk-matching-animation">
                    <h3 class="pk-card-title">æ­£åœ¨åŒ¹é…å¯¹æ‰‹...</h3>
                    <div class="pk-matching-dots">
                        <div class="pk-matching-dot"></div>
                        <div class="pk-matching-dot"></div>
                        <div class="pk-matching-dot"></div>
                    </div>
                    <p class="pk-text-muted">
                        å·²åŒ¹é… <span id="matchingDuration">0</span> ç§’
                    </p>
                    <button class="pk-btn pk-btn-danger" id="cancelMatchBtn">å–æ¶ˆåŒ¹é…</button>
                </div>
            </div>

            <!-- åŒ¹é…æˆåŠŸè§†å›¾ -->
            <div id="matchFoundView" class="pk-hidden">
                <h3 class="pk-card-title pk-text-center pk-mb-3">æ‰¾åˆ°å¯¹æ‰‹ï¼</h3>
                <div class="pk-grid pk-grid-3 pk-grid-gap" style="align-items: center;">
                    <!-- ç©å®¶1 -->
                    <div class="pk-player-card">
                        <div class="pk-player-avatar" id="player1Avatar"></div>
                        <div class="pk-player-name" id="player1Name"></div>
                        <span class="pk-player-tier" id="player1Tier"></span>
                    </div>

                    <!-- VS -->
                    <div class="pk-vs-badge">VS</div>

                    <!-- ç©å®¶2 -->
                    <div class="pk-player-card">
                        <div class="pk-player-avatar" id="player2Avatar"></div>
                        <div class="pk-player-name" id="player2Name"></div>
                        <span class="pk-player-tier" id="player2Tier"></span>
                    </div>
                </div>
                <div class="pk-text-center pk-mt-4">
                    <p class="pk-text-muted pk-mb-2">å¯¹æˆ˜å°†åœ¨ <span id="countdownTimer">5</span> ç§’åå¼€å§‹</p>
                    <button class="pk-btn pk-btn-primary pk-btn-lg" id="startBattleBtn">ç«‹å³å¼€å§‹</button>
                </div>
            </div>
        </div>

        <!-- åœ¨çº¿å¥½å‹åˆ—è¡¨ -->
        <div class="pk-card pk-mb-4">
            <h3 class="pk-card-title pk-mb-3">åœ¨çº¿å¥½å‹ <span id="onlineFriendsCount" class="pk-text-muted">(0)</span></h3>
            <div id="onlineFriendsList" class="pk-grid pk-grid-3 pk-grid-gap">
                <!-- åŠ¨æ€åŠ è½½ -->
            </div>
        </div>

        <!-- æœ€è¿‘å¯¹æˆ˜ -->
        <div class="pk-card">
            <h3 class="pk-card-title pk-mb-3">æœ€è¿‘å¯¹æˆ˜</h3>
            <div id="recentBattlesList" class="pk-battles-list">
                <!-- åŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </div>

    <!-- å¥½å‹é‚€è¯·æ¨¡æ€æ¡† -->
    <div class="pk-modal" id="inviteModal">
        <div class="pk-modal-content">
            <div class="pk-modal-header">
                <h3 class="pk-modal-title">é‚€è¯·å¥½å‹PK</h3>
                <button class="pk-modal-close" id="closeInviteModal">&times;</button>
            </div>
            <div class="pk-modal-body">
                <div id="friendsListForInvite">
                    <!-- åŠ¨æ€åŠ è½½å¥½å‹åˆ—è¡¨ -->
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScriptæ¨¡å— -->
    <script type="module">
        import { PKArena } from './pk/arena.js';

        // åˆå§‹åŒ–PKç«æŠ€åœº
        const arena = new PKArena();

        // é¡µé¢åŠ è½½ååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            await arena.init();
        });

        // å…¨å±€å¯¼å‡ºç”¨äºè°ƒè¯•
        window.pkArena = arena;
    </script>

    <style>
        /* æ¨¡å¼å¡ç‰‡æ ·å¼ */
        .pk-mode-card {
            background: var(--pk-bg-glass);
            border: 2px solid var(--pk-border-glass);
            border-radius: var(--pk-radius-lg);
            padding: var(--pk-spacing-xl);
            text-align: center;
            cursor: pointer;
            transition: var(--pk-transition);
        }

        .pk-mode-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-4px);
        }

        .pk-mode-card.active {
            border-color: var(--pk-primary);
            box-shadow: var(--pk-shadow-glow);
        }

        .pk-mode-icon {
            font-size: 3rem;
            margin-bottom: var(--pk-spacing-md);
        }

        .pk-mode-name {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: var(--pk-spacing-sm);
        }

        .pk-mode-desc {
            color: var(--pk-text-muted);
            font-size: 0.9rem;
        }

        /* å¥½å‹å¡ç‰‡ */
        .pk-friend-card {
            background: var(--pk-bg-glass);
            border: 1px solid var(--pk-border-glass);
            border-radius: var(--pk-radius-md);
            padding: var(--pk-spacing-md);
            display: flex;
            align-items: center;
            gap: var(--pk-spacing-md);
            cursor: pointer;
            transition: var(--pk-transition);
        }

        .pk-friend-card:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .pk-friend-avatar {
            width: 50px;
            height: 50px;
            border-radius: var(--pk-radius-full);
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.25rem;
        }

        .pk-friend-info {
            flex: 1;
        }

        .pk-friend-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .pk-friend-status {
            font-size: 0.875rem;
            color: var(--pk-text-muted);
        }

        .pk-friend-status.online {
            color: var(--pk-success);
        }

        .pk-friend-status.online::before {
            content: "â—";
            margin-right: 0.25rem;
        }
    </style>
</body>
</html>
