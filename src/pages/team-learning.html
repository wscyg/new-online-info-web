<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>组队学习 - AI 信息未来</title>
    <link rel="stylesheet" href="../styles/apple-design.css">
    <style>
        body {
            padding-top: 48px;
        }

        .page-header {
            text-align: center;
            padding: 60px 0 40px;
        }

        .page-title {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .page-subtitle {
            font-size: 21px;
            color: var(--text-secondary);
        }

        /* 房间网格 */
        .rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 60px;
        }

        /* 房间卡片 */
        .room-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 24px;
            transition: transform var(--transition-fast), box-shadow var(--transition-fast);
            cursor: pointer;
        }

        .room-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .room-code {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent);
        }

        .room-status {
            padding: 6px 12px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
        }

        .status-recruiting {
            background: rgba(52, 199, 89, 0.1);
            color: #34c759;
        }

        .status-in_progress {
            background: rgba(0, 113, 227, 0.1);
            color: var(--accent);
        }

        .status-completed {
            background: var(--bg-hover);
            color: var(--text-tertiary);
        }

        .room-info {
            margin-bottom: 20px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 15px;
        }

        .info-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        .room-members {
            display: flex;
            gap: -8px;
            margin-top: 16px;
        }

        .member-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid var(--bg-card);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 600;
            color: #fff;
        }

        /* 创建房间卡片 */
        .create-room-card {
            background: var(--bg-card);
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-lg);
            padding: 40px 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 250px;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .create-room-card:hover {
            border-color: var(--accent);
            background: rgba(0, 113, 227, 0.02);
        }

        .create-icon {
            width: 48px;
            height: 48px;
            margin-bottom: 16px;
            color: var(--accent);
        }

        .create-title {
            font-size: 19px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .create-subtitle {
            font-size: 15px;
            color: var(--text-secondary);
        }

        /* 模态框 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            padding: 32px;
            width: 90%;
            max-width: 480px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .close-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: var(--bg-hover);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 20px;
        }

        .close-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .form-select {
            width: 100%;
            padding: 14px 16px;
            font-family: var(--font-sans);
            font-size: 17px;
            color: var(--text-primary);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
        }

        .form-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.15);
        }

        .form-select option {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        /* 房间详情 */
        .room-detail {
            margin-top: 24px;
        }

        .detail-room-code {
            font-size: 36px;
            font-weight: 800;
            color: var(--accent);
            text-align: center;
            margin-bottom: 8px;
        }

        .detail-room-info {
            text-align: center;
            color: var(--text-secondary);
            font-size: 15px;
            margin-bottom: 32px;
        }

        .members-section {
            margin-bottom: 24px;
        }

        .members-title {
            font-size: 19px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .members-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .member-item {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .member-info {
            flex: 1;
        }

        .member-name {
            font-size: 17px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .member-progress-text {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .progress-bar {
            background: var(--bg-hover);
            border-radius: var(--radius-full);
            height: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent);
            transition: width 0.3s ease;
            border-radius: var(--radius-full);
        }

        .leader-badge {
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
            color: #fff;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
        }

        .empty-members {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-tertiary);
            font-size: 15px;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="nav">
        <div class="nav-inner">
            <div class="nav-logo">AI 信息未来</div>
            <div class="nav-menu">
                <a href="dashboard.html" class="nav-link">首页</a>
                <a href="plaza.html" class="nav-link">课程</a>
                <a href="team-learning.html" class="nav-link active">社区</a>
                <a href="leaderboard.html" class="nav-link">PK竞技</a>
            </div>
            <div class="nav-actions">
                <button class="theme-toggle" onclick="toggleTheme()" aria-label="切换主题">
                    <svg class="icon-sun" width="16" height="16" fill="currentColor" style="display: none;">
                        <circle cx="8" cy="8" r="4"/>
                        <path d="M8 0v2M8 14v2M0 8h2M14 8h2M2.9 2.9l1.4 1.4M11.7 11.7l1.4 1.4M2.9 13.1l1.4-1.4M11.7 4.3l1.4-1.4"/>
                    </svg>
                    <svg class="icon-moon" width="16" height="16" fill="currentColor">
                        <path d="M8 0c.9 0 1.8.2 2.6.5-2.3.7-4 2.9-4 5.5s1.7 4.8 4 5.5c-.8.3-1.7.5-2.6.5-4.4 0-8-3.6-8-8s3.6-8 8-8z"/>
                    </svg>
                </button>
                <div class="user-menu">
                    <div class="user-avatar" onclick="toggleUserMenu()" id="userAvatar"></div>
                    <div class="dropdown" id="userDropdown">
                        <div class="dropdown-item" onclick="window.location.href='dashboard.html'">
                            <svg width="16" height="16" fill="currentColor">
                                <rect x="2" y="2" width="12" height="12" rx="2"/>
                            </svg>
                            <span>个人中心</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-item" onclick="handleLogout()">
                            <svg width="16" height="16" fill="currentColor">
                                <path d="M8 0v8M3.5 3.5c-2 2-2 5.2 0 7.2s5.2 2 7.2 0 2-5.2 0-7.2"/>
                            </svg>
                            <span>退出登录</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主内容 -->
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">组队学习</h1>
            <p class="page-subtitle">和小伙伴一起学习，获得团队奖励</p>
        </div>

        <!-- 房间网格 -->
        <div class="rooms-grid" id="roomsGrid">
            <!-- 创建房间卡片 -->
            <div class="create-room-card" onclick="showCreateRoomModal()">
                <svg class="create-icon" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <div class="create-title">创建学习房间</div>
                <div class="create-subtitle">邀请好友一起学习</div>
            </div>

            <!-- 房间卡片将通过JavaScript动态加载 -->
        </div>
    </div>

    <!-- 创建房间模态框 -->
    <div class="modal" id="createRoomModal" onclick="closeModal(event, 'createRoomModal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title">创建学习房间</h2>
                <button class="close-btn" onclick="closeModal(null, 'createRoomModal')">×</button>
            </div>

            <div class="form-group">
                <label class="form-label">选择课程</label>
                <select class="form-select" id="courseSelect">
                    <option value="">请选择课程</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">选择章节</label>
                <select class="form-select" id="chapterSelect">
                    <option value="">请选择章节</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">目标时长（分钟）</label>
                <select class="form-select" id="durationSelect">
                    <option value="30">30分钟</option>
                    <option value="45">45分钟</option>
                    <option value="60">60分钟</option>
                    <option value="90">90分钟</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">最大人数</label>
                <select class="form-select" id="maxMembersSelect">
                    <option value="2">2人</option>
                    <option value="3">3人</option>
                    <option value="4">4人</option>
                    <option value="5">5人</option>
                </select>
            </div>

            <button class="btn btn-primary" onclick="createRoom()">
                创建房间
            </button>
        </div>
    </div>

    <!-- 房间详情模态框 -->
    <div class="modal" id="roomDetailModal" onclick="closeModal(event, 'roomDetailModal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title">房间详情</h2>
                <button class="close-btn" onclick="closeModal(null, 'roomDetailModal')">×</button>
            </div>

            <div class="room-detail">
                <div class="detail-room-code" id="detailRoomCode">1234</div>
                <div class="detail-room-info" id="detailRoomInfo">
                    课程名称 · 章节名称
                </div>

                <div class="members-section">
                    <h3 class="members-title">成员列表</h3>
                    <div class="members-list" id="membersList">
                        <!-- 动态加载成员 -->
                    </div>
                </div>

                <button class="btn btn-primary" id="roomActionBtn" onclick="handleRoomAction()">
                    加入房间
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';
        let currentRoom = null;
        let selectedCourse = null;

        // 初始化主题
        function initTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
            updateThemeIcon();
        }

        // 切换主题
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon();
        }

        // 更新主题图标
        function updateThemeIcon() {
            const theme = document.documentElement.getAttribute('data-theme');
            const sunIcon = document.querySelector('.icon-sun');
            const moonIcon = document.querySelector('.icon-moon');
            if (theme === 'dark') {
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
            } else {
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
            }
        }

        // 初始化用户信息
        function initUser() {
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const avatar = document.getElementById('userAvatar');
            if (user.username) {
                avatar.textContent = user.username[0].toUpperCase();
            } else {
                window.location.href = '../auth/login.html';
            }
        }

        // 切换用户菜单
        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        // 点击外部关闭用户菜单
        document.addEventListener('click', (e) => {
            const userMenu = document.querySelector('.user-menu');
            const dropdown = document.getElementById('userDropdown');
            if (!userMenu.contains(e.target)) {
                dropdown.classList.remove('show');
            }
        });

        // 退出登录
        function handleLogout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '../auth/login.html';
        }

        // 页面加载
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            initUser();
            loadRooms();
            loadCourses();
        });

        // 加载房间列表
        async function loadRooms() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/team/rooms?status=recruiting`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    renderRooms(data.data || []);
                }
            } catch (error) {
                console.error('加载房间失败:', error);
            }
        }

        // 渲染房间列表
        function renderRooms(rooms) {
            const grid = document.getElementById('roomsGrid');
            const createCard = grid.querySelector('.create-room-card');

            // 清空现有房间卡片（保留创建卡片）
            while (grid.children.length > 1) {
                grid.removeChild(grid.lastChild);
            }

            rooms.forEach(room => {
                const card = document.createElement('div');
                card.className = 'room-card';
                card.onclick = () => showRoomDetail(room);

                card.innerHTML = `
                    <div class="room-header">
                        <div class="room-code">#${room.roomCode}</div>
                        <div class="room-status status-${room.roomStatus}">${getStatusText(room.roomStatus)}</div>
                    </div>
                    <div class="room-info">
                        <div class="info-item">
                            <svg class="info-icon" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M8 0C6.9 0 6 .9 6 2v2H4c-.6 0-1 .4-1 1v9c0 .6.4 1 1 1h8c.6 0 1-.4 1-1V5c0-.6-.4-1-1-1h-2V2c0-1.1-.9-2-2-2zm0 1c.6 0 1 .4 1 1v2H7V2c0-.6.4-1 1-1z"/>
                            </svg>
                            <span>${room.courseTitle || '未知课程'}</span>
                        </div>
                        <div class="info-item">
                            <svg class="info-icon" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M2 3c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v10c0 .6-.4 1-1 1H3c-.6 0-1-.4-1-1V3zm2 2v6h8V5H4z"/>
                            </svg>
                            <span>${room.chapterTitle || '未知章节'}</span>
                        </div>
                        <div class="info-item">
                            <svg class="info-icon" fill="currentColor" viewBox="0 0 16 16">
                                <circle cx="8" cy="8" r="7" fill="none" stroke="currentColor" stroke-width="1.5"/>
                                <path d="M8 4v4l3 2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                            </svg>
                            <span>${room.targetDuration}分钟</span>
                        </div>
                        <div class="info-item">
                            <svg class="info-icon" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M8 8c1.7 0 3-1.3 3-3s-1.3-3-3-3-3 1.3-3 3 1.3 3 3 3zM8 9c-2.7 0-8 1.3-8 4v2h16v-2c0-2.7-5.3-4-8-4z"/>
                            </svg>
                            <span>${room.currentMembers}/${room.maxMembers}人</span>
                        </div>
                    </div>
                    <div class="room-members">
                        ${renderMemberAvatars(room.members || [])}
                    </div>
                `;

                grid.appendChild(card);
            });
        }

        // 渲染成员头像
        function renderMemberAvatars(members) {
            return members.slice(0, 5).map(member =>
                `<div class="member-avatar">${(member.username || '?')[0].toUpperCase()}</div>`
            ).join('');
        }

        // 显示创建房间模态框
        function showCreateRoomModal() {
            document.getElementById('createRoomModal').classList.add('show');
        }

        // 显示房间详情
        async function showRoomDetail(room) {
            currentRoom = room;

            // 更新模态框内容
            document.getElementById('detailRoomCode').textContent = `#${room.roomCode}`;
            document.getElementById('detailRoomInfo').textContent =
                `${room.courseTitle || '未知课程'} · ${room.chapterTitle || '未知章节'}`;

            // 加载成员列表
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/team/rooms/${room.id}/members`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    renderMembersList(data.data || []);
                }
            } catch (error) {
                console.error('加载成员失败:', error);
            }

            // 更新按钮状态
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const isMember = room.members?.some(m => m.userId === user.id);
            const isLeader = room.creatorId === user.id;

            const btn = document.getElementById('roomActionBtn');
            if (isMember) {
                btn.textContent = isLeader ? '开始学习' : '已加入';
                btn.onclick = isLeader ? () => startLearning(room.id) : null;
                btn.disabled = !isLeader;
                btn.style.opacity = isLeader ? '1' : '0.5';
            } else {
                btn.textContent = '加入房间';
                btn.onclick = () => joinRoom(room.id);
                btn.disabled = room.currentMembers >= room.maxMembers;
                btn.style.opacity = btn.disabled ? '0.5' : '1';
            }

            document.getElementById('roomDetailModal').classList.add('show');
        }

        // 渲染成员列表
        function renderMembersList(members) {
            const list = document.getElementById('membersList');

            if (members.length === 0) {
                list.innerHTML = '<div class="empty-members">暂无成员</div>';
                return;
            }

            list.innerHTML = members.map(member => `
                <div class="member-item">
                    <div class="member-avatar">${(member.username || '?')[0].toUpperCase()}</div>
                    <div class="member-info">
                        <div class="member-name">${member.username || '未知用户'}</div>
                        <div class="member-progress-text">进度: ${member.progress || 0}%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${member.progress || 0}%"></div>
                        </div>
                    </div>
                    ${member.isLeader ? '<div class="leader-badge">队长</div>' : ''}
                </div>
            `).join('');
        }

        // 加载课程
        async function loadCourses() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/courses?page=1&size=20`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    const select = document.getElementById('courseSelect');
                    const courses = data.data?.items || data.data || [];

                    courses.forEach(course => {
                        const option = document.createElement('option');
                        option.value = course.id;
                        option.textContent = course.title;
                        select.appendChild(option);
                    });

                    // 监听课程选择
                    select.addEventListener('change', () => loadChapters(select.value));
                }
            } catch (error) {
                console.error('加载课程失败:', error);
            }
        }

        // 加载章节
        async function loadChapters(courseId) {
            if (!courseId) return;

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/courses/${courseId}/chapters`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    const select = document.getElementById('chapterSelect');
                    select.innerHTML = '<option value="">请选择章节</option>';

                    const chapters = data.data || [];
                    chapters.forEach(chapter => {
                        const option = document.createElement('option');
                        option.value = chapter.id;
                        option.textContent = chapter.title;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('加载章节失败:', error);
            }
        }

        // 创建房间
        async function createRoom() {
            const courseId = document.getElementById('courseSelect').value;
            const chapterId = document.getElementById('chapterSelect').value;
            const targetDuration = document.getElementById('durationSelect').value;
            const maxMembers = document.getElementById('maxMembersSelect').value;

            if (!courseId || !chapterId) {
                alert('请选择课程和章节');
                return;
            }

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/team/rooms`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        courseId: parseInt(courseId),
                        chapterId: parseInt(chapterId),
                        targetDuration: parseInt(targetDuration),
                        maxMembers: parseInt(maxMembers)
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    alert(`房间创建成功！房间号：${data.data.roomCode}`);
                    closeModal(null, 'createRoomModal');
                    loadRooms();
                } else {
                    const error = await response.json();
                    alert(error.message || '创建房间失败');
                }
            } catch (error) {
                console.error('创建房间失败:', error);
                alert('网络错误，请稍后重试');
            }
        }

        // 加入房间
        async function joinRoom(roomId) {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/team/rooms/${roomId}/join`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    alert('加入房间成功！');
                    closeModal(null, 'roomDetailModal');
                    loadRooms();
                } else {
                    const error = await response.json();
                    alert(error.message || '加入房间失败');
                }
            } catch (error) {
                console.error('加入房间失败:', error);
                alert('网络错误，请稍后重试');
            }
        }

        // 开始学习
        async function startLearning(roomId) {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/team/rooms/${roomId}/start`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    alert('学习已开始！');
                    closeModal(null, 'roomDetailModal');
                    loadRooms();
                } else {
                    const error = await response.json();
                    alert(error.message || '开始学习失败');
                }
            } catch (error) {
                console.error('开始学习失败:', error);
                alert('网络错误，请稍后重试');
            }
        }

        // 关闭模态框
        function closeModal(event, modalId) {
            if (!event || event.target.classList.contains('modal')) {
                document.getElementById(modalId).classList.remove('show');
                currentRoom = null;
            }
        }

        // 获取状态文本
        function getStatusText(status) {
            const map = {
                'recruiting': '招募中',
                'in_progress': '进行中',
                'completed': '已完成'
            };
            return map[status] || status;
        }

        // 房间操作处理
        function handleRoomAction() {
            if (!currentRoom) return;

            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const isLeader = currentRoom.creatorId === user.id;

            if (isLeader) {
                startLearning(currentRoom.id);
            } else {
                joinRoom(currentRoom.id);
            }
        }
    </script>
</body>
</html>
