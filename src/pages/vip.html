<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼šå‘˜è®¢é˜… - AI ä¿¡æ¯æœªæ¥</title>
    <link rel="stylesheet" href="/assets/skins/app-shell.css">
<link rel="stylesheet" href="../styles/apple-design.css">
    <style>
        body { padding-top: 48px; background: var(--bg-secondary); }
        .nav { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: rgba(255,255,255,0.85); backdrop-filter: blur(16px); border-bottom: 1px solid var(--border-color); }
        [data-theme="dark"] .nav { background: rgba(17,17,19,0.85); }
        .nav-inner { max-width: 1200px; margin: 0 auto; padding: 10px 20px; display: flex; align-items: center; justify-content: space-between; }
        .nav-left { display: flex; align-items: center; gap: 16px; }
        .logo { font-weight: 700; color: var(--text-primary); text-decoration: none; }
        .nav-links { display: flex; gap: 12px; }
        .nav-link { color: var(--text-secondary); text-decoration: none; padding: 8px 10px; border-radius: 10px; }
        .nav-link:hover { background: var(--bg-hover); color: var(--text-primary); }
        .nav-right { display: flex; align-items: center; gap: 10px; }
        .user-avatar { width: 34px; height: 34px; border-radius: 50%; background: var(--accent); color: #fff; display: flex; align-items: center; justify-content: center; font-weight: 700; text-decoration: none; }
        .theme-btn { width: 38px; height: 38px; border-radius: 12px; border: 1px solid var(--border-color); background: var(--bg-card); cursor: pointer; }

        .hero { padding: 70px 0 28px; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .hero-title { font-size: 46px; font-weight: 800; letter-spacing: -0.03em; margin: 0 0 10px; }
        .hero-subtitle { font-size: 18px; color: var(--text-secondary); margin: 0; }

        .status-card { margin-top: 18px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: 18px; display: flex; align-items: center; justify-content: space-between; gap: 16px; }
        .status-left { display: flex; flex-direction: column; gap: 4px; }
        .status-title { font-weight: 650; }
        .status-desc { color: var(--text-secondary); font-size: 14px; }

        .plans { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 18px; }
        .plan { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: 20px; position: relative; overflow: hidden; }
        .plan.recommend { border-color: rgba(102,126,234,0.45); box-shadow: 0 16px 40px rgba(102,126,234,0.12); }
        .badge { position: absolute; top: 14px; right: 14px; font-size: 12px; padding: 6px 10px; border-radius: 999px; background: rgba(102,126,234,0.12); color: var(--accent); font-weight: 650; }
        .plan-name { font-size: 18px; font-weight: 750; margin: 2px 0 10px; }
        .plan-price { font-size: 34px; font-weight: 800; letter-spacing: -0.02em; margin: 0; }
        .plan-price small { font-size: 14px; font-weight: 600; color: var(--text-secondary); }
        .plan-desc { margin: 10px 0 0; color: var(--text-secondary); font-size: 14px; }
        .plan-features { margin: 16px 0 0; padding-left: 18px; color: var(--text-secondary); font-size: 14px; line-height: 1.8; }
        .plan-actions { margin-top: 16px; display: flex; gap: 10px; }
        .btn { border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary); padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 650; }
        .btn-primary { background: var(--accent); border-color: var(--accent); color: #fff; }
        .btn:disabled { opacity: 0.65; cursor: not-allowed; }

        .faq { margin-top: 22px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: 18px; }
        .faq h2 { margin: 0 0 12px; font-size: 18px; }
        .faq-item { padding: 12px 0; border-top: 1px solid var(--border-color); }
        .faq-item:first-of-type { border-top: none; }
        .faq-q { font-weight: 650; margin-bottom: 4px; }
        .faq-a { color: var(--text-secondary); font-size: 14px; margin: 0; line-height: 1.7; }

        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: #fff; padding: 10px 14px; border-radius: 12px; opacity: 0; transition: opacity .2s; z-index: 1200; }
        .toast.show { opacity: 1; }

        @media (max-width: 980px) { .plans { grid-template-columns: 1fr; } .hero-title { font-size: 36px; } }
    </style>
</head>
<body>
    <div class="nav">
        <div class="nav-inner">
            <div class="nav-left">
                <a class="logo" href="../../index.html">AIæœªæ¥å­¦é™¢</a>
                <div class="nav-links">
                    <a class="nav-link" href="courses.html">è¯¾ç¨‹</a>
                    <a class="nav-link" href="community.html">ç¤¾åŒº</a>
                    <a class="nav-link" href="vip.html" style="color: var(--text-primary); font-weight: 700;">ä¼šå‘˜</a>
                </div>
            </div>
            <div class="nav-right">
                <button class="theme-btn" id="themeToggle" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
                <div id="authArea"></div>
            </div>
        </div>
    </div>

    <main class="container">
        <section class="hero">
            <h1 class="hero-title">å¼€é€šä¼šå‘˜ï¼Œè§£é”å…¨éƒ¨è¯¾ç¨‹</h1>
            <p class="hero-subtitle">æ›´ç®€å•çš„ä»˜è´¹æ–¹å¼ï¼šä¸€æ¬¡å¼€é€šï¼Œå…¨ç«™å­¦ä¹ ã€‚æ”¯æŒæœˆåº¦/å¹´åº¦/ç»ˆèº«ã€‚</p>

            <div class="status-card">
                <div class="status-left">
                    <div class="status-title" id="vipStatusTitle">ä¼šå‘˜çŠ¶æ€ï¼šåŠ è½½ä¸­...</div>
                    <div class="status-desc" id="vipStatusDesc"> </div>
                </div>
                <div>
                    <button class="btn" id="manageBtn" style="display:none;" onclick="goToOrders()">æŸ¥çœ‹è®¢å•</button>
                    <button class="btn btn-primary" id="loginBtn" style="display:none;" onclick="goLogin()">ç™»å½•åå¼€é€š</button>
                </div>
            </div>
        </section>

        <section class="plans" id="plans">
            <div class="plan">
                <div class="plan-name">æœˆåº¦ä¼šå‘˜</div>
                <p class="plan-price">Â¥29.90 <small>/ æœˆ</small></p>
                <p class="plan-desc">é€‚åˆè¯•ç”¨ä¸çŸ­æœŸå†²åˆº</p>
                <ul class="plan-features">
                    <li>è§£é”å…¨éƒ¨ä»˜è´¹è¯¾ç¨‹</li>
                    <li>è¯¾ç¨‹æ›´æ–°åŒæ­¥å¯å­¦</li>
                    <li>å­¦ä¹ è®°å½•ä¸è¿›åº¦ä¿å­˜</li>
                </ul>
                <div class="plan-actions">
                    <button class="btn btn-primary" onclick="buyVip('monthly')">ç«‹å³å¼€é€š</button>
                </div>
            </div>
            <div class="plan recommend">
                <div class="badge">æœ€åˆ’ç®—</div>
                <div class="plan-name">å¹´åº¦ä¼šå‘˜</div>
                <p class="plan-price">Â¥299.00 <small>/ å¹´</small></p>
                <p class="plan-desc">é€‚åˆç³»ç»ŸåŒ–æå‡</p>
                <ul class="plan-features">
                    <li>è§£é”å…¨éƒ¨ä»˜è´¹è¯¾ç¨‹</li>
                    <li>æ–°è¯¾ä¸Šçº¿è‡ªåŠ¨å¯å­¦</li>
                    <li>æ›´ä½çš„å•æœˆæˆæœ¬</li>
                </ul>
                <div class="plan-actions">
                    <button class="btn btn-primary" onclick="buyVip('yearly')">ç«‹å³å¼€é€š</button>
                </div>
            </div>
            <div class="plan">
                <div class="plan-name">ç»ˆèº«ä¼šå‘˜</div>
                <p class="plan-price">Â¥999.00 <small>/ ä¸€æ¬¡</small></p>
                <p class="plan-desc">é€‚åˆé•¿æœŸå­¦ä¹ ä¸é™ªè·‘</p>
                <ul class="plan-features">
                    <li>æ°¸ä¹…è§£é”å…¨éƒ¨ä»˜è´¹è¯¾ç¨‹</li>
                    <li>æœªæ¥æ–°å¢å†…å®¹æŒç»­å¯å­¦</li>
                    <li>ä¸€æ¬¡æŠ•å…¥é•¿æœŸå›æŠ¥</li>
                </ul>
                <div class="plan-actions">
                    <button class="btn btn-primary" onclick="buyVip('lifetime')">ç«‹å³å¼€é€š</button>
                </div>
            </div>
        </section>

        <section class="faq">
            <h2>å¸¸è§é—®é¢˜</h2>
            <div class="faq-item">
                <div class="faq-q">ä¼šå‘˜èƒ½å­¦ä»€ä¹ˆï¼Ÿ</div>
                <p class="faq-a">ä¼šå‘˜å¯è®¿é—®å¹³å°å†…æ‰€æœ‰ä»˜è´¹è¯¾ç¨‹å†…å®¹ï¼›å…è´¹è¯¾ç¨‹æ— éœ€ä¼šå‘˜ä¹Ÿå¯å­¦ä¹ ã€‚</p>
            </div>
            <div class="faq-item">
                <div class="faq-q">ç»­è´¹æ€ä¹ˆè®¡ç®—ï¼Ÿ</div>
                <p class="faq-a">è‹¥å½“å‰ä¼šå‘˜æœªåˆ°æœŸï¼Œæ–°çš„æœˆåº¦/å¹´åº¦ä¼šä»åˆ°æœŸæ—¥ç»§ç»­é¡ºå»¶ï¼›ç»ˆèº«ä¼šå‘˜ä¸è®¾ç½®åˆ°æœŸæ—¶é—´ã€‚</p>
            </div>
            <div class="faq-item">
                <div class="faq-q">æ”¯ä»˜åå¤šä¹…ç”Ÿæ•ˆï¼Ÿ</div>
                <p class="faq-a">æ”¯ä»˜æˆåŠŸåç³»ç»Ÿä¼šè‡ªåŠ¨æ¿€æ´»ä¼šå‘˜ï¼›å¦‚é‡å»¶è¿Ÿå¯ç¨ååˆ·æ–°é¡µé¢æŸ¥çœ‹çŠ¶æ€ã€‚</p>
            </div>
        </section>
    </main>

    <div class="toast" id="toast"></div>

    <script>
        const API_BASE = '/api';

        document.addEventListener('DOMContentLoaded', async () => {
            initTheme();
            renderAuthArea();
            await loadPlans();
            await loadVipStatus();
        });

        function initTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
            document.getElementById('themeToggle').addEventListener('click', () => {
                const current = document.documentElement.getAttribute('data-theme');
                const next = current === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', next);
                localStorage.setItem('theme', next);
            });
        }

        function renderAuthArea() {
            const token = localStorage.getItem('token');
            const userStr = localStorage.getItem('user');
            const authArea = document.getElementById('authArea');

            if (token && userStr) {
                const user = JSON.parse(userStr);
                const initial = (user.nickname || user.username || 'U').charAt(0).toUpperCase();
                            } else {
                            }
        }

        
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'login.html';
        }

        async function loadPlans() {
            try {
                const res = await fetch(`${API_BASE}/vip/plans`);
                const json = await res.json();
                if (json?.code !== 200 || !Array.isArray(json?.data)) return;

                const byType = Object.fromEntries(json.data.map(p => [p.type, p]));
                updatePlanCard('monthly', byType.monthly);
                updatePlanCard('yearly', byType.yearly);
                updatePlanCard('lifetime', byType.lifetime);
            } catch (e) {}
        }

        function updatePlanCard(type, plan) {
            if (!plan) return;
            const root = document.getElementById('plans');
            const nodes = root.querySelectorAll('.plan');
            for (const n of nodes) {
                const name = n.querySelector('.plan-name')?.textContent || '';
                const isMatch =
                    (type === 'monthly' && name.includes('æœˆåº¦')) ||
                    (type === 'yearly' && name.includes('å¹´åº¦')) ||
                    (type === 'lifetime' && name.includes('ç»ˆèº«'));
                if (!isMatch) continue;

                const priceEl = n.querySelector('.plan-price');
                if (priceEl) {
                    const suffix = type === 'monthly' ? '/ æœˆ' : (type === 'yearly' ? '/ å¹´' : '/ ä¸€æ¬¡');
                    priceEl.innerHTML = `Â¥${Number(plan.price).toFixed(2)} <small>${suffix}</small>`;
                }
            }
        }

        async function loadVipStatus() {
            const token = localStorage.getItem('token');
            const title = document.getElementById('vipStatusTitle');
            const desc = document.getElementById('vipStatusDesc');
            const loginBtn = document.getElementById('loginBtn');
            const manageBtn = document.getElementById('manageBtn');

            if (!token) {
                title.textContent = 'ä¼šå‘˜çŠ¶æ€ï¼šæœªç™»å½•';
                desc.textContent = 'ç™»å½•åå¯æŸ¥çœ‹ä¼šå‘˜æœ‰æ•ˆæœŸï¼Œå¹¶ä¸€é”®å¼€é€šã€‚';
                loginBtn.style.display = 'inline-block';
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/vip/status`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const json = await res.json();
                if (json?.code !== 200) {
                    title.textContent = 'ä¼šå‘˜çŠ¶æ€ï¼šè·å–å¤±è´¥';
                    desc.textContent = json?.message || 'è¯·ç¨åé‡è¯•';
                    return;
                }

                const data = json.data || {};
                if (data.active) {
                    const planName = data.plan?.displayName || 'VIPä¼šå‘˜';
                    title.textContent = `ä¼šå‘˜çŠ¶æ€ï¼šå·²å¼€é€šï¼ˆ${planName}ï¼‰`;
                    desc.textContent = data.isLifetime ? 'æœ‰æ•ˆæœŸï¼šç»ˆèº«' : `æœ‰æ•ˆæœŸè‡³ï¼š${formatDateTime(data.expireAt)}`;
                    manageBtn.style.display = 'inline-block';
                } else {
                    title.textContent = 'ä¼šå‘˜çŠ¶æ€ï¼šæœªå¼€é€š';
                    desc.textContent = 'é€‰æ‹©ä¸€ä¸ªå¥—é¤å³å¯å¼€é€šï¼Œç«‹å³è§£é”å…¨éƒ¨è¯¾ç¨‹ã€‚';
                }
            } catch (e) {
                title.textContent = 'ä¼šå‘˜çŠ¶æ€ï¼šè·å–å¤±è´¥';
                desc.textContent = 'è¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•';
            }
        }

        function formatDateTime(value) {
            if (!value) return '';
            // å…¼å®¹åç«¯è¿”å›çš„ LocalDateTime åºåˆ—åŒ–æ ¼å¼ï¼ˆå­—ç¬¦ä¸²æˆ–æ•°ç»„ï¼‰
            if (Array.isArray(value)) {
                const [y,m,d,hh,mm,ss] = value;
                return `${y}-${pad(m)}-${pad(d)} ${pad(hh)}:${pad(mm)}:${pad(ss || 0)}`;
            }
            return String(value).replace('T', ' ').slice(0, 19);
        }

        function pad(n) { return String(n).padStart(2, '0'); }

        async function buyVip(vipType) {
            const token = localStorage.getItem('token');
            if (!token) {
                goLogin();
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/orders/vip/subscribe`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ vipType, paymentMethod: 'alipay' })
                });
                const json = await res.json();
                if (json?.code !== 200) {
                    showToast(json?.message || 'åˆ›å»ºè®¢å•å¤±è´¥');
                    return;
                }

                const order = json?.data?.order;
                if (!order?.id && !order?.orderNo) {
                    showToast('è®¢å•æ•°æ®ç¼ºå¤±');
                    return;
                }

                if (order.orderNo) {
                    window.location.href = `payment.html?orderNo=${encodeURIComponent(order.orderNo)}`;
                    return;
                }
                window.location.href = `payment.html?orderId=${encodeURIComponent(order.id)}`;
            } catch (e) {
                showToast('ç½‘ç»œå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        function goLogin() {
            const redirect = encodeURIComponent(window.location.pathname + window.location.search);
            window.location.href = `login.html?redirect=${redirect}`;
        }

        function goToOrders() {
            window.location.href = 'orders.html';
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }
        });
    </script>
    <script src="/js/app-shell.js"></script>
    
</body>
</html>
