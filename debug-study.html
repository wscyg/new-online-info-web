<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦ä¹ é¡µé¢è°ƒè¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 2rem; }
        .btn { background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; margin: 0.5rem; border-radius: 4px; cursor: pointer; }
        .result { margin: 1rem 0; padding: 1rem; background: #f5f5f5; border-radius: 4px; white-space: pre-wrap; max-height: 400px; overflow-y: auto; }
        iframe { width: 100%; height: 400px; border: 1px solid #ddd; margin-top: 1rem; }
    </style>
</head>
<body>
    <h1>ğŸ” å­¦ä¹ é¡µé¢è°ƒè¯•å·¥å…·</h1>
    <p>è°ƒè¯• study.html?courseId=1&chapterId=100 çš„é—®é¢˜</p>
    
    <div>
        <button class="btn" onclick="testChapterAPI()">æµ‹è¯•ç« èŠ‚API</button>
        <button class="btn" onclick="testContentAPI()">æµ‹è¯•å†…å®¹API</button>
        <button class="btn" onclick="showOriginalStudy()">æ˜¾ç¤ºåŸå§‹å­¦ä¹ é¡µé¢</button>
        <button class="btn" onclick="simulateFixedStudy()">æ¨¡æ‹Ÿä¿®å¤åçš„é¡µé¢</button>
    </div>
    
    <div id="output" class="result">ç­‰å¾…æ“ä½œ...</div>
    <div id="iframe-container"></div>

    <script>
        const API_BASE = '/api';

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            document.getElementById('output').innerHTML += `[${timestamp}] ${message}\n`;
        }

        async function testChapterAPI() {
            log('=== æµ‹è¯•ç« èŠ‚API ===');
            const token = localStorage.getItem('token');
            
            try {
                const response = await fetch(`${API_BASE}/content/courses/1/chapters`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                log('ç« èŠ‚APIå“åº”çŠ¶æ€: ' + response.status);
                log('ç« èŠ‚APIå“åº”æ•°æ®: ' + JSON.stringify(data, null, 2));

                if (data.success && data.data) {
                    log(`âœ… æ‰¾åˆ° ${data.data.length} ä¸ªç« èŠ‚`);
                    
                    // æ£€æŸ¥ç« èŠ‚100æ˜¯å¦å­˜åœ¨
                    const chapter100 = data.data.find(c => c.id === 100);
                    if (chapter100) {
                        log('âœ… ç« èŠ‚100å­˜åœ¨: ' + JSON.stringify(chapter100, null, 2));
                    } else {
                        log('âŒ ç« èŠ‚100ä¸å­˜åœ¨');
                    }
                } else {
                    log('âŒ ç« èŠ‚APIè¿”å›å¤±è´¥');
                }
            } catch (error) {
                log('âŒ ç« èŠ‚APIè¯·æ±‚å¤±è´¥: ' + error.message);
            }
        }

        async function testContentAPI() {
            log('=== æµ‹è¯•ç« èŠ‚å†…å®¹API ===');
            const token = localStorage.getItem('token');
            
            try {
                const response = await fetch(`${API_BASE}/content/chapters/100`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                log('å†…å®¹APIå“åº”çŠ¶æ€: ' + response.status);
                log('å†…å®¹APIå“åº”æ•°æ®: ' + JSON.stringify(data, null, 2));

                if (data.success && data.data && data.data.contentHtml) {
                    log('âœ… ç« èŠ‚å†…å®¹å­˜åœ¨ï¼Œé•¿åº¦: ' + data.data.contentHtml.length);
                    log('å†…å®¹é¢„è§ˆ: ' + data.data.contentHtml.substring(0, 200) + '...');
                } else {
                    log('âŒ ç« èŠ‚å†…å®¹ä¸å­˜åœ¨æˆ–ä¸ºç©º');
                }
            } catch (error) {
                log('âŒ å†…å®¹APIè¯·æ±‚å¤±è´¥: ' + error.message);
            }
        }

        function showOriginalStudy() {
            log('=== æ˜¾ç¤ºåŸå§‹å­¦ä¹ é¡µé¢ ===');
            const iframe = document.createElement('iframe');
            iframe.src = 'study.html?courseId=1&chapterId=100';
            iframe.style.width = '100%';
            iframe.style.height = '500px';
            iframe.style.border = '1px solid #ddd';
            
            const container = document.getElementById('iframe-container');
            container.innerHTML = '<h3>åŸå§‹å­¦ä¹ é¡µé¢:</h3>';
            container.appendChild(iframe);
        }

        async function simulateFixedStudy() {
            log('=== åˆ›å»ºä¿®å¤åçš„å­¦ä¹ é¡µé¢ ===');
            
            const token = localStorage.getItem('token');
            
            try {
                // è·å–ç« èŠ‚å†…å®¹
                const response = await fetch(`${API_BASE}/content/chapters/100`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                
                let content = '';
                if (data.success && data.data && data.data.contentHtml) {
                    content = data.data.contentHtml;
                    log('âœ… ä½¿ç”¨çœŸå®ç« èŠ‚å†…å®¹');
                } else {
                    // ç”Ÿæˆæ¨¡æ‹Ÿå†…å®¹
                    content = `
                        <!DOCTYPE html>
                        <html lang="zh-CN">
                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
                            <title>ç¬¬1ç« ï¼šä¸ºä»€ä¹ˆéœ€è¦Transformer</title>
                            <style>
                                body {
                                    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
                                    line-height: 1.8;
                                    max-width: 800px;
                                    margin: 0 auto;
                                    padding: 2rem;
                                    background: white;
                                }
                                h1, h2, h3 { color: #2c3e50; margin-top: 2rem; }
                                .highlight { background: #fef3cd; padding: 0.2rem 0.5rem; border-radius: 4px; }
                                .code-block { background: #f8f9fa; padding: 1rem; border-radius: 8px; border-left: 4px solid #007bff; }
                            </style>
                        </head>
                        <body>
                            <h1>ğŸš€ ç¬¬1ç« ï¼šä¸ºä»€ä¹ˆéœ€è¦Transformer</h1>
                            
                            <h2>ğŸ“– ç« èŠ‚æ¦‚è¿°</h2>
                            <p>åœ¨æ·±åº¦å­¦ä¹ å‘å±•çš„å†ç¨‹ä¸­ï¼Œ<span class="highlight">Transformeræ¶æ„</span>çš„å‡ºç°æ ‡å¿—ç€è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸçš„é‡å¤§çªç ´ã€‚æœ¬ç« å°†å¸¦æ‚¨äº†è§£Transformeräº§ç”Ÿçš„èƒŒæ™¯å’Œå®ƒè§£å†³çš„æ ¸å¿ƒé—®é¢˜ã€‚</p>
                            
                            <h2>ğŸ” ä¼ ç»Ÿæ¨¡å‹çš„å±€é™æ€§</h2>
                            <p>åœ¨Transformerå‡ºç°ä¹‹å‰ï¼Œå¾ªç¯ç¥ç»ç½‘ç»œ(RNN)å’Œé•¿çŸ­æœŸè®°å¿†ç½‘ç»œ(LSTM)æ˜¯å¤„ç†åºåˆ—æ•°æ®çš„ä¸»è¦æ–¹æ³•ï¼Œä½†å®ƒä»¬å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
                            <ul>
                                <li><strong>ä¸²è¡Œè®¡ç®—é™åˆ¶ï¼š</strong>RNNå¿…é¡»é€æ­¥å¤„ç†åºåˆ—ï¼Œæ— æ³•å¹¶è¡ŒåŒ–</li>
                                <li><strong>é•¿ä¾èµ–é—®é¢˜ï¼š</strong>éš¾ä»¥æ•è·é•¿è·ç¦»çš„ä¾èµ–å…³ç³»</li>
                                <li><strong>æ¢¯åº¦æ¶ˆå¤±ï¼š</strong>åœ¨é•¿åºåˆ—ä¸­æ¢¯åº¦ä¼šé€æ¸æ¶ˆå¤±</li>
                            </ul>
                            
                            <h2>ğŸ’¡ Transformerçš„åˆ›æ–°</h2>
                            <div class="code-block">
                                <strong>æ ¸å¿ƒåˆ›æ–°ï¼šæ³¨æ„åŠ›æœºåˆ¶ (Attention Mechanism)</strong><br>
                                "Attention is All You Need" - è¿™å¥è¯æ¦‚æ‹¬äº†Transformerçš„æ ¸å¿ƒæ€æƒ³
                            </div>
                            
                            <p>Transformeré€šè¿‡<span class="highlight">è‡ªæ³¨æ„åŠ›æœºåˆ¶</span>å®ç°äº†ï¼š</p>
                            <ol>
                                <li>å¹¶è¡ŒåŒ–è®¡ç®—ï¼Œå¤§å¹…æå‡è®­ç»ƒæ•ˆç‡</li>
                                <li>ç›´æ¥å»ºæ¨¡é•¿è·ç¦»ä¾èµ–å…³ç³»</li>
                                <li>æ›´å¥½çš„å¯è§£é‡Šæ€§å’Œå¯è§†åŒ–èƒ½åŠ›</li>
                            </ol>
                            
                            <h2>ğŸ¯ å­¦ä¹ ç›®æ ‡</h2>
                            <p>é€šè¿‡æœ¬ç« å­¦ä¹ ï¼Œæ‚¨å°†æŒæ¡ï¼š</p>
                            <ul>
                                <li>Transformeräº§ç”Ÿçš„å†å²èƒŒæ™¯</li>
                                <li>ä¼ ç»Ÿåºåˆ—æ¨¡å‹çš„å±€é™æ€§</li>
                                <li>æ³¨æ„åŠ›æœºåˆ¶çš„åŸºæœ¬æ¦‚å¿µ</li>
                                <li>Transformerçš„æ ¸å¿ƒä¼˜åŠ¿</li>
                            </ul>
                            
                            <h2>ğŸ“š æ‰©å±•é˜…è¯»</h2>
                            <p>æ¨èé˜…è¯»åŸå§‹è®ºæ–‡ï¼š<em>"Attention Is All You Need"</em> (Vaswani et al., 2017)</p>
                            
                            <div style="text-align: center; margin-top: 3rem; padding: 2rem; background: #f8f9fa; border-radius: 12px;">
                                <h3>ğŸ‰ æ­å–œå®Œæˆç¬¬1ç« å­¦ä¹ ï¼</h3>
                                <p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†æ·±å…¥å­¦ä¹ Transformerçš„æ•°å­¦åŸºç¡€</p>
                            </div>
                        </body>
                        </html>
                    `;
                    log('âš ï¸ ä½¿ç”¨æ¨¡æ‹Ÿç« èŠ‚å†…å®¹');
                }

                // åˆ›å»ºä¿®å¤åçš„iframe
                const iframe = document.createElement('iframe');
                iframe.style.width = '100%';
                iframe.style.height = '600px';
                iframe.style.border = '1px solid #28a745';
                iframe.style.borderRadius = '8px';
                
                // ç›´æ¥è®¾ç½®å†…å®¹
                iframe.onload = function() {
                    iframe.contentDocument.open();
                    iframe.contentDocument.write(content);
                    iframe.contentDocument.close();
                };
                
                const container = document.getElementById('iframe-container');
                container.innerHTML = '<h3>ä¿®å¤åçš„å­¦ä¹ é¡µé¢:</h3>';
                container.appendChild(iframe);
                
                // è®¾ç½®ç©ºç™½é¡µå…ˆ
                iframe.src = 'about:blank';
                
            } catch (error) {
                log('âŒ åˆ›å»ºä¿®å¤é¡µé¢å¤±è´¥: ' + error.message);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨ç™»å½•
        window.onload = async function() {
            log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆ');
            
            // æ£€æŸ¥æ˜¯å¦æœ‰token
            const token = localStorage.getItem('token');
            if (!token) {
                log('â„¹ï¸ æœªæ‰¾åˆ°tokenï¼Œå°è¯•è‡ªåŠ¨ç™»å½•...');
                
                try {
                    const response = await fetch(`${API_BASE}/auth/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            loginAccount: 'cygws123',
                            password: '123.00.aa',
                            loginType: 'password',
                            deviceType: 'web'
                        })
                    });

                    const data = await response.json();
                    if (data.code === 200 && data.data && data.data.token) {
                        localStorage.setItem('token', data.data.token);
                        log('âœ… è‡ªåŠ¨ç™»å½•æˆåŠŸ');
                    }
                } catch (error) {
                    log('âŒ è‡ªåŠ¨ç™»å½•å¤±è´¥: ' + error.message);
                }
            } else {
                log('âœ… æ‰¾åˆ°å·²å­˜å‚¨çš„token');
            }
        };
    </script>
</body>
</html>